<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Class: DataObjectTags [Rails Application Documentation]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='.././rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          DataObjectTags
        </h1>
        <ol class='paths'>
          <li>
            <a href="../files/app/models/data_object_tags_rb.html">app/models/data_object_tags.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a href="ActiveRecord/Base.html">ActiveRecord::Base</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            Associates tags (<a href="DataObjectTag.html">DataObjectTag</a>) with
            objects (<a href="DataObject.html">DataObject</a>)
            </p>
            <p>
            <b>NOTE</b>: this table is unconventionally named!
            </p>
            <p>
            this class is a many-to-many association join table between <a
            href="DataObject.html">DataObject</a> and <a
            href="DataObjectTag.html">DataObjectTag</a>
            </p>
            <p>
            this <em>should</em> be named DataObjectDataObjectTag or
            DataObjectTagDataObject
            </p>
            <p>
            both of those conventional names are unintuitive, in my opinion, so we use:
            <a href="DataObjectTags.html">DataObjectTags</a>
            </p>
            <p>
            we keep the database conventions, however, so the table name is:
            <tt>data_object_data_object_tags</tt>
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000594">minimum_usage_count_for_public_tags</a></li>
              <li><a href="#M000597">public_tags_for_data_object</a></li>
              <li><a href="#M000598">public_tags_for_tag_key</a></li>
              <li><a href="#M000599">public_tags_for_tags</a></li>
              <li><a href="#M000595">search_by_tags_or</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000596">to_s</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DEFAULT_MIN_USAGE_FOR_PUBLIC_TAGS</td>
                    <td>=</td>
                    <td class='context-item-value'>3</td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='aliases-list'>
              <h2>External Aliases</h2>
              <div class='name-list'>
                <table summary='External aliases'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>data_object_tag</td>
                    <td>-&gt;</td>
                    <td class='context-item-value'>tag</td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>data_object</td>
                    <td>-&gt;</td>
                    <td class='context-item-value'>object</td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>minimum_usage_count_for_public_tags</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='public-class method' id='method-M000594'>
                <a name='M000594'>      </a>
                <div class='synopsis'>
                  <span class='name'>minimum_usage_count_for_public_tags</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000594-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000594-source'>    <span class="ruby-comment cmt"># File app/models/data_object_tags.rb, line 30</span>&#x000A;30:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">minimum_usage_count_for_public_tags</span>&#x000A;31:       <span class="ruby-ivar">@minimum_usage_count_for_public_tags</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DEFAULT_MIN_USAGE_FOR_PUBLIC_TAGS</span>&#x000A;32:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000597'>
                <a name='M000597'>      </a>
                <div class='synopsis'>
                  <span class='name'>public_tags_for_data_object</span>
                  <span class='arguments'>(data_object)</span>
                </div>
                <div class='description'>
                  <p>
                  how many users have tagged a data object with ? (what tags) ?
                  </p>
                  <p>
                  Usage:
                  </p>
                  <pre>DataObjectTags.public_tags_for_data_object @data_object&#x000A;DataObjectTags.public_tags_for_data_object @data_object.id</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000597-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000597-source'>    <span class="ruby-comment cmt"># File app/models/data_object_tags.rb, line 66</span>&#x000A;66:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">public_tags_for_data_object</span> <span class="ruby-identifier">data_object</span>&#x000A;67:     <span class="ruby-identifier">id</span>   = (<span class="ruby-identifier">data_object</span>.<span class="ruby-identifier">is_a?</span><span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">data_object</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">data_object</span>.<span class="ruby-identifier">id</span>&#x000A;68:     <span class="ruby-identifier">tags</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tags_with_usage_count</span>.<span class="ruby-identifier">find_all_by_data_object_id</span> <span class="ruby-identifier">id</span>&#x000A;69:     <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">usage_count</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">DataObjectTags</span><span class="ruby-operator">::</span><span class="ruby-identifier">minimum_usage_count_for_public_tags</span> }.<span class="ruby-identifier">map</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">:tag</span>&#x000A;70:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000598'>
                <a name='M000598'>      </a>
                <div class='synopsis'>
                  <span class='name'>public_tags_for_tag_key</span>
                  <span class='arguments'>(key)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns all of the tags that have been promoted to &#8216;public&#8217; for
                  a particular tag key, eg. &#8220;color&#8220;
                  </p>
                  <p>
                  Usage:
                  </p>
                  <pre>public_tags_for_tag_key :color (should return all of the *public* tags where the key is Color)</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000598-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000598-source'>    <span class="ruby-comment cmt"># File app/models/data_object_tags.rb, line 77</span>&#x000A;77:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">public_tags_for_tag_key</span> <span class="ruby-identifier">key</span>&#x000A;78:     <span class="ruby-identifier">public_tags_for_tags</span> <span class="ruby-constant">DataObjectTag</span>[<span class="ruby-identifier">key</span>]&#x000A;79:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000599'>
                <a name='M000599'>      </a>
                <div class='synopsis'>
                  <span class='name'>public_tags_for_tags</span>
                  <span class='arguments'>(tags)</span>
                </div>
                <div class='description'>
                  <p>
                  Takes a list of tags and only returns the public ones
                  </p>
                  <p>
                  Usage:
                  </p>
                  <pre>public_tags_for_tags DataObjectTag[:color]</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000599-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000599-source'>    <span class="ruby-comment cmt"># File app/models/data_object_tags.rb, line 86</span>&#x000A;86:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">public_tags_for_tags</span> <span class="ruby-identifier">tags</span>&#x000A;87:     <span class="ruby-identifier">public_tags</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tags_with_usage_count</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'data_object_tag_id IN (?)'</span>, <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:id</span>) ], <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:data_object_tag</span>&#x000A;88:     <span class="ruby-identifier">public_tags</span> = <span class="ruby-identifier">public_tags</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">tag</span>.<span class="ruby-identifier">is_public</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">usage_count</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">DataObjectTags</span><span class="ruby-operator">::</span><span class="ruby-identifier">minimum_usage_count_for_public_tags</span> }.<span class="ruby-identifier">map</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">:tag</span>&#x000A;89:     <span class="ruby-comment cmt"># we have have been passed some tags that has .is_public set but they aren't actually *used* anywhere so they weren't returned by tags_with_usage_count</span>&#x000A;90:     <span class="ruby-identifier">public_tags</span> = ( <span class="ruby-identifier">public_tags</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">is_public?</span> } ).<span class="ruby-identifier">uniq</span>&#x000A;91:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000595'>
                <a name='M000595'>      </a>
                <div class='synopsis'>
                  <span class='name'>search_by_tags_or</span>
                  <span class='arguments'>(tags, user_id = nil)</span>
                </div>
                <div class='description'>
                  <p>
                  named_scope :search_by_tags_and, lambda{|tags|{ :conditions => tags.map
                  {|t| &#8220;data_object_tag_id = #{t.id}&#8221; }.join(&#8217; AND &#8217;)
                  }} SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000595-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000595-source'>    <span class="ruby-comment cmt"># File app/models/data_object_tags.rb, line 44</span>&#x000A;44:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search_by_tags_or</span>(<span class="ruby-identifier">tags</span>, <span class="ruby-identifier">user_id</span> = <span class="ruby-keyword kw">nil</span>) &#x000A;45:     <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;select dt.*, count(dt.id) do_count &#x000A;46:             from data_object_tags t &#x000A;47:               join data_object_data_object_tags dt &#x000A;48:                 on (t.id = dt.data_object_tag_id) &#x000A;49:             where&#x000A;50:               dt.data_object_tag_id in (#{tags.map(&amp;:id).join(',')})&#x000A;51:             group by dt.data_object_id&quot;</span>&#x000A;52:     <span class="ruby-identifier">res</span> = <span class="ruby-constant">DataObjectTags</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-identifier">sql</span>);&#x000A;53:     <span class="ruby-identifier">res</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">t</span>.<span class="ruby-identifier">do_count</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">DataObjectTags</span><span class="ruby-operator">::</span><span class="ruby-identifier">minimum_usage_count_for_public_tags</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">user_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span>)) }&#x000A;54:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000596'>
                <a name='M000596'>      </a>
                <div class='synopsis'>
                  <span class='name'>to_s</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000596-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000596-source'>    <span class="ruby-comment cmt"># File app/models/data_object_tags.rb, line 56</span>&#x000A;56:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>&#x000A;57:     <span class="ruby-node">&quot;&lt;DataObjectTags object:'#{object}' tag:'#{tag}' /&gt;&quot;</span>&#x000A;58:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
