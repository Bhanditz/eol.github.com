<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><title>Class: ApplicationController</title><link type="text/css" href=".././rdoc-style.css" media="screen" rel="stylesheet"/><script type="text/javascript">
// Allison template
// Copyright 2007, 2008 Cloudburst, LLC. Licensed under the AFL 3. See the included LICENSE file.

var href_base = '.././rdoc-style.css'.replace(/(.*\/).*/, '$1'); // inline js is good for something  

function $(id) {
    if (document.getElementById)
      elem = document.getElementById(id);
    else if ( document.all )
      elem = eval("document.all." + id);
    else
      return false;
    return elem;
}

  function toggle(id) {
    elem = $(id);
    elemStyle = elem.style;   
    if (elemStyle.display == "block") {
      elemStyle.display = "none"
    } else {
      elemStyle.display = "block"
    }
    return true;
  }

  function toggleText(id) {
    elem = $(id)
    if (m = elem.innerHTML.match(/(Hide)(.*)/)) {
      elem.innerHTML = "Show" + m[2];
    } else if (m = elem.innerHTML.match(/(Show)(.*)/)) {
      elem.innerHTML = "Hide" + m[2];
    }
    return true;
  }

function span(s, klass) {
  return '<span class="' + klass + '">' + s + '</span>';
}
  
function highlightSymbols() {
  pres = document.getElementsByTagName('pre');
  for(var i = 0; i < pres.length; i++) {
    pre = pres[i];
    spans = pre.getElementsByTagName('span');
    for(var k = 0; k < spans.length; k++) {
      span = spans[k];
      if (span.className.match(/ruby-identifier/)) {
        if (span.innerHTML.match(/^:/)) {
          span.className += " ruby-symbol";
        }
      }
    }
  }
}

 function hasClass(obj) {
     var result = false;
     if (obj.getAttributeNode("class") != null) {
         result = obj.getAttributeNode("class").value;
     }
     return result;
  }   

 function stripe() {
    var even = true;
    var color = "#e4ebed";
    var tables = document.getElementsByTagName('table');
    if (tables.length == 0) { return; }
    for (var h = 0; h < tables.length; h++) {
        var trs = tables[h].getElementsByTagName("tr");
        for (var i = 0; i < trs.length; i++) {
          var tds = trs[i].getElementsByTagName("td");
            for (var j = 0; j < tds.length; j++) {       
              if (hasClass(tds[j]) != "first") {                
              var mytd = tds[j];
              if (even) {
                mytd.style.backgroundColor = color;
              }         
            }
          }
          even =  ! even;
      }
    }
  }
  
function ajaxGet(url) {
  url = (href_base + url).replace('/./', '/')
  var req = false;

  if (window.ActiveXObject) {
    try {
      // stupid hack because IE7 disables local Ajax with the native xmlhttprequest object
      // for security purposes. Yet ActiveX still works. Thanks, Microsoft. I hate you. Die.
      req = new ActiveXObject("MSXML2.XMLHTTP.3.0");
    } catch (e) {
      try {
        /* IE 6 and maybe 5, don't know, don't care */
        req = new ActiveXObject("Msxml2.XMLHTTP");
      } catch (e) {
        try {
          req = new ActiveXObject("Microsoft.XMLHTTP");
        } catch (e) {
          req = false;
        }
      }
    }
  }
    
  /* real browsers */
  if (!req && window.XMLHttpRequest) {
    try {
      req = new XMLHttpRequest();
    } catch (e) {
      req = false;
    }
  } 
  
  if (req) {
    req.open('GET', url, false);
    req.send(null);
    return req.responseText;
  } else {
    return "Ajax error";  
  }
}


function addEvent(elm, evType, fn, useCapture) {
	if (elm.addEventListener) {
	  elm.addEventListener(evType, fn, useCapture);  
  	return true;
	} else if (elm.attachEvent) {
  	var r = elm.attachEvent('on' + evType, fn);  
	  return r;  
	} else {
  	elm['on' + evType] = fn;
	}
}

function insertIndices() {
  pages = ["class", "file", "method"]
  for (x in pages) { 
    $(pages[x]).innerHTML += ajaxGet('fr_' + pages[x] + '_index.html').replace(/(href=")/g, '$1' + href_base);
  }
  /* mouseoverify method links */
  links = $('method').getElementsByTagName('a');
  for (var x = 0; x < links.length; x++) {
    if (m = links[x].innerHTML.match(/(.*)\s\((.*)\)/)) {
      links[x].innerHTML = m[1] + '<br>';
      links[x].title = m[2];
    }
  }
  /* this is stupid */
  $('class').style.display = "block";
  $('file').style.display = "block";
  
  /* has to be here because IE7 does not guarantee the onLoad callback order */
  abbreviateIndicesInner(["class", "file"], 25, "a");
  /* same, linkTitle() depends on the class link list */
  linkTitle();
}

function abbreviateIndices() {
  var ids = ["defined_in", "child_of", "includes", "requires", "method", "methods"];
  abbreviateIndicesInner(ids, 25, 'a');
  abbreviateIndicesInner(ids, 25, 'span');
}

function abbreviateIndicesInner(indices, amount, tag) {
  for (var x = 0; x < indices.length; x++) { 
    var the_index = $(indices[x]);
    if (the_index) {
      links = the_index.getElementsByTagName(tag);
      for (var y = 0; y < links.length; y++) {
        var link = links[y];
        if (link.getElementsByTagName('span').length == 0 && link.getElementsByTagName('a').length == 0) {
          // avoid nesting
          link.innerHTML = link.innerHTML.replace(/<br>|\n/gi, '');
          link.title = link.innerHTML;
          link.innerHTML = abbreviate(link.innerHTML, amount) + '<br>';
        }
      }
    }
  }
}

function linkTitle() {
  
  /* grab the correct title element from the index */
  var index_page = ajaxGet('index.html');
  title_text = index_page.match(/<title>(.*)<\/title>/m)[1];
  document.title = title_text + " - " + document.title;
  var p = $('header').getElementsByTagName('p')[0]
  if (p.innerHTML.match(/^\s*$/)) {
    p.innerHTML = title_text;
  } else {
    p.innerHTML = title_text + ": " + p.innerHTML;
  }
  
  /* set the link properly */
  title_link = index_page.match(/<a\s+href="(.*?)"/)[1];
  var element = $('title');
  var item_type = "";
  var item_name = "";
  if (m = element.innerHTML.match(/(Class:|Module:|File:)\s*(.*)/)) {
    item_type = m[1];
    item_name = m[2];
  } else {
    item_name = element.innerHTML;
  }
  element.innerHTML = '<a href="' + href_base + title_link + '">' + item_type + " " + abbreviate(item_name, 45) + '</a>';
  element.getElementsByTagName('a')[0].title = item_name
  
  /* breadcrumb navigation */
  items = item_name.split("::");
  items_new = item_name.split("::");
  file_links = $('class').getElementsByTagName('a');
  for (var x = 0; x < items.length - 1; x++ ){
    var item = items[x];
    link = ("/classes/" + items.slice(0,x).join("/") + "/" + item + ".html").replace('//', '/');
    regex = new RegExp(RegExp.escape(link) + '$');
    for (var y = 0; y < file_links.length; y++) {
      if (file_links[y].href.match(regex)) {
         items_new[x] = '<a href="' + href_base + link + '">' + item + '</a>';
         break;
      }
    }  
  }
  $('item_name').innerHTML = item_type + ' ' + items_new.join(" :: ");
}

function abbreviate(s, size) {
  while (s.length > size) {
    var old_s = s;
    s = s.replace(/\s|\n/mg, '');
    s = s.replace(/([A-Z])[a-z]+/m, '$1');
    if (!s || old_s == s) {
      return "..." + s.substring(s.length - size, s.length);
    }
  }
  return s;
}

function disableSubmit(event) {
  var keyCode = event.keyCode ? event.keyCode : event.which ? event.which : event.charCode;
  if (keyCode == 13) {
    return false;
  } else {
    return true;
  }
}
  
function filterList(id, s, event) {
  
  /* some weak escaping */
  s = s.replace(/[^\w\d\.\_\-\/\:\=\[\]\?\!]/g, '');
  s = RegExp.escape(s);
  
  var show_all = false;
  if (s.match(/^\s*$/)) {
    show_all = true;
  }
  
  links = $(id).getElementsByTagName('a')
  regex = new RegExp(s, 'i');
  
  for (var x = 0; x < links.length; x++) {
    var link = links[x];
    if (show_all) {
      link.style.display = 'inline';
    } else {
       if (link.innerHTML.match(regex)) {        
         link.style.display = 'inline';
       } else {
         link.style.display = 'none';
       }
    }
  }
  return true;
}

RegExp.escape = function(text) {
  if (!arguments.callee.sRE) {
    var specials = ['/', '.', '*', '+', '?', '|', '(', ')', '[', ']', '{', '}', '\\'];
    arguments.callee.sRE = new RegExp(
      '(\\' + specials.join('|\\') + ')', 'g'
    );
  }
  return text.replace(arguments.callee.sRE, '\\$1');
}

function hacks() {
  // show the spacer if necessary, 
  divs = document.getElementsByTagName('div');
  for(var x = 0; x < divs.length; x++) {
    if (divs[x].className && divs[x].className.match(/top/)) {
      document.getElementById('spacer').style.display = 'block';
    }
  }
  // remove extra colons from tables
  tds = document.getElementsByTagName('td');
  for(var x = 0; x < tds.length; x++) {
    str = tds[x].innerHTML
    if (str.charAt(str.length - 1) == ":") {
      tds[x].innerHTML = str.slice(0, str.length - 1)
    }
  }
}

addEvent(window, 'load', insertIndices, false);
addEvent(window, 'load', abbreviateIndices, false);
addEvent(window, 'load', stripe, false);
addEvent(window, 'load', highlightSymbols, false);
addEvent(window, 'load', hacks, false);
</script></head><body><div id="container"><div class="curve" id="preheader_curve_0"></div><div class="curve" id="preheader_curve_1"></div><div class="curve" id="preheader_curve_2"></div><div class="curve" id="preheader_curve_3"></div><div class="curve" id="preheader_curve_4"></div><div class="curve" id="preheader_curve_5"></div><div id="header"><p>
</p><span><h1 id="title">
Class: ApplicationController
</h1></span>
</div><div class="clear"></div><div id="left">
<div class="navigation darker top" id="child_of"><h3>Child of</h3><span>

ActionController::Base
</span></div>

<div class="navigation darker top" id="defined_in"><h3>Defined in</h3>

<a href="../files/app/controllers/application_rb.html">app/controllers/application.rb</a>

</div>

<div class="navigation top" id="includes"><h3>Includes</h3>


ExceptionNotifiable<br/>




<a href='ContentPartnerAuthenticationModule.html'>
ContentPartnerAuthenticationModule<br/>
</a>


</div>


<div class="navigation top" id="methods"><h3>Methods</h3>


<a href='#M000542'>
access_denied<br/>
</a>




<a href='#M000541'>
accounts_not_available<br/>
</a>




<a href='#M000505'>
allow_page_to_be_cached?<br/>
</a>




<a href='#M000524'>
allowed_request<br/>
</a>




<a href='#M000532'>
check_authentication<br/>
</a>




<a href='#M000519'>
clear_all_caches<br/>
</a>




<a href='#M000530'>
clear_any_logged_in_session<br/>
</a>




<a href='#M000514'>
collected_errors<br/>
</a>




<a href='#M000547'>
convert_to_nbsp<br/>
</a>




<a href='#M000526'>
create_new_user<br/>
</a>




<a href='#M000510'>
current_url<br/>
</a>




<a href='#M000528'>
current_user<br/>
</a>




<a href='#M000545'>
escape_javascript<br/>
</a>




<a href='#M000518'>
expire_cache<br/>
</a>




<a href='#M000521'>
expire_caches<br/>
</a>




<a href='#M000520'>
expire_menu_caches<br/>
</a>




<a href='#M000522'>
expire_taxa<br/>
</a>




<a href='#M000523'>
expire_taxon<br/>
</a>




<a href='#M000516'>
external_link<br/>
</a>




<a href='#M000504'>
format_date<br/>
</a>




<a href='#M000503'>
format_date_time<br/>
</a>




<a href='#M000506'>
get_agent_icons<br/>
</a>




<a href='#M000512'>
get_image_url<br/>
</a>




<a href='#M000513'>
get_video_url<br/>
</a>




<a href='#M000539'>
go_to_home_page_if_logged_in<br/>
</a>




<a href='#M000500'>
hh<br/>
</a>




<a href='#M000536'>
is_curator<br/>
</a>




<a href='#M000535'>
is_curator?<br/>
</a>




<a href='#M000534'>
is_user_admin?<br/>
</a>




<a href='#M000533'>
is_user_in_role?<br/>
</a>




<a href='#M000531'>
logged_in?<br/>
</a>




<a href='#M000540'>
must_log_in<br/>
</a>




<a href='#M000537'>
permission_denied<br/>
</a>




<a href='#M000538'>
permission_granted<br/>
</a>




<a href='#M000511'>
redirect_back_or_default<br/>
</a>




<a href='#M000525'>
redirect_to_ssl<br/>
</a>




<a href='#M000507'>
remove_html<br/>
</a>




<a href='#M000501'>
render_404<br/>
</a>




<a href='#M000502'>
render_500<br/>
</a>




<a href='#M000527'>
reset_session<br/>
</a>




<a href='#M000509'>
return_to_url<br/>
</a>




<a href='#M000529'>
set_current_user<br/>
</a>




<a href='#M000544'>
set_flash_enabled<br/>
</a>




<a href='#M000543'>
set_language<br/>
</a>




<a href='#M000517'>
set_session<br/>
</a>




<a href='#M000546'>
show_survey?<br/>
</a>




<a href='#M000508'>
store_location<br/>
</a>




<a href='#M000515'>
truncate<br/>
</a>




<a href='#M000499'>
verify_recaptcha<br/>
</a>


</div>
<div id="spacer"></div><div class="navigation darker index" id="class_wrapper"><div class="list_header"><h3>All classes</h3></div><div class="list_header_link"><a onclick="toggle('class'); toggleText('class_link'); return false;" href="#" id="class_link">Hide...</a></div><div class="clear"></div><div id="class"><form><label for="filter_class">Filter:&nbsp;&nbsp;</label><input type="text" onKeyUp="return filterList('class', this.value, event);" onKeyPress="return disableSubmit(event);" id="filter_class"></input></form></div></div><div class="navigation darker index" id="file_wrapper"><div class="list_header"><h3>All files</h3></div><div class="list_header_link"><a onclick="toggle('file'); toggleText('file_link'); return false;" href="#" id="file_link">Hide...</a></div><div class="clear"></div><div id="file"><form><label for="filter_file">Filter:&nbsp;&nbsp;</label><input type="text" onKeyUp="return filterList('file', this.value, event);" onKeyPress="return disableSubmit(event);" id="filter_file"></input></form></div></div><div class="navigation darker index" id="method_wrapper"><div class="list_header"><h3>All methods</h3></div><div class="list_header_link"><a onclick="toggle('method'); toggleText('method_link'); return false;" href="#" id="method_link">Show...</a></div><div class="clear"></div><div id="method"><form><label for="filter_method">Filter:&nbsp;&nbsp;</label><input type="text" onKeyUp="return filterList('method', this.value, event);" onKeyPress="return disableSubmit(event);" id="filter_method"></input></form></div></div></div><div id="content">
<h1 id="item_name">Class: ApplicationController</h1>





<p></p>






<h1>Public Instance Methods</h1>


<a class="small" name="M000542"><br/></a>
<div class="method_block"><h3>
<a href='#M000542'>


access_denied

()

</a>
</h3>
<p>
A user is not authorized for the particular controller based on the rights
for the roles they are in
</p>

<p class="source_link" id="M000542-show-link"><a onclick="toggle('M000542-source'); toggleText('M000542-link'); return false;" href="#" id="M000542-link">Show source...</a></p><div class="source" id="M000542-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 462</span>
462:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">access_denied</span>
463:       <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-identifier">:warning</span>]=<span class="ruby-value str">'You are not authorized to perform this action.'</span>
464:       <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;HTTP_REFERER&quot;</span>] <span class="ruby-operator">?</span> (<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:back</span>) <span class="ruby-operator">:</span> (<span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">home_page_url</span>)
465:     <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000541"><br/></a>
<div class="method_block"><h3>
<a href='#M000541'>


accounts_not_available

()

</a>
</h3>
<p>
call this method if someone is not supposed to get a controller or action
when user accounts are disabled
</p>

<p class="source_link" id="M000541-show-link"><a onclick="toggle('M000541-source'); toggleText('M000541-link'); return false;" href="#" id="M000541-link">Show source...</a></p><div class="source" id="M000541-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 456</span>
456:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">accounts_not_available</span>
457:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:warning</span>]=<span class="ruby-value str">&quot;We apologize, but the user registration system is not currently available.  Please try again later.&quot;</span>[<span class="ruby-identifier">:user_system_down</span>]
458:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">home_page_url</span>
459:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000505"><br/></a>
<div class="method_block"><h3>
<a href='#M000505'>


allow_page_to_be_cached?

()

</a>
</h3>
<p>
this method determines if the main taxa page is allowed to be cached or not
</p>

<p class="source_link" id="M000505-show-link"><a onclick="toggle('M000505-source'); toggleText('M000505-link'); return false;" href="#" id="M000505-link">Show source...</a></p><div class="source" id="M000505-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 98</span>
 98:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">allow_page_to_be_cached?</span>
 99:     <span class="ruby-operator">!</span>(<span class="ruby-identifier">agent_logged_in?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_admin?</span>) <span class="ruby-comment cmt"># if a content partner or admin is logged in, we do *not* want the page to be cached</span>
100:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000524"><br/></a>
<div class="method_block"><h3>
<a href='#M000524'>


allowed_request

()

</a>
</h3>
<p>
check if the requesting IP address is allowed (used to resrict methods to
specific IPs, such as MBL/<a href="EOL.html">EOL</a> IPs)
</p>

<p class="source_link" id="M000524-show-link"><a onclick="toggle('M000524-source'); toggleText('M000524-link'); return false;" href="#" id="M000524-link">Show source...</a></p><div class="source" id="M000524-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 368</span>
368:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">allowed_request</span>
369:     <span class="ruby-operator">!</span>((<span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/127.0.0.1/</span>).<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/128.128./</span>).<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/10.19./</span>).<span class="ruby-identifier">nil?</span>)
370:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000532"><br/></a>
<div class="method_block"><h3>
<a href='#M000532'>


check_authentication

()

</a>
</h3>

<p class="source_link" id="M000532-show-link"><a onclick="toggle('M000532-source'); toggleText('M000532-link'); return false;" href="#" id="M000532-link">Show source...</a></p><div class="source" id="M000532-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 412</span>
412:  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_authentication</span>
413:      <span class="ruby-identifier">must_log_in</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">logged_in?</span> 
414:      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
415:  <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000519"><br/></a>
<div class="method_block"><h3>
<a href='#M000519'>


clear_all_caches

()

</a>
</h3>
<p>
just clear all fragment caches quickly
</p>

<p class="source_link" id="M000519-show-link"><a onclick="toggle('M000519-source'); toggleText('M000519-link'); return false;" href="#" id="M000519-link">Show source...</a></p><div class="source" id="M000519-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 257</span>
257:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clear_all_caches</span>
258:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">cache_store</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Cache</span><span class="ruby-operator">::</span><span class="ruby-constant">MemCacheStore</span>  
259:       <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">cache_store</span>.<span class="ruby-identifier">clear</span>  
260:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
261:     <span class="ruby-keyword kw">else</span>
262:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
263:     <span class="ruby-keyword kw">end</span>
264:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000530"><br/></a>
<div class="method_block"><h3>
<a href='#M000530'>


clear_any_logged_in_session

()

</a>
</h3>
<p>
this method is used as a before_filter when user logins are disabled to
ensure users who may have had a previous session before we switched off
user logins is booted out
</p>

<p class="source_link" id="M000530-show-link"><a onclick="toggle('M000530-source'); toggleText('M000530-link'); return false;" href="#" id="M000530-link">Show source...</a></p><div class="source" id="M000530-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 400</span>
400:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clear_any_logged_in_session</span>
401:     <span class="ruby-identifier">reset_session</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logged_in?</span>
402:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000514"><br/></a>
<div class="method_block"><h3>
<a href='#M000514'>


collected_errors

(model_object)

</a>
</h3>

<p class="source_link" id="M000514-show-link"><a onclick="toggle('M000514-source'); toggleText('M000514-link'); return false;" href="#" id="M000514-link">Show source...</a></p><div class="source" id="M000514-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 191</span>
191:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">collected_errors</span>(<span class="ruby-identifier">model_object</span>)
192:     <span class="ruby-identifier">error_list</span>=<span class="ruby-value str">''</span>
193:     <span class="ruby-identifier">model_object</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">attr</span>,<span class="ruby-identifier">msg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">error_list</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;#{attr} #{msg},&quot;</span> }
194:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">error_list</span>.<span class="ruby-identifier">chomp</span>(<span class="ruby-value str">','</span>)
195:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000547"><br/></a>
<div class="method_block"><h3>
<a href='#M000547'>


convert_to_nbsp

(input_string)

</a>
</h3>

<p class="source_link" id="M000547-show-link"><a onclick="toggle('M000547-source'); toggleText('M000547-link'); return false;" href="#" id="M000547-link">Show source...</a></p><div class="source" id="M000547-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 514</span>
514:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">convert_to_nbsp</span>(<span class="ruby-identifier">input_string</span>)
515:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">input_string</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
516:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">input_string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'&amp;'</span>, <span class="ruby-value str">'&amp;amp;'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">' '</span>,<span class="ruby-value str">'&amp;nbsp;'</span>)
517:       <span class="ruby-keyword kw">else</span> 
518:         <span class="ruby-keyword kw">return</span> <span class="ruby-value str">''</span>
519:       <span class="ruby-keyword kw">end</span>
520:     <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000526"><br/></a>
<div class="method_block"><h3>
<a href='#M000526'>


create_new_user

()

</a>
</h3>
<p>
default new user when we don&#8216;t have a logged in user
</p>

<p class="source_link" id="M000526-show-link"><a onclick="toggle('M000526-source'); toggleText('M000526-link'); return false;" href="#" id="M000526-link">Show source...</a></p><div class="source" id="M000526-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 378</span>
378:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_new_user</span>
379:      <span class="ruby-identifier">new_user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">create_new</span>(<span class="ruby-identifier">:remote_ip=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>)  
380:      <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user</span>]=<span class="ruby-identifier">new_user</span>
381:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000510"><br/></a>
<div class="method_block"><h3>
<a href='#M000510'>


current_url

()

</a>
</h3>
<p>
get the full current url being shown
</p>

<p class="source_link" id="M000510-show-link"><a onclick="toggle('M000510-source'); toggleText('M000510-link'); return false;" href="#" id="M000510-link">Show source...</a></p><div class="source" id="M000510-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 154</span>
154:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_url</span>
155:     <span class="ruby-identifier">url_for</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">controller_name</span>, <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">action_name</span>)
156:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000528"><br/></a>
<div class="method_block"><h3>
<a href='#M000528'>


current_user

()

</a>
</h3>
<p>
return currently logged in user
</p>

<p class="source_link" id="M000528-show-link"><a onclick="toggle('M000528-source'); toggleText('M000528-link'); return false;" href="#" id="M000528-link">Show source...</a></p><div class="source" id="M000528-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 389</span>
389:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_user</span>
390:     <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user</span>]
391:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000545"><br/></a>
<div class="method_block"><h3>
<a href='#M000545'>


escape_javascript

(javascript)

</a>
</h3>
<p>
pulled over from Rails core helper file so it can be used in controllers as
well
</p>

<p class="source_link" id="M000545-show-link"><a onclick="toggle('M000545-source'); toggleText('M000545-link'); return false;" href="#" id="M000545-link">Show source...</a></p><div class="source" id="M000545-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 494</span>
494:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">escape_javascript</span>(<span class="ruby-identifier">javascript</span>)
495:        (<span class="ruby-identifier">javascript</span> <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'\\'</span>,<span class="ruby-value str">'\0\0'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'&lt;/'</span>,<span class="ruby-value str">'&lt;\/'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\r\n|\n|\r/</span>, <span class="ruby-value str">&quot;\\n&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[&quot;']/</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;\\#{m}&quot;</span> }  
496:     <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000518"><br/></a>
<div class="method_block"><h3>
<a href='#M000518'>


expire_cache

(page_name)

</a>
</h3>
<p>
expire a single non-species page fragment cache
</p>

<p class="source_link" id="M000518-show-link"><a onclick="toggle('M000518-source'); toggleText('M000518-link'); return false;" href="#" id="M000518-link">Show source...</a></p><div class="source" id="M000518-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 241</span>
241:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">expire_cache</span>(<span class="ruby-identifier">page_name</span>)
242: 
243:     <span class="ruby-identifier">pages</span>=<span class="ruby-constant">ContentPage</span>.<span class="ruby-identifier">find_all_by_page_name</span>(<span class="ruby-identifier">page_name</span>)
244:     
245:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> 
246:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">language</span> <span class="ruby-keyword kw">in</span> <span class="ruby-constant">Language</span>.<span class="ruby-identifier">find_active</span>
247:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">page</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">pages</span>
248:           <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'/content'</span>,<span class="ruby-identifier">:part=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">language</span>.<span class="ruby-identifier">iso_639_1</span>)
249:           <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'/content'</span>,<span class="ruby-identifier">:part=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">page_url</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">language</span>.<span class="ruby-identifier">iso_639_1</span>)
250:         <span class="ruby-keyword kw">end</span>
251:       <span class="ruby-keyword kw">end</span>
252:     <span class="ruby-keyword kw">end</span>
253:                
254:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000521"><br/></a>
<div class="method_block"><h3>
<a href='#M000521'>


expire_caches

()

</a>
</h3>
<p>
expire the non-species page fragment caches
</p>

<p class="source_link" id="M000521-show-link"><a onclick="toggle('M000521-source'); toggleText('M000521-link'); return false;" href="#" id="M000521-link">Show source...</a></p><div class="source" id="M000521-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 278</span>
278:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">expire_caches</span>
279: 
280:     <span class="ruby-identifier">expire_menu_caches</span>
281:     <span class="ruby-identifier">pages</span>=<span class="ruby-constant">ContentPage</span>.<span class="ruby-identifier">find_all_by_active</span>(<span class="ruby-keyword kw">true</span>)
282: 
283:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">language</span> <span class="ruby-keyword kw">in</span> <span class="ruby-constant">Language</span>.<span class="ruby-identifier">find_active</span>
284:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">page</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">pages</span>
285:         <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'/content'</span>,<span class="ruby-identifier">:part=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">language</span>.<span class="ruby-identifier">iso_639_1</span>)
286:         <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'/content'</span>,<span class="ruby-identifier">:part=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">page</span>.<span class="ruby-identifier">page_url</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">language</span>.<span class="ruby-identifier">iso_639_1</span>)
287:       <span class="ruby-keyword kw">end</span>
288:     <span class="ruby-keyword kw">end</span>
289: 
290:     <span class="ruby-identifier">$CACHE_CLEARED_LAST</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
291:            
292:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000520"><br/></a>
<div class="method_block"><h3>
<a href='#M000520'>


expire_menu_caches

()

</a>
</h3>
<p>
expire the header and footer caches
</p>

<p class="source_link" id="M000520-show-link"><a onclick="toggle('M000520-source'); toggleText('M000520-link'); return false;" href="#" id="M000520-link">Show source...</a></p><div class="source" id="M000520-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 267</span>
267:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">expire_menu_caches</span>
268:   
269:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">language</span> <span class="ruby-keyword kw">in</span> <span class="ruby-constant">Language</span>.<span class="ruby-identifier">find_active</span>
270:       <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'/content'</span> ,<span class="ruby-identifier">:part</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'top_nav_'</span><span class="ruby-operator">+</span><span class="ruby-identifier">language</span>.<span class="ruby-identifier">iso_639_1</span>)
271:       <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'/content'</span> ,<span class="ruby-identifier">:part</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'footer_'</span><span class="ruby-operator">+</span><span class="ruby-identifier">language</span>.<span class="ruby-identifier">iso_639_1</span>) 
272:       <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'/content'</span> ,<span class="ruby-identifier">:part</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'exemplars_'</span><span class="ruby-operator">+</span><span class="ruby-identifier">language</span>.<span class="ruby-identifier">iso_639_1</span>)
273:     <span class="ruby-keyword kw">end</span>
274:     
275:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000522"><br/></a>
<div class="method_block"><h3>
<a href='#M000522'>


expire_taxa

(taxa_ids,params={})

</a>
</h3>
<p>
expire a list of taxa_ids specifed as an array (add
:expire_ancestors=&gt;false if you don&#8216;t want to expire that
taxon&#8216;s ancestors as well) TODO &#8212; optimize, this will result in
a lot of queries if you expire a lot of taxa
</p>

<p class="source_link" id="M000522-show-link"><a onclick="toggle('M000522-source'); toggleText('M000522-link'); return false;" href="#" id="M000522-link">Show source...</a></p><div class="source" id="M000522-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 297</span>
297:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">expire_taxa</span>(<span class="ruby-identifier">taxa_ids</span>,<span class="ruby-identifier">params</span>={})
298: 
299:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">taxa_ids</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">taxa_ids</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Array</span>
300:    
301:     <span class="ruby-identifier">expire_ancestors</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:expire_ancestors</span>]
302:     <span class="ruby-identifier">expire_ancestors</span>=<span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:expire_ancestors</span>].<span class="ruby-identifier">blank?</span>
303: 
304:     <span class="ruby-identifier">taxa_ids_to_expire</span>=[]
305:     
306:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expire_ancestors</span> <span class="ruby-comment cmt"># also expire ancestors</span>
307:       <span class="ruby-comment cmt"># go over taxa_ids and find ancestors, and add them to the list</span>
308:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">taxon_id</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">taxa_ids</span>
309:         <span class="ruby-identifier">taxon</span>=<span class="ruby-constant">TaxonConcept</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">taxon_id</span>)
310:         <span class="ruby-identifier">taxa_ids_to_expire</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">ancestry</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">an</span><span class="ruby-operator">|</span> <span class="ruby-identifier">an</span>.<span class="ruby-identifier">taxon_concept_id</span>} <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">nil?</span>
311:       <span class="ruby-keyword kw">end</span>
312:       <span class="ruby-identifier">taxa_ids_to_expire</span>.<span class="ruby-identifier">uniq!</span> <span class="ruby-comment cmt"># eliminate duplicates</span>
313:     <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># don't expire ancestors, so just go through the supplied list and expire those</span>
314:       <span class="ruby-identifier">taxa_ids_to_expire</span>=<span class="ruby-identifier">taxa_ids</span>
315:     <span class="ruby-keyword kw">end</span>
316:     
317:     <span class="ruby-comment cmt"># now expire the list of taxa, ignoring ancestors (since they are now included in our global list)</span>
318:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">taxon_id</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">taxa_ids_to_expire</span>
319:       <span class="ruby-identifier">expire_taxon</span>(<span class="ruby-identifier">taxon_id</span>,<span class="ruby-identifier">:expire_ancestors=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword kw">false</span>)
320:     <span class="ruby-keyword kw">end</span>
321:     
322:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
323:     
324:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000523"><br/></a>
<div class="method_block"><h3>
<a href='#M000523'>


expire_taxon

(taxon_id,params={})

</a>
</h3>
<p>
expire the fragment cache for a specific taxon ID (add
:expire_ancestors=&gt;false if you don&#8216;t want to expire that
taxon&#8216;s ancestors as well) TODO &#8212; come up with a better way to
expire taxa or name the cached parts &#8212; this expiration process is
very expensive due to all the iterations for each taxa id
</p>

<p class="source_link" id="M000523-show-link"><a onclick="toggle('M000523-source'); toggleText('M000523-link'); return false;" href="#" id="M000523-link">Show source...</a></p><div class="source" id="M000523-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 329</span>
329:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">expire_taxon</span>(<span class="ruby-identifier">taxon_id</span>,<span class="ruby-identifier">params</span>={})
330:    
331:    <span class="ruby-comment cmt">#expire the given taxon_id</span>
332:    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">taxon_id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">taxon_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
333:    
334:    <span class="ruby-identifier">taxon</span>=<span class="ruby-constant">TaxonConcept</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">taxon_id</span>)
335:    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">nil?</span>
336:    
337:    <span class="ruby-identifier">expire_ancestors</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:expire_ancestors</span>]
338:    <span class="ruby-identifier">expire_ancestors</span>=<span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:expire_ancestors</span>].<span class="ruby-identifier">blank?</span>
339:    
340:    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expire_ancestors</span>
341:      <span class="ruby-identifier">taxa_ids</span>=<span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">ancestry</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">an</span><span class="ruby-operator">|</span> <span class="ruby-identifier">an</span>.<span class="ruby-identifier">taxon_concept_id</span>}
342:    <span class="ruby-keyword kw">else</span>
343:      <span class="ruby-identifier">taxa_ids</span>=[<span class="ruby-identifier">taxon_id</span>]
344:    <span class="ruby-keyword kw">end</span>
345:    
346:    <span class="ruby-comment cmt"># expire given taxa for all active languages and possibilites    </span>
347:    <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">taxon_id</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">taxa_ids</span>
348:      <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">taxon_id</span>.<span class="ruby-identifier">blank?</span>
349:        <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">language</span> <span class="ruby-keyword kw">in</span> <span class="ruby-constant">Language</span>.<span class="ruby-identifier">find_active</span>
350:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">expertise</span> <span class="ruby-keyword kw">in</span> <span class="ruby-node">%w{novice middle expert}</span>
351:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">vetted</span> <span class="ruby-keyword kw">in</span> <span class="ruby-node">%w{true false}</span>
352:               <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">default_taxonomic_browser</span> <span class="ruby-keyword kw">in</span> <span class="ruby-node">%w{text flash}</span>
353:                 <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">can_curate</span> <span class="ruby-keyword kw">in</span> <span class="ruby-node">%w{true false}</span>               
354:                   <span class="ruby-identifier">part_name</span>=<span class="ruby-value str">'page_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">taxon_id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">language</span>.<span class="ruby-identifier">iso_639_1</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">expertise</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">vetted</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">default_taxonomic_browser</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'_'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">can_curate</span>
355:                   <span class="ruby-identifier">expire_fragment</span>(<span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'/taxa'</span>,<span class="ruby-identifier">:part=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">part_name</span>)    
356:                 <span class="ruby-keyword kw">end</span>
357:               <span class="ruby-keyword kw">end</span>
358:             <span class="ruby-keyword kw">end</span>
359:           <span class="ruby-keyword kw">end</span>
360:         <span class="ruby-keyword kw">end</span>
361:       <span class="ruby-keyword kw">end</span>
362:     <span class="ruby-keyword kw">end</span>
363:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
364:       
365:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000516"><br/></a>
<div class="method_block"><h3>
<a href='#M000516'>


external_link

()

</a>
</h3>
<p>
called to log and redirect a user to an external link
</p>

<p class="source_link" id="M000516-show-link"><a onclick="toggle('M000516-source'); toggleText('M000516-link'); return false;" href="#" id="M000516-link">Show source...</a></p><div class="source" id="M000516-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 205</span>
205:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">external_link</span>
206:         
207:     <span class="ruby-identifier">url</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:url</span>]
208:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">nil?</span>
209:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:nothing=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword kw">true</span>
210:       <span class="ruby-keyword kw">return</span>
211:     <span class="ruby-keyword kw">end</span>
212:     
213:     <span class="ruby-constant">ExternalLinkLog</span>.<span class="ruby-identifier">log</span> <span class="ruby-identifier">url</span>, <span class="ruby-identifier">request</span>, <span class="ruby-identifier">current_user</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$ENABLE_DATA_LOGGING</span>    
214: 
215:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">url</span>
216:     
217:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000504"><br/></a>
<div class="method_block"><h3>
<a href='#M000504'>


format_date

(date, format = &quot;%m/%d/%Y&quot;)

</a>
</h3>
<p>
Return a formatted date Default format: %m/%d/%Y
</p>

<p class="source_link" id="M000504-show-link"><a onclick="toggle('M000504-source'); toggleText('M000504-link'); return false;" href="#" id="M000504-link">Show source...</a></p><div class="source" id="M000504-source"><pre>    <span class="ruby-comment cmt"># File app/controllers/application.rb, line 93</span>
93:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">format_date</span>(<span class="ruby-identifier">date</span>, <span class="ruby-identifier">format</span> = <span class="ruby-value str">&quot;%m/%d/%Y&quot;</span>)
94:       <span class="ruby-identifier">date</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:strftime</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-identifier">format</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">date</span>.<span class="ruby-identifier">to_s</span>
95:     <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000503"><br/></a>
<div class="method_block"><h3>
<a href='#M000503'>


format_date_time

(inTime,params={})

</a>
</h3>
<p>
end override of exception notifiable default methods
</p>

<p class="source_link" id="M000503-show-link"><a onclick="toggle('M000503-source'); toggleText('M000503-link'); return false;" href="#" id="M000503-link">Show source...</a></p><div class="source" id="M000503-source"><pre>    <span class="ruby-comment cmt"># File app/controllers/application.rb, line 78</span>
78:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">format_date_time</span>(<span class="ruby-identifier">inTime</span>,<span class="ruby-identifier">params</span>={})
79:          <span class="ruby-identifier">format_string</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:format</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;long&quot;</span>
80:          <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">format_string</span>
81:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;short&quot;</span> 
82:             <span class="ruby-identifier">format_string</span>=<span class="ruby-value str">&quot;%m/%d/%Y - %I:%M %p %Z&quot;</span>
83:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;short_no_tz&quot;</span> 
84:             <span class="ruby-identifier">format_string</span>=<span class="ruby-value str">&quot;%m/%d/%Y - %I:%M %p&quot;</span>           
85:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;long&quot;</span>  
86:             <span class="ruby-identifier">format_string</span>=<span class="ruby-value str">&quot;%A, %B %d, %Y - %I:%M %p %Z&quot;</span>
87:          <span class="ruby-keyword kw">end</span>
88:          <span class="ruby-identifier">inTime</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-identifier">format_string</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">inTime</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
89:     <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000506"><br/></a>
<div class="method_block"><h3>
<a href='#M000506'>


get_agent_icons

(data,params={})

</a>
</h3>
<p>
given a hash containing an agent node, returns a list of hyperlinked
&lt;img&gt; tag icons if :linked=&gt;false, only the agent icons are
returned even if links are available if :normal_icon=&gt;true the then
normal sized icon is returned, otherwise the small version is returned
</p>

<p class="source_link" id="M000506-show-link"><a onclick="toggle('M000506-source'); toggleText('M000506-link'); return false;" href="#" id="M000506-link">Show source...</a></p><div class="source" id="M000506-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 105</span>
105:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_agent_icons</span>(<span class="ruby-identifier">data</span>,<span class="ruby-identifier">params</span>={})
106: 
107:      <span class="ruby-identifier">linked</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:linked</span>]
108:      <span class="ruby-identifier">linked</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">linked</span>.<span class="ruby-identifier">nil?</span>
109:      <span class="ruby-identifier">normal_icon</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:normal_icon</span>]
110:      <span class="ruby-identifier">normal_icon</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">normal_icon</span>.<span class="ruby-identifier">nil?</span>
111: 
112:      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">data</span>[<span class="ruby-value str">'agent'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
113:         <span class="ruby-identifier">data</span>=<span class="ruby-constant">EOLConvert</span>.<span class="ruby-identifier">convert_to_hashed_array</span>(<span class="ruby-identifier">data</span>[<span class="ruby-value str">'agent'</span>])
114:         <span class="ruby-identifier">agent_list</span>=<span class="ruby-value str">&quot;&quot;</span>
115:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">agent</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">data</span>
116:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">normal_icon</span>
117:               <span class="ruby-identifier">icon</span>=<span class="ruby-identifier">agent</span>[<span class="ruby-value str">'icon'</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
118:           <span class="ruby-keyword kw">else</span>
119:               <span class="ruby-identifier">icon</span>=<span class="ruby-identifier">agent</span>[<span class="ruby-value str">'smallIcon'</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
120:           <span class="ruby-keyword kw">end</span>
121:           <span class="ruby-identifier">url</span>=<span class="ruby-identifier">agent</span>[<span class="ruby-value str">'agentHomepage'</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
122:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">linked</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">url</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">icon</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span>
123:             <span class="ruby-identifier">agent_list</span><span class="ruby-operator">+=</span><span class="ruby-value str">&quot;&lt;a href=\&quot;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">url</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\&quot; target=\&quot;_blank\&quot;&gt;&quot;</span>
124:           <span class="ruby-keyword kw">end</span>
125:           <span class="ruby-identifier">agent_list</span><span class="ruby-operator">+=</span><span class="ruby-value str">&quot;&lt;img border=\&quot;0\&quot; src=\&quot;/images/collection_icons/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">icon</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\&quot;&gt;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">icon</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span>
126:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">linked</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">url</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">icon</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span>
127:             <span class="ruby-identifier">agent_list</span><span class="ruby-operator">+=</span><span class="ruby-value str">&quot;&lt;/a&gt;&quot;</span>
128:           <span class="ruby-keyword kw">end</span>          
129:           <span class="ruby-identifier">agent_list</span><span class="ruby-operator">+=</span><span class="ruby-value str">&quot;&amp;nbsp;&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">icon</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span>
130:         <span class="ruby-keyword kw">end</span>
131:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">agent_list</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">chop</span>
132:      <span class="ruby-keyword kw">else</span>
133:         <span class="ruby-keyword kw">return</span> <span class="ruby-value str">''</span>
134:      <span class="ruby-keyword kw">end</span>
135: 
136:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000512"><br/></a>
<div class="method_block"><h3>
<a href='#M000512'>


get_image_url

(image_item)

</a>
</h3>
<p>
get the local or remote image URL based on our preference setting
</p>

<p class="source_link" id="M000512-show-link"><a onclick="toggle('M000512-source'); toggleText('M000512-link'); return false;" href="#" id="M000512-link">Show source...</a></p><div class="source" id="M000512-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 173</span>
173:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_image_url</span>(<span class="ruby-identifier">image_item</span>)
174:       <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">$PREFER_REMOTE_IMAGES</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">image_item</span>[<span class="ruby-value str">'remoteURL'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-identifier">image_item</span>[<span class="ruby-value str">'localURL'</span>].<span class="ruby-identifier">nil?</span>)
175:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">image_item</span>[<span class="ruby-value str">'remoteURL'</span>]
176:       <span class="ruby-keyword kw">else</span>
177:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">image_item</span>[<span class="ruby-value str">'localURL'</span>]
178:       <span class="ruby-keyword kw">end</span>
179:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000513"><br/></a>
<div class="method_block"><h3>
<a href='#M000513'>


get_video_url

(video_item)

</a>
</h3>
<p>
get the local or remote image URL based on the type of video
</p>

<p class="source_link" id="M000513-show-link"><a onclick="toggle('M000513-source'); toggleText('M000513-link'); return false;" href="#" id="M000513-link">Show source...</a></p><div class="source" id="M000513-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 182</span>
182:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_video_url</span>(<span class="ruby-identifier">video_item</span>)
183:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">video_item</span>[<span class="ruby-value str">'videoType'</span>].<span class="ruby-identifier">downcase</span>    
184:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;youtube&quot;</span>
185:          <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">video_item</span>[<span class="ruby-value str">'remoteURL'</span>]
186:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;flash&quot;</span>
187:          <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">video_item</span>[<span class="ruby-value str">'localURL'</span>]
188:     <span class="ruby-keyword kw">end</span>
189:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000539"><br/></a>
<div class="method_block"><h3>
<a href='#M000539'>


go_to_home_page_if_logged_in

()

</a>
</h3>
<p>
used as a before_filter on methods that you don&#8216;t want users to see
if they are logged in (such as the login or register page)
</p>

<p class="source_link" id="M000539-show-link"><a onclick="toggle('M000539-source'); toggleText('M000539-link'); return false;" href="#" id="M000539-link">Show source...</a></p><div class="source" id="M000539-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 445</span>
445:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">go_to_home_page_if_logged_in</span>   
446:       <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">home_page_url</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logged_in?</span>
447:    <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000500"><br/></a>
<div class="method_block"><h3>
<a href='#M000500'>


hh

(input)

</a>
</h3>
<p>
similar to h, but does not escape html code which is helpful for showing
italisized names
</p>

<p class="source_link" id="M000500-show-link"><a onclick="toggle('M000500-source'); toggleText('M000500-link'); return false;" href="#" id="M000500-link">Show source...</a></p><div class="source" id="M000500-source"><pre>    <span class="ruby-comment cmt"># File app/controllers/application.rb, line 39</span>
39: <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hh</span>(<span class="ruby-identifier">input</span>) 
40:   <span class="ruby-identifier">result</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">strip</span> 
41: 
42:   <span class="ruby-identifier">result</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/[&quot;]|&amp;(?![\w]+;)/</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">match</span> <span class="ruby-operator">|</span> 
43:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">match</span> 
44:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'&amp;'</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'&amp;amp;'</span> 
45:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'&quot;'</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value str">'&amp;quot;'</span> 
46:     <span class="ruby-keyword kw">end</span>
47:   <span class="ruby-keyword kw">end</span>
48:   <span class="ruby-identifier">result</span>
49: <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000536"><br/></a>
<div class="method_block"><h3>
<a href='#M000536'>


is_curator

(tc, user = nil)

</a>
</h3>
<p>
Alias for <a href="ApplicationController.html#M000536">is_curator</a>?
</p>

</div>

<a class="small" name="M000535"><br/></a>
<div class="method_block"><h3>
<a href='#M000535'>


is_curator?

(tc, user = nil)

</a>
</h3>
<p>
Returns true if the given user (or currently logged in user if not
provided) has curator permissions for the given <a
href="TaxonConcept.html">TaxonConcept</a> or any parent thereof.
</p>

<p class="source_link" id="M000535-show-link"><a onclick="toggle('M000535-source'); toggleText('M000535-link'); return false;" href="#" id="M000535-link">Show source...</a></p><div class="source" id="M000535-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 428</span>
428:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_curator?</span>(<span class="ruby-identifier">tc</span>, <span class="ruby-identifier">user</span> = <span class="ruby-keyword kw">nil</span>)
429:     <span class="ruby-identifier">user</span> = <span class="ruby-identifier">current_user</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
430:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
431:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">TaxonConcept</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">User</span>)
432:     <span class="ruby-identifier">user</span>.<span class="ruby-identifier">can_curate?</span> <span class="ruby-identifier">tc</span>
433:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000534"><br/></a>
<div class="method_block"><h3>
<a href='#M000534'>


is_user_admin?

()

</a>
</h3>

<p class="source_link" id="M000534-show-link"><a onclick="toggle('M000534-source'); toggleText('M000534-link'); return false;" href="#" id="M000534-link">Show source...</a></p><div class="source" id="M000534-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 422</span>
422:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_user_admin?</span>
423:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">is_user_in_role?</span>(<span class="ruby-value str">&quot;Administrator&quot;</span>)
424:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000533"><br/></a>
<div class="method_block"><h3>
<a href='#M000533'>


is_user_in_role?

(role)

</a>
</h3>
<p>
check membership in a specific role
</p>

<p class="source_link" id="M000533-show-link"><a onclick="toggle('M000533-source'); toggleText('M000533-link'); return false;" href="#" id="M000533-link">Show source...</a></p><div class="source" id="M000533-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 418</span>
418:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_user_in_role?</span>(<span class="ruby-identifier">role</span>)
419:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">roles</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-constant">Role</span>.<span class="ruby-identifier">find_by_title</span>(<span class="ruby-identifier">role</span>)) 
420:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000531"><br/></a>
<div class="method_block"><h3>
<a href='#M000531'>


logged_in?

()

</a>
</h3>
<p>
check to see if we have a logged in user
</p>

<p class="source_link" id="M000531-show-link"><a onclick="toggle('M000531-source'); toggleText('M000531-link'); return false;" href="#" id="M000531-link">Show source...</a></p><div class="source" id="M000531-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 408</span>
408:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">logged_in?</span>
409:     <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">nil?</span>
410:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000540"><br/></a>
<div class="method_block"><h3>
<a href='#M000540'>


must_log_in

()

</a>
</h3>

<p class="source_link" id="M000540-show-link"><a onclick="toggle('M000540-source'); toggleText('M000540-link'); return false;" href="#" id="M000540-link">Show source...</a></p><div class="source" id="M000540-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 449</span>
449:    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">must_log_in</span>
450:       <span class="ruby-identifier">store_location</span>
451:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">login_url</span>
452:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
453:    <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000537"><br/></a>
<div class="method_block"><h3>
<a href='#M000537'>


permission_denied

()

</a>
</h3>

<p class="source_link" id="M000537-show-link"><a onclick="toggle('M000537-source'); toggleText('M000537-link'); return false;" href="#" id="M000537-link">Show source...</a></p><div class="source" id="M000537-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 436</span>
436:  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">permission_denied</span>
437:    <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;You don't have privileges to access this action&quot;</span>
438:    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">home_page_url</span>)
439:  <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000538"><br/></a>
<div class="method_block"><h3>
<a href='#M000538'>


permission_granted

()

</a>
</h3>

<p class="source_link" id="M000538-show-link"><a onclick="toggle('M000538-source'); toggleText('M000538-link'); return false;" href="#" id="M000538-link">Show source...</a></p><div class="source" id="M000538-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 441</span>
441:  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">permission_granted</span>
442:  <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000511"><br/></a>
<div class="method_block"><h3>
<a href='#M000511'>


redirect_back_or_default

(default=home_page_url)

</a>
</h3>
<p>
Redirect to the URL stored by the most recent <a
href="ApplicationController.html#M000508">store_location</a> call or to the
passed default.
</p>

<p class="source_link" id="M000511-show-link"><a onclick="toggle('M000511-source'); toggleText('M000511-link'); return false;" href="#" id="M000511-link">Show source...</a></p><div class="source" id="M000511-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 159</span>
159:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">redirect_back_or_default</span>(<span class="ruby-identifier">default</span>=<span class="ruby-identifier">home_page_url</span>)
160: 
161:     <span class="ruby-comment cmt"># be sure we aren't returning the login, register or logout page</span>
162:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">return_to_url</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">return_to_url</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">login_url</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">return_to_url</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">register_url</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">return_to_url</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">logout_url</span>
163:       <span class="ruby-identifier">redirect_to</span>(<span class="ruby-constant">CGI</span>.<span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">return_to_url</span>))
164:     <span class="ruby-keyword kw">else</span>
165:       <span class="ruby-identifier">redirect_to</span>(<span class="ruby-identifier">default</span>)
166:     <span class="ruby-keyword kw">end</span>
167:     <span class="ruby-identifier">store_location</span>(<span class="ruby-keyword kw">nil</span>)
168:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
169:     
170:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000525"><br/></a>
<div class="method_block"><h3>
<a href='#M000525'>


redirect_to_ssl

()

</a>
</h3>
<p>
send user to the SSL version of the page (used in the account controller,
can be used elsewhere)
</p>

<p class="source_link" id="M000525-show-link"><a onclick="toggle('M000525-source'); toggleText('M000525-link'); return false;" href="#" id="M000525-link">Show source...</a></p><div class="source" id="M000525-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 373</span>
373:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">redirect_to_ssl</span>
374:      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:protocol</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;https://&quot;</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">request</span>.<span class="ruby-identifier">ssl?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">local_request?</span>)
375:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000507"><br/></a>
<div class="method_block"><h3>
<a href='#M000507'>


remove_html

(input_string)

</a>
</h3>
<p>
remove HTML from the given string
</p>

<p class="source_link" id="M000507-show-link"><a onclick="toggle('M000507-source'); toggleText('M000507-link'); return false;" href="#" id="M000507-link">Show source...</a></p><div class="source" id="M000507-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 139</span>
139:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_html</span>(<span class="ruby-identifier">input_string</span>)
140:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">input_string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/(&lt;[^&gt;]*&gt;)|\n|\t/s</span>) {<span class="ruby-value str">&quot;&quot;</span>}.<span class="ruby-identifier">strip</span>  
141:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000501"><br/></a>
<div class="method_block"><h3>
<a href='#M000501'>


render_404

()

</a>
</h3>
<p>
override exception notifiable default methods to redirect to our special
error pages instead of the usual 404 and 500 and to do error logging
</p>

<p class="source_link" id="M000501-show-link"><a onclick="toggle('M000501-source'); toggleText('M000501-link'); return false;" href="#" id="M000501-link">Show source...</a></p><div class="source" id="M000501-source"><pre>    <span class="ruby-comment cmt"># File app/controllers/application.rb, line 52</span>
52:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render_404</span>
53:       <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span><span class="ruby-operator">|</span>
54:         <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-identifier">:warning</span>]=<span class="ruby-value str">&quot;The page you have requested does not exist.&quot;</span>
55:         <span class="ruby-identifier">type</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:template</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;content/error&quot;</span> }
56:         <span class="ruby-identifier">type</span>.<span class="ruby-identifier">all</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:nothing</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;404 Not Found&quot;</span> }
57:       <span class="ruby-keyword kw">end</span>
58:     <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000502"><br/></a>
<div class="method_block"><h3>
<a href='#M000502'>


render_500

(exception=nil)

</a>
</h3>

<p class="source_link" id="M000502-show-link"><a onclick="toggle('M000502-source'); toggleText('M000502-link'); return false;" href="#" id="M000502-link">Show source...</a></p><div class="source" id="M000502-source"><pre>    <span class="ruby-comment cmt"># File app/controllers/application.rb, line 60</span>
60:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render_500</span>(<span class="ruby-identifier">exception</span>=<span class="ruby-keyword kw">nil</span>)  
61:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$ERROR_LOGGING</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">$IGNORED_EXCEPTIONS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">exception</span>.<span class="ruby-identifier">to_s</span>)
62:          <span class="ruby-constant">ErrorLog</span>.<span class="ruby-identifier">create</span>(
63:            <span class="ruby-identifier">:url=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">url</span>,
64:            <span class="ruby-identifier">:ip_address=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>,
65:            <span class="ruby-identifier">:user_agent=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">user_agent</span>,
66:            <span class="ruby-identifier">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>,
67:            <span class="ruby-identifier">:exception_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">exception</span>.<span class="ruby-identifier">to_s</span>,
68:            <span class="ruby-identifier">:backtrace=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;Application Server: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">$IP_ADDRESS_OF_SERVER</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\r\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">exception</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">to_s</span>
69:            ) 
70:        <span class="ruby-keyword kw">end</span>
71:       <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span><span class="ruby-operator">|</span>
72:        <span class="ruby-identifier">type</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:template</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;content/error&quot;</span> }
73:        <span class="ruby-identifier">type</span>.<span class="ruby-identifier">all</span>  { <span class="ruby-identifier">render</span> <span class="ruby-identifier">:nothing</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;500 Error&quot;</span> }
74:       <span class="ruby-keyword kw">end</span>
75:     <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000527"><br/></a>
<div class="method_block"><h3>
<a href='#M000527'>


reset_session

()

</a>
</h3>

<p class="source_link" id="M000527-show-link"><a onclick="toggle('M000527-source'); toggleText('M000527-link'); return false;" href="#" id="M000527-link">Show source...</a></p><div class="source" id="M000527-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 383</span>
383:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_session</span>
384:       <span class="ruby-identifier">create_new_user</span>
385:       <span class="ruby-identifier">current_agent</span>=<span class="ruby-keyword kw">nil</span>
386:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000509"><br/></a>
<div class="method_block"><h3>
<a href='#M000509'>


return_to_url

()

</a>
</h3>
<p>
retrieve the stored URL that we want to go back to
</p>

<p class="source_link" id="M000509-show-link"><a onclick="toggle('M000509-source'); toggleText('M000509-link'); return false;" href="#" id="M000509-link">Show source...</a></p><div class="source" id="M000509-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 149</span>
149:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">return_to_url</span>
150:     <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:return_to</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">home_page_url</span>
151:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000529"><br/></a>
<div class="method_block"><h3>
<a href='#M000529'>


set_current_user

(user)

</a>
</h3>
<p>
set current user in session
</p>

<p class="source_link" id="M000529-show-link"><a onclick="toggle('M000529-source'); toggleText('M000529-link'); return false;" href="#" id="M000529-link">Show source...</a></p><div class="source" id="M000529-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 394</span>
394:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_current_user</span>(<span class="ruby-identifier">user</span>)
395:     <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user</span>]=<span class="ruby-identifier">user</span>
396:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000544"><br/></a>
<div class="method_block"><h3>
<a href='#M000544'>


set_flash_enabled

()

</a>
</h3>
<p>
ajax call to set the session variable for the user to indicate if flash is
enabled or not
</p>

<p class="source_link" id="M000544-show-link"><a onclick="toggle('M000544-source'); toggleText('M000544-link'); return false;" href="#" id="M000544-link">Show source...</a></p><div class="source" id="M000544-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 482</span>
482:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_flash_enabled</span>
483:     <span class="ruby-identifier">flash_enabled</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:flash_enabled</span>]
484:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">EOLConvert</span>.<span class="ruby-identifier">to_boolean</span>(<span class="ruby-identifier">flash_enabled</span>)
485:       <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">flash_enabled</span> = <span class="ruby-keyword kw">true</span>
486:     <span class="ruby-keyword kw">else</span>
487:       <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">flash_enabled</span> = <span class="ruby-keyword kw">false</span>
488:       <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">default_taxonomic_browser</span>=<span class="ruby-value str">&quot;text&quot;</span>
489:     <span class="ruby-keyword kw">end</span>  
490:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:nothing=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword kw">true</span>
491:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000543"><br/></a>
<div class="method_block"><h3>
<a href='#M000543'>


set_language

()

</a>
</h3>
<p>
Set the current language
</p>

<p class="source_link" id="M000543-show-link"><a onclick="toggle('M000543-source'); toggleText('M000543-link'); return false;" href="#" id="M000543-link">Show source...</a></p><div class="source" id="M000543-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 470</span>
470:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_language</span>
471:     <span class="ruby-identifier">language</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:language</span>].<span class="ruby-identifier">to_s</span>
472:     <span class="ruby-identifier">languages</span> = <span class="ruby-constant">Gibberish</span>.<span class="ruby-identifier">languages</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">to_s</span> } <span class="ruby-operator">+</span> [<span class="ruby-value str">&quot;en&quot;</span>]
473:     <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">language</span> = <span class="ruby-constant">Language</span>.<span class="ruby-identifier">find_by_iso_639_1</span>(<span class="ruby-identifier">language</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">languages</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">language</span>)
474:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:return_to</span>].<span class="ruby-identifier">blank?</span>
475:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:nothing</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
476:     <span class="ruby-keyword kw">else</span>
477:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:return_to</span>])      
478:     <span class="ruby-keyword kw">end</span>
479:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000517"><br/></a>
<div class="method_block"><h3>
<a href='#M000517'>


set_session

()

</a>
</h3>
<p>
check to see if a session exists, and create if it not
</p>
<pre>
 even non-logged in users get a session to store their expertise and language preferences
</pre>

<p class="source_link" id="M000517-show-link"><a onclick="toggle('M000517-source'); toggleText('M000517-link'); return false;" href="#" id="M000517-link">Show source...</a></p><div class="source" id="M000517-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 221</span>
221:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_session</span>
222:      
223:     <span class="ruby-comment cmt"># if we don't have a session yet, create it, set taxa views to 0 for this user, and increment number of unique visitors</span>
224:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> 
225:       
226:        <span class="ruby-identifier">create_new_user</span>  
227:        <span class="ruby-identifier">clear_old_sessions</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$USE_SQL_SESSION_MANAGEMENT</span>
228:        <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:page_views</span>]=<span class="ruby-value">0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$SHOW_SURVEYS</span>  <span class="ruby-comment cmt"># if we are showing surveys, we need to record how many page views this user has done        </span>
229:                    
230:        <span class="ruby-comment cmt"># expire home page fragment caches after specified internal to keep it fresh</span>
231:        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$CACHE_CLEARED_LAST</span>.<span class="ruby-identifier">advance</span>(<span class="ruby-identifier">:hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">$CACHE_CLEAR_IN_HOURS</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
232:          <span class="ruby-identifier">expire_cache</span>(<span class="ruby-value str">'home'</span>) 
233:          <span class="ruby-identifier">$CACHE_CLEARED_LAST</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
234:        <span class="ruby-keyword kw">end</span>    
235:        
236:     <span class="ruby-keyword kw">end</span>
237:     
238:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000546"><br/></a>
<div class="method_block"><h3>
<a href='#M000546'>


show_survey?

()

</a>
</h3>
<p>
we are going to keep track of how many taxa pages the user has seen so we
can determine if we are going to show the survey link or not this defines
our logic for if we show a survey or not on this page view
</p>

<p class="source_link" id="M000546-show-link"><a onclick="toggle('M000546-source'); toggleText('M000546-link'); return false;" href="#" id="M000546-link">Show source...</a></p><div class="source" id="M000546-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 500</span>
500:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show_survey?</span>
501: 
502:       <span class="ruby-comment cmt"># show survey on third taxa page view if not logged in and if not already asked before according to the cookie value</span>
503:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:page_views</span>] <span class="ruby-operator">==</span> <span class="ruby-value">3</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-identifier">:survey_taken</span>].<span class="ruby-identifier">nil?</span>
504:         <span class="ruby-comment cmt"># if we are counting visitors, show survey every tenth visitor, if not, show it 10% of the time at random</span>
505:         <span class="ruby-keyword kw">if</span>  <span class="ruby-identifier">rand</span>(<span class="ruby-value">0</span>)<span class="ruby-operator">&lt;</span><span class="ruby-value">0</span><span class="ruby-value">.1</span>
506:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
507:         <span class="ruby-keyword kw">else</span>
508:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
509:         <span class="ruby-keyword kw">end</span>
510:       <span class="ruby-keyword kw">end</span>   
511: 
512:     <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000508"><br/></a>
<div class="method_block"><h3>
<a href='#M000508'>


store_location

(url=current_url)

</a>
</h3>
<p>
store a given URL (defaults to current) in case we need to redirect back
later
</p>

<p class="source_link" id="M000508-show-link"><a onclick="toggle('M000508-source'); toggleText('M000508-link'); return false;" href="#" id="M000508-link">Show source...</a></p><div class="source" id="M000508-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 144</span>
144:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">store_location</span>(<span class="ruby-identifier">url</span>=<span class="ruby-identifier">current_url</span>)
145:       <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:return_to</span>]=<span class="ruby-identifier">url</span>
146:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000515"><br/></a>
<div class="method_block"><h3>
<a href='#M000515'>


truncate

(text, length = 30, truncate_string = &quot;...&quot;)

</a>
</h3>
<p>
<a href="ApplicationController.html#M000515">truncate</a> a string to the
maxlength passed and then add &quot;&#8230;&quot; if truncated
</p>

<p class="source_link" id="M000515-show-link"><a onclick="toggle('M000515-source'); toggleText('M000515-link'); return false;" href="#" id="M000515-link">Show source...</a></p><div class="source" id="M000515-source"><pre>     <span class="ruby-comment cmt"># File app/controllers/application.rb, line 198</span>
198:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">length</span> = <span class="ruby-value">30</span>, <span class="ruby-identifier">truncate_string</span> = <span class="ruby-value str">&quot;...&quot;</span>)
199:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">nil?</span>
200:     <span class="ruby-identifier">l</span> = <span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">truncate_string</span>.<span class="ruby-identifier">chars</span>.<span class="ruby-identifier">length</span>
201:     <span class="ruby-identifier">text</span>.<span class="ruby-identifier">chars</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">length</span> <span class="ruby-value">? </span><span class="ruby-identifier">text</span>[<span class="ruby-node">/\A.{#{l}}\w*\;?/</span><span class="ruby-identifier">m</span>][<span class="ruby-regexp re">/.*[\w\;]/</span><span class="ruby-identifier">m</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">truncate_string</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">text</span>
202:   <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000499"><br/></a>
<div class="method_block"><h3>
<a href='#M000499'>


verify_recaptcha

()

</a>
</h3>

<p class="source_link" id="M000499-show-link"><a onclick="toggle('M000499-source'); toggleText('M000499-link'); return false;" href="#" id="M000499-link">Show source...</a></p><div class="source" id="M000499-source"><pre>    <span class="ruby-comment cmt"># File app/controllers/application.rb, line 21</span>
21:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">verify_recaptcha</span>
22:       <span class="ruby-keyword kw">true</span>
23:     <span class="ruby-keyword kw">end</span></pre></div>
</div>





</div><div class="clear" id="footer">Generated on Jan 21, 2008 / Allison 2 &copy; 2007 <a href="http://cloudbur.st">Cloudburst, LLC</a></div></div></body></html>