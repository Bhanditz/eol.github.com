<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Class: TaxonConcept [Rails Application Documentation]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='.././rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          TaxonConcept
        </h1>
        <ol class='paths'>
          <li>
            <a href="../files/app/models/taxon_concept_rb.html">app/models/taxon_concept.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a href="SpeciesSchemaModel.html">SpeciesSchemaModel</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            Represents the vague idea of a <a href="Taxon.html">Taxon</a>.
            </p>
            <p>
            We get different interpretations of taxa from our partners (<a
            href="ContentPartner.html">ContentPartner</a>), often differing slightly
            and referring to basically the same thing, so <a
            href="TaxonConcept.html">TaxonConcept</a> was created as a means to
            reconcile the variant definitions of what are essentially the same <a
            href="Taxon.html">Taxon</a>. We currently store basic <a
            href="Taxon.html">Taxon</a> we receive from data imports in the
            <tt>taxa</tt> table and we also store taxonomic hierarchies (<a
            href="HierarchyEntry.html">HierarchyEntry</a>) in the
            <tt>hierarchy_entries</tt> table. Currently <a
            href="TaxonConcept.html">TaxonConcept</a> are groups of one or many <a
            href="HierarchyEntry.html">HierarchyEntry</a>. We will eventually create
            hierarchy_entries for each entry in the taxa table (<a
            href="Taxon.html">Taxon</a>).
            </p>
            <p>
            It is worth mentioning that the &#8220;eol.org/page/nnnn&#8220; route is a
            misnomer. Those IDs are, for the time-being, pointing to TaxonConcepts.
            </p>
            <p>
            See the comments at the top of the <a href="Taxon.html">Taxon</a> for more
            information on this. I include there a basic biological definition of what
            a <a href="Taxon.html">Taxon</a> is.
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000485">direct_ancestors</a></li>
              <li><a href="#M000487">exemplars</a></li>
              <li><a href="#M000466">find_with_supercedure</a></li>
              <li><a href="#M000467">quick_search</a></li>
              <li><a href="#M000488">search</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000489">&lt;=&gt;</a></li>
              <li><a href="#M000479">agent_url</a></li>
              <li><a href="#M000443">alternate_classification_name</a></li>
              <li><a href="#M000471">ancestry</a></li>
              <li><a href="#M000447">approved_curators</a></li>
              <li><a href="#M000459">available_media</a></li>
              <li><a href="#M000463">canonical_form</a></li>
              <li><a href="#M000472">classification_attribution</a></li>
              <li><a href="#M000456">col_entry</a></li>
              <li><a href="#M000483">comment</a></li>
              <li><a href="#M000461">common_name</a></li>
              <li><a href="#M000474">content_by_category</a></li>
              <li><a href="#M000484">content_level</a></li>
              <li><a href="#M000458">current_agent=</a></li>
              <li><a href="#M000470">current_node</a></li>
              <li><a href="#M000457">current_user=</a></li>
              <li><a href="#M000455">entry</a></li>
              <li><a href="#M000450">has_citation?</a></li>
              <li><a href="#M000460">has_name?</a></li>
              <li><a href="#M000449">hierarchy_entries_with_ancestors</a></li>
              <li><a href="#M000448">hierarchy_entries_with_parents</a></li>
              <li><a href="#M000475">images</a></li>
              <li><a href="#M000444">in_hierarchy</a></li>
              <li><a href="#M000486">is_curatable_by?</a></li>
              <li><a href="#M000478">iucn</a></li>
              <li><a href="#M000468">iucn_conservation_status</a></li>
              <li><a href="#M000469">iucn_conservation_status_url</a></li>
              <li><a href="#M000454">map</a></li>
              <li><a href="#M000445">mappings</a></li>
              <li><a href="#M000451">more_images</a></li>
              <li><a href="#M000452">more_videos</a></li>
              <li><a href="#M000442">name</a></li>
              <li><a href="#M000446">ping_host_urls</a></li>
              <li><a href="#M000464">quick_common_name</a></li>
              <li><a href="#M000465">quick_scientific_name</a></li>
              <li><a href="#M000462">scientific_name</a></li>
              <li><a href="#M000482">smart_image</a></li>
              <li><a href="#M000481">smart_medium_thumb</a></li>
              <li><a href="#M000480">smart_thumb</a></li>
              <li><a href="#M000477">subtitle</a></li>
              <li><a href="#M000473">table_of_contents</a></li>
              <li><a href="#M000476">title</a></li>
              <li><a href="#M000453">videos</a></li>
              <li><a href="#M000490">visible_comments</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>includes_unvetted</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      delegate :<a href="TaxonConcept.html#M000484">content_level</a>, :to =>
                      :entry # TODO remove this TODO delegate :<a
                      href="TaxonConcept.html#M000484">content_level</a>, :to =>
                      :taxon_concept_content
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='public-class method' id='method-M000485'>
                <a name='M000485'>      </a>
                <div class='synopsis'>
                  <span class='name'>direct_ancestors</span>
                  <span class='arguments'>(tc)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000485-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000485-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 413</span>&#x000A;413:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">direct_ancestors</span>(<span class="ruby-identifier">tc</span>)&#x000A;414:     <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">nil?</span>&#x000A;415:     <span class="ruby-identifier">he_all</span> = []&#x000A;416:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">hierarchy_entries</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">he</span><span class="ruby-operator">|</span>&#x000A;417:       <span class="ruby-identifier">he_all</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">he</span>&#x000A;418:       <span class="ruby-identifier">parent</span> = <span class="ruby-identifier">he</span>.<span class="ruby-identifier">parent</span>&#x000A;419:       <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">nil?</span>&#x000A;420:         <span class="ruby-identifier">he_all</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">parent</span>&#x000A;421:         <span class="ruby-identifier">parent</span> = <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">parent</span>&#x000A;422:       <span class="ruby-keyword kw">end</span>&#x000A;423:     <span class="ruby-keyword kw">end</span>&#x000A;424:     <span class="ruby-identifier">he_all</span>&#x000A;425:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000487'>
                <a name='M000487'>      </a>
                <div class='synopsis'>
                  <span class='name'>exemplars</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000487-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000487-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 435</span>&#x000A;435:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">exemplars</span>&#x000A;436:     <span class="ruby-comment cmt"># TODO - this is now taxon-concept centric, so IDs will have to change.</span>&#x000A;437:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@exemplars</span>.<span class="ruby-identifier">nil?</span>&#x000A;438:       <span class="ruby-identifier">list</span> = [<span class="ruby-value">910093</span>, <span class="ruby-value">1009706</span>, <span class="ruby-value">912371</span>, <span class="ruby-value">976559</span>, <span class="ruby-value">597748</span>, <span class="ruby-value">1061748</span>, <span class="ruby-value">373667</span>, <span class="ruby-value">482935</span>, <span class="ruby-value">392557</span>, <span class="ruby-value">484592</span>, <span class="ruby-value">581125</span>, <span class="ruby-value">467045</span>, <span class="ruby-value">593213</span>, <span class="ruby-value">209984</span>, <span class="ruby-value">795869</span>, <span class="ruby-value">1049164</span>, <span class="ruby-value">604595</span>, <span class="ruby-value">983558</span>, <span class="ruby-value">253397</span>, <span class="ruby-value">740699</span>, <span class="ruby-value">1044544</span>, <span class="ruby-value">802455</span>, <span class="ruby-value">1194666</span>, <span class="ruby-value">2485151</span>]&#x000A;439:     <span class="ruby-keyword kw">end</span>&#x000A;440:     &#x000A;441:     <span class="ruby-ivar">@@exemplars</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">TaxonConcept</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'id IN (?)'</span>, <span class="ruby-identifier">list</span>])&#x000A;442: &#x000A;443:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000466'>
                <a name='M000466'>      </a>
                <div class='synopsis'>
                  <span class='name'>find_with_supercedure</span>
                  <span class='arguments'>(*args)</span>
                </div>
                <div class='description'>
                  <p>
                  Some TaxonConcepts are &#8220;superceded&#8221; by others, and we need to
                  follow the chain as far as we can (up to a sane limit):
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000466-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000466-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 205</span>&#x000A;205:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_with_supercedure</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;206:     <span class="ruby-identifier">concept</span> = <span class="ruby-constant">TaxonConcept</span>.<span class="ruby-identifier">find_without_supercedure</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;207:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">concept</span>.<span class="ruby-identifier">nil?</span>&#x000A;208:     <span class="ruby-identifier">id</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]&#x000A;209:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">concept</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">id</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\d+$/</span>&#x000A;210:     <span class="ruby-identifier">attempts</span> = <span class="ruby-value">6</span>&#x000A;211:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">concept</span>.<span class="ruby-identifier">supercedure_id</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">attempts</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">6</span>&#x000A;212:       <span class="ruby-identifier">concept</span> = <span class="ruby-constant">TaxonConcept</span>.<span class="ruby-identifier">find_without_supercedure</span>(<span class="ruby-identifier">concept</span>.<span class="ruby-identifier">supercedure_id</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])&#x000A;213:       <span class="ruby-identifier">attempts</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;214:     <span class="ruby-keyword kw">end</span>&#x000A;215:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">concept</span>&#x000A;216:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000467'>
                <a name='M000467'>      </a>
                <div class='synopsis'>
                  <span class='name'>quick_search</span>
                  <span class='arguments'>(search_string, options = {})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000467-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000467-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 219</span>&#x000A;219:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">quick_search</span>(<span class="ruby-identifier">search_string</span>, <span class="ruby-identifier">options</span> = {})&#x000A;220:     <span class="ruby-comment cmt"># TODO - we have qualifier, scope, and search_lang diabled for now, so I am ignoring them entirely.</span>&#x000A;221:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:qualifier</span>]       <span class="ruby-operator">||=</span> <span class="ruby-value str">'contains'</span>&#x000A;222:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:scope</span>]           <span class="ruby-operator">||=</span> <span class="ruby-value str">'all'</span>&#x000A;223:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:search_language</span>] <span class="ruby-operator">||=</span> <span class="ruby-value str">'all'</span>&#x000A;224:     &#x000A;225:     <span class="ruby-comment cmt"># TODO - insert into search terms, popular searches, and the like.</span>&#x000A;226:     &#x000A;227:     <span class="ruby-comment cmt"># TODO - I'm not sure this is really what we want to be doing, here: I simply reproduced Patrick's code (for the most part).</span>&#x000A;228:     <span class="ruby-identifier">search_terms</span> = <span class="ruby-identifier">search_string</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\s+/</span>, <span class="ruby-value str">' '</span>).<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/[ -&amp;:\\'?;]+| and /</span>)&#x000A;229:     &#x000A;230:     <span class="ruby-identifier">sci_concepts</span>  = []&#x000A;231:     <span class="ruby-identifier">com_concepts</span>  = []&#x000A;232:     <span class="ruby-identifier">errors</span>       = <span class="ruby-keyword kw">nil</span>&#x000A;233:     <span class="ruby-identifier">num_matches</span>  = {}&#x000A;234:     &#x000A;235:     &#x000A;236:     <span class="ruby-identifier">modified_search_terms</span> = []&#x000A;237:     <span class="ruby-identifier">search_terms</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">orig_term</span><span class="ruby-operator">|</span>&#x000A;238:       <span class="ruby-identifier">term</span> = <span class="ruby-identifier">orig_term</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\*/</span>, <span class="ruby-value str">'EOL_WILDCARD'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[\W\-]/</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'EOL_WILDCARD'</span>, <span class="ruby-value str">'%'</span>)&#x000A;239:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">term</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'%'</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">3</span>&#x000A;240:         <span class="ruby-identifier">errors</span> <span class="ruby-operator">||=</span> []&#x000A;241:         <span class="ruby-identifier">errors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;All search terms must contain at least three characters. '#{orig_term}' is too short.&quot;</span>&#x000A;242:       <span class="ruby-keyword kw">end</span>&#x000A;243:       &#x000A;244:       <span class="ruby-identifier">search_type</span> = <span class="ruby-identifier">term</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/%/</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">'LIKE'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'='</span>&#x000A;245:       &#x000A;246:       <span class="ruby-identifier">modified_search_terms</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;nn.name_part #{search_type} '#{term}'&quot;</span>&#x000A;247:     <span class="ruby-keyword kw">end</span>&#x000A;248:     &#x000A;249:     &#x000A;250:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">modified_search_terms</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> &#x000A;251:       <span class="ruby-keyword kw">return</span> {<span class="ruby-identifier">:common</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">com_concepts</span>,&#x000A;252:               <span class="ruby-identifier">:scientific</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sci_concepts</span>,&#x000A;253:               <span class="ruby-identifier">:errors</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">errors</span>}&#x000A;254:     <span class="ruby-keyword kw">end</span>&#x000A;255:     &#x000A;256:     <span class="ruby-identifier">name_ids</span> = <span class="ruby-constant">SpeciesSchemaModel</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-node">&quot;SELECT name_id, count(*) FROM normalized_names nn STRAIGHT_JOIN normalized_links nl ON (nn.id=nl.normalized_name_id) WHERE (#{modified_search_terms.join(' OR ')}) AND nl.normalized_qualifier_id=1 GROUP BY name_id HAVING count(*)&gt;=#{modified_search_terms.length}&quot;</span>)&#x000A;257:     &#x000A;258:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name_ids</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> &#x000A;259:       <span class="ruby-keyword kw">return</span> {<span class="ruby-identifier">:common</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">com_concepts</span>,&#x000A;260:               <span class="ruby-identifier">:scientific</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sci_concepts</span>,&#x000A;261:               <span class="ruby-identifier">:errors</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">errors</span>}&#x000A;262:     <span class="ruby-keyword kw">end</span>&#x000A;263:     &#x000A;264:     &#x000A;265:     <span class="ruby-identifier">agent_clause</span> = <span class="ruby-value str">''</span>&#x000A;266:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:agent</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">is_admin?</span>)&#x000A;267:       <span class="ruby-identifier">agent_clause</span> = <span class="ruby-node">&quot;LEFT JOIN (agents_resources ar JOIN hierarchies_resources hr ON (ar.resource_id=hr.resource_id AND ar.resource_agent_role_id = #{ResourceAgentRole.content_partner_upload_role.id}) JOIN hierarchy_entries he2 ON (hr.hierarchy_id=he2.hierarchy_id)) ON (he2.taxon_concept_id=tc.id)&quot;</span>&#x000A;268:     <span class="ruby-keyword kw">end</span>&#x000A;269:     &#x000A;270:     <span class="ruby-identifier">vetted_condition</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">vetted</span> <span class="ruby-value">? </span><span class="ruby-node">&quot;(published=1 AND tc.vetted_id=#{Vetted.trusted.id})&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;published=1&quot;</span>&#x000A;271:     <span class="ruby-identifier">agent_condition</span> =  <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:agent</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value str">''</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;OR ar.agent_id=#{options[:agent].id}&quot;</span>&#x000A;272:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">is_admin?</span>&#x000A;273:       <span class="ruby-identifier">agent_condition</span> = <span class="ruby-value str">&quot;OR ar.agent_id IS NOT NULL&quot;</span>&#x000A;274:     <span class="ruby-keyword kw">end</span>&#x000A;275:     &#x000A;276:     <span class="ruby-identifier">taxon_concept_ids</span> = <span class="ruby-constant">SpeciesSchemaModel</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;SELECT tcn.taxon_concept_id id, tcn.vern is_vern, tcn.preferred preferred, tcc.content_level content_level, n.string matching_string, n.italicized matching_italicized_string, he.hierarchy_id hierarchy_id FROM taxon_concept_names tcn STRAIGHT_JOIN names n ON (tcn.name_id=n.id) STRAIGHT_JOIN taxon_concepts tc ON (tc.id = tcn.taxon_concept_id) LEFT JOIN taxon_concept_content tcc ON (tcn.taxon_concept_id=tcc.taxon_concept_id) LEFT JOIN hierarchy_entries he ON (tcn.source_hierarchy_entry_id=he.id) #{agent_clause} WHERE tcn.name_id IN (#{name_ids.join(',')}) AND (#{vetted_condition} #{agent_condition}) ORDER BY preferred DESC&quot;</span>).<span class="ruby-identifier">all_hashes</span>&#x000A;277:     &#x000A;278:     <span class="ruby-identifier">used_concept_ids</span> = []&#x000A;279:     <span class="ruby-identifier">sci_concepts</span> = []&#x000A;280:     <span class="ruby-identifier">com_concepts</span> = []&#x000A;281:     &#x000A;282:     <span class="ruby-identifier">taxon_concept_ids</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">result</span><span class="ruby-operator">|</span>&#x000A;283:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">used_concept_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">result</span>[<span class="ruby-value str">'id'</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">result</span>[<span class="ruby-value str">'hierarchy_id'</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Hierarchy</span>.<span class="ruby-identifier">default</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span>[<span class="ruby-value str">'preferred'</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>)&#x000A;284:         &#x000A;285:         <span class="ruby-comment cmt"># Remove existing concept representative if we have one from default hierarchy</span>&#x000A;286:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>[<span class="ruby-value str">'hierarchy_id'</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Hierarchy</span>.<span class="ruby-identifier">default</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span>[<span class="ruby-value str">'preferred'</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>&#x000A;287:           <span class="ruby-identifier">sci_concepts</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">concept</span><span class="ruby-operator">|</span> <span class="ruby-identifier">concept</span>[<span class="ruby-value str">'id'</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">result</span>[<span class="ruby-value str">'id'</span>] }&#x000A;288:           <span class="ruby-identifier">com_concepts</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">concept</span><span class="ruby-operator">|</span> <span class="ruby-identifier">concept</span>[<span class="ruby-value str">'id'</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">result</span>[<span class="ruby-value str">'id'</span>] }&#x000A;289:         <span class="ruby-keyword kw">end</span>&#x000A;290:         &#x000A;291:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>[<span class="ruby-value str">'is_vern'</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>&#x000A;292:           <span class="ruby-identifier">sci_concepts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">result</span>&#x000A;293:         <span class="ruby-keyword kw">else</span>&#x000A;294:           <span class="ruby-identifier">com_concepts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">result</span>&#x000A;295:         <span class="ruby-keyword kw">end</span>&#x000A;296:         &#x000A;297:         <span class="ruby-identifier">used_concept_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">result</span>[<span class="ruby-value str">'id'</span>].<span class="ruby-identifier">to_i</span>&#x000A;298:       <span class="ruby-keyword kw">end</span>&#x000A;299:     <span class="ruby-keyword kw">end</span>&#x000A;300: &#x000A;301:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">taxon_concept_ids</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>&#x000A;302:       <span class="ruby-identifier">errors</span> <span class="ruby-operator">||=</span> []&#x000A;303:       <span class="ruby-identifier">errors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;There were no matches for the search term #{search_string}&quot;</span>&#x000A;304:     <span class="ruby-keyword kw">end</span>&#x000A;305:     &#x000A;306:     <span class="ruby-keyword kw">return</span> {<span class="ruby-identifier">:common</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">com_concepts</span>,&#x000A;307:             <span class="ruby-identifier">:scientific</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sci_concepts</span>,&#x000A;308:             <span class="ruby-identifier">:errors</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">errors</span>}&#x000A;309: &#x000A;310:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000488'>
                <a name='M000488'>      </a>
                <div class='synopsis'>
                  <span class='name'>search</span>
                  <span class='arguments'>(search_string, options = {})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000488-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000488-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 445</span>&#x000A;445:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">search_string</span>, <span class="ruby-identifier">options</span> = {})&#x000A;446:     <span class="ruby-comment cmt"># TODO - we have qualifier, scope, and search_lang diabled for now, so I am ignoring them entirely.</span>&#x000A;447:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:qualifier</span>]       <span class="ruby-operator">||=</span> <span class="ruby-value str">'contains'</span>&#x000A;448:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:scope</span>]           <span class="ruby-operator">||=</span> <span class="ruby-value str">'all'</span>&#x000A;449:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:search_language</span>] <span class="ruby-operator">||=</span> <span class="ruby-value str">'all'</span>&#x000A;450: &#x000A;451:     <span class="ruby-comment cmt"># TODO - insert into search terms, popular searches, and the like.</span>&#x000A;452: &#x000A;453:     <span class="ruby-comment cmt"># TODO - I'm not sure this is really what we want to be doing, here: I simply reproduced Patrick's code (for the most part).</span>&#x000A;454:     <span class="ruby-identifier">search_terms</span> = <span class="ruby-identifier">search_string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\s+/</span>, <span class="ruby-value str">' '</span>).<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/[ -&amp;:\\'?;]+| and /</span>)&#x000A;455: &#x000A;456:     <span class="ruby-identifier">sci_concepts</span>  = []&#x000A;457:     <span class="ruby-identifier">com_concepts</span>  = []&#x000A;458:     <span class="ruby-identifier">errors</span>       = <span class="ruby-keyword kw">nil</span>&#x000A;459:     <span class="ruby-identifier">num_matches</span>  = {}&#x000A;460: &#x000A;461:     <span class="ruby-identifier">search_terms</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">orig_term</span><span class="ruby-operator">|</span>&#x000A;462:       <span class="ruby-identifier">term</span> = <span class="ruby-identifier">orig_term</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\*/</span>, <span class="ruby-value str">'EOL_WILDCARD'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[\W\-]/</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'EOL_WILDCARD'</span>, <span class="ruby-value str">'%'</span>)&#x000A;463:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">term</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'%'</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">3</span>&#x000A;464:         <span class="ruby-identifier">errors</span> <span class="ruby-operator">||=</span> []&#x000A;465:         <span class="ruby-identifier">errors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;All search terms must contain at least three characters. '#{orig_term}' is too short.&quot;</span>&#x000A;466:       <span class="ruby-keyword kw">end</span>&#x000A;467:       <span class="ruby-comment cmt"># I was going to make everything wildcarded, but....  term = &quot;%#{term}%&quot;.gsub('%+', '%')</span>&#x000A;468:       <span class="ruby-identifier">search_type</span> = <span class="ruby-identifier">term</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/%/</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">'LIKE'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'='</span>&#x000A;469: &#x000A;470:       <span class="ruby-comment cmt"># TODO - this will only search names (not authors or years), thanks to the hard-coded &quot;1&quot; below.</span>&#x000A;471: <span class="ruby-comment cmt">#       concepts = TaxonConcept.find_by_sql([&lt;&lt;EO_FIND_NAMES, term])</span>&#x000A;472: <span class="ruby-comment cmt">#   SELECT DISTINCT tc.id, tcn.vern vern</span>&#x000A;473: <span class="ruby-comment cmt">#     FROM taxon_concepts tc</span>&#x000A;474: <span class="ruby-comment cmt">#       JOIN taxon_concept_names tcn ON (tcn.taxon_concept_id = tc.id)</span>&#x000A;475: <span class="ruby-comment cmt">#       JOIN normalized_links nl ON (nl.name_id = tcn.name_id)</span>&#x000A;476: <span class="ruby-comment cmt">#       JOIN normalized_names nn ON (nn.id = nl.normalized_name_id)</span>&#x000A;477: <span class="ruby-comment cmt">#     WHERE nn.name_part #{search_type} ?</span>&#x000A;478: <span class="ruby-comment cmt">#       AND nl.normalized_qualifier_id = 1 # TaxonConcept.search</span>&#x000A;479: <span class="ruby-comment cmt"># EO_FIND_NAMES</span>&#x000A;480: &#x000A;481:       <span class="ruby-identifier">concepts</span> = <span class="ruby-constant">TaxonConcept</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;  SELECT DISTINCT tcn.taxon_concept_id id, tcn.vern vern\n  FROM normalized_names nn\n  STRAIGHT_JOIN normalized_links nl ON (nn.id=nl.normalized_name_id)\n  STRAIGHT_JOIN taxon_concept_names tcn ON (nl.name_id=tcn.name_id)\n  WHERE nn.name_part \#{search_type} ?\n  AND nl.normalized_qualifier_id = 1 # TaxonConcept.search\n&quot;</span>, <span class="ruby-identifier">term</span>])&#x000A;482: &#x000A;483:       <span class="ruby-comment cmt"># NOTE: For whatever reason, Rails makes TINYINTs into strings.  Thus the to_i.</span>&#x000A;484:       <span class="ruby-identifier">sci_concepts</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">concepts</span>.<span class="ruby-identifier">find_all</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">concept</span><span class="ruby-operator">|</span> <span class="ruby-identifier">concept</span>.<span class="ruby-identifier">vern</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> }&#x000A;485:       <span class="ruby-identifier">com_concepts</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">concepts</span>.<span class="ruby-identifier">find_all</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">concept</span><span class="ruby-operator">|</span> <span class="ruby-identifier">concept</span>.<span class="ruby-identifier">vern</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> }&#x000A;486:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">concepts</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>&#x000A;487:         <span class="ruby-identifier">errors</span> <span class="ruby-operator">||=</span> []&#x000A;488:         <span class="ruby-identifier">errors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;There were no matches for the search term #{orig_term}&quot;</span>&#x000A;489:       <span class="ruby-keyword kw">end</span>&#x000A;490: &#x000A;491:     <span class="ruby-keyword kw">end</span>&#x000A;492: &#x000A;493:     <span class="ruby-keyword kw">return</span> {<span class="ruby-identifier">:common</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">com_concepts</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">sort</span>,&#x000A;494:             <span class="ruby-identifier">:scientific</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sci_concepts</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">sort</span>,&#x000A;495:             <span class="ruby-identifier">:errors</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">errors</span>}&#x000A;496: &#x000A;497:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000489'>
                <a name='M000489'>      </a>
                <div class='synopsis'>
                  <span class='name'>&lt;=&gt;</span>
                  <span class='arguments'>(other)</span>
                </div>
                <div class='description'>
                  <p>
                  This could use name... but I only need it for searches, and ID is all that
                  matters, there.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000489-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000489-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 508</span>&#x000A;508:   <span class="ruby-keyword kw">def</span> <span class="ruby-operator">&lt;=&gt;</span>(<span class="ruby-identifier">other</span>)&#x000A;509:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">id</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">other</span>.<span class="ruby-identifier">id</span>&#x000A;510:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000479'>
                <a name='M000479'>      </a>
                <div class='synopsis'>
                  <span class='name'>agent_url</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000479-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000479-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 386</span>&#x000A;386:                               <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_url</span>; <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Agent</span>.<span class="ruby-identifier">iucn</span>.<span class="ruby-identifier">homepage</span>; <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000443'>
                <a name='M000443'>      </a>
                <div class='synopsis'>
                  <span class='name'>alternate_classification_name</span>
                  <span class='arguments'>(detail_level = :middle, language = Language.english, context = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000443-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000443-source'>    <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 48</span>&#x000A;48:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">alternate_classification_name</span>(<span class="ruby-identifier">detail_level</span> = <span class="ruby-identifier">:middle</span>, <span class="ruby-identifier">language</span> = <span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span>, <span class="ruby-identifier">context</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;49:     <span class="ruby-comment cmt">#return col_he.nil? ? alternate_classification_name(detail_level, language, context) : col_he.name(detail_level, language, context)</span>&#x000A;50:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hierarchy_entries</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">name</span>(<span class="ruby-identifier">detail_level</span>, <span class="ruby-identifier">language</span>, <span class="ruby-identifier">context</span>).<span class="ruby-identifier">firstcap</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-value str">'?-?'</span>&#x000A;51:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000471'>
                <a name='M000471'>      </a>
                <div class='synopsis'>
                  <span class='name'>ancestry</span>
                  <span class='arguments'>(hierarchy_id = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000471-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000471-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 324</span>&#x000A;324:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ancestry</span>(<span class="ruby-identifier">hierarchy_id</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;325:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">entry</span>(<span class="ruby-identifier">hierarchy_id</span>).<span class="ruby-identifier">ancestors</span>&#x000A;326:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000447'>
                <a name='M000447'>      </a>
                <div class='synopsis'>
                  <span class='name'>approved_curators</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000447-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000447-source'>    <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 75</span>&#x000A;75:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">approved_curators</span>&#x000A;76:     <span class="ruby-identifier">approved</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>&#x000A;77:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hierarchy_entries</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">he</span><span class="ruby-operator">|</span>&#x000A;78:       <span class="ruby-identifier">approved</span>.<span class="ruby-identifier">merge</span> <span class="ruby-identifier">he</span>.<span class="ruby-identifier">approved_curators</span>&#x000A;79:     <span class="ruby-keyword kw">end</span>&#x000A;80:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">approved</span>&#x000A;81:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000459'>
                <a name='M000459'>      </a>
                <div class='synopsis'>
                  <span class='name'>available_media</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000459-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000459-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 135</span>&#x000A;135:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">available_media</span>&#x000A;136:     <span class="ruby-identifier">images</span> = <span class="ruby-identifier">video</span> = <span class="ruby-identifier">map</span> = <span class="ruby-keyword kw">false</span>&#x000A;137:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">entry</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">hierarchy_entries</span>&#x000A;138:       <span class="ruby-identifier">images</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">image</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">child_image</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">images</span>&#x000A;139:       <span class="ruby-identifier">video</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">flash</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">youtube</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">video</span>&#x000A;140:       <span class="ruby-identifier">map</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">gbif_image</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">map</span>&#x000A;141:     <span class="ruby-keyword kw">end</span>&#x000A;142:     &#x000A;143:     {<span class="ruby-identifier">:images</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">images</span>,&#x000A;144:      <span class="ruby-identifier">:video</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">video</span>,&#x000A;145:      <span class="ruby-identifier">:map</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">map</span> }&#x000A;146:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000463'>
                <a name='M000463'>      </a>
                <div class='synopsis'>
                  <span class='name'>canonical_form</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000463-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000463-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 169</span>&#x000A;169:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">canonical_form</span>&#x000A;170:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>(<span class="ruby-identifier">:canonical</span>)&#x000A;171:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000472'>
                <a name='M000472'>      </a>
                <div class='synopsis'>
                  <span class='name'>classification_attribution</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000472-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000472-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 328</span>&#x000A;328:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">classification_attribution</span>&#x000A;329:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">classification_attribution</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-value str">&quot;&quot;</span>&#x000A;330:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000456'>
                <a name='M000456'>      </a>
                <div class='synopsis'>
                  <span class='name'>col_entry</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  We do have some content that is specific to COL, so we need a method that
                  will ALWAYS reference it:
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000456-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000456-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 121</span>&#x000A;121:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">col_entry</span>&#x000A;122:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@col_entry</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@col_entry</span>.<span class="ruby-identifier">nil?</span>&#x000A;123:     <span class="ruby-identifier">hierarchy_id</span> = <span class="ruby-constant">Hierarchy</span>.<span class="ruby-identifier">default</span>.<span class="ruby-identifier">id</span>&#x000A;124:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@col_entry</span> = <span class="ruby-identifier">hierarchy_entries</span>.<span class="ruby-identifier">detect</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">he</span><span class="ruby-operator">|</span> <span class="ruby-identifier">he</span>.<span class="ruby-identifier">hierarchy_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">hierarchy_id</span> }&#x000A;125:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000483'>
                <a name='M000483'>      </a>
                <div class='synopsis'>
                  <span class='name'>comment</span>
                  <span class='arguments'>(user, body)</span>
                </div>
                <div class='description'>
                  <p>
                  comment on this
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000483-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000483-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 403</span>&#x000A;403:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">comment</span> <span class="ruby-identifier">user</span>, <span class="ruby-identifier">body</span>&#x000A;404:     <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>, <span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">body</span>&#x000A;405:     <span class="ruby-identifier">user</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">reload</span> <span class="ruby-comment cmt"># be friendly - update the user's comments automatically</span>&#x000A;406:     <span class="ruby-identifier">comment</span>&#x000A;407:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000461'>
                <a name='M000461'>      </a>
                <div class='synopsis'>
                  <span class='name'>common_name</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  TODO - stop calling these.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000461-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000461-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 161</span>&#x000A;161:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">common_name</span>&#x000A;162:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name</span>(<span class="ruby-identifier">:middle</span>)&#x000A;163:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000474'>
                <a name='M000474'>      </a>
                <div class='synopsis'>
                  <span class='name'>content_by_category</span>
                  <span class='arguments'>(category_id, options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  pull content type by given category for taxa id
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000474-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000474-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 339</span>&#x000A;339:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">content_by_category</span>(<span class="ruby-identifier">category_id</span>, <span class="ruby-identifier">options</span> = {})&#x000A;340:     <span class="ruby-identifier">toc_item</span> = <span class="ruby-constant">TocItem</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">category_id</span>)&#x000A;341:     <span class="ruby-identifier">sub_name</span> = <span class="ruby-identifier">toc_item</span>.<span class="ruby-identifier">label</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\W/</span>, <span class="ruby-value str">'_'</span>).<span class="ruby-identifier">downcase</span>&#x000A;342:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">sub_name</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">private_methods</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">sub_name</span>)&#x000A;343:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">get_default_content</span>(<span class="ruby-identifier">category_id</span>, <span class="ruby-identifier">options</span>)&#x000A;344:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000484'>
                <a name='M000484'>      </a>
                <div class='synopsis'>
                  <span class='name'>content_level</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000484-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000484-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 409</span>&#x000A;409:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">content_level</span>&#x000A;410:     <span class="ruby-identifier">taxon_concept_content</span>.<span class="ruby-identifier">content_level</span>&#x000A;411:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000458'>
                <a name='M000458'>      </a>
                <div class='synopsis'>
                  <span class='name'>current_agent=</span>
                  <span class='arguments'>(agent)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000458-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000458-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 131</span>&#x000A;131:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_agent=</span>(<span class="ruby-identifier">agent</span>)&#x000A;132:     <span class="ruby-ivar">@current_agent</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">agent</span>&#x000A;133:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000470'>
                <a name='M000470'>      </a>
                <div class='synopsis'>
                  <span class='name'>current_node</span>
                  <span class='arguments'>(hierarchy_id = nil)</span>
                </div>
                <div class='description'>
                  <p>
                  TODO - find refs to these and make them grab a hierarchy...
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000470-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000470-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 321</span>&#x000A;321:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_node</span>(<span class="ruby-identifier">hierarchy_id</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;322:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">entry</span>(<span class="ruby-identifier">hierarchy_id</span>)&#x000A;323:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000457'>
                <a name='M000457'>      </a>
                <div class='synopsis'>
                  <span class='name'>current_user=</span>
                  <span class='arguments'>(user)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000457-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000457-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 127</span>&#x000A;127:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_user=</span>(<span class="ruby-identifier">user</span>)&#x000A;128:     <span class="ruby-ivar">@current_user</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">user</span>&#x000A;129:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000455'>
                <a name='M000455'>      </a>
                <div class='synopsis'>
                  <span class='name'>entry</span>
                  <span class='arguments'>(hierarchy = Hierarchy.default)</span>
                </div>
                <div class='description'>
                  <p>
                  Singleton method to fetch the <a href="Hierarchy.html">Hierarchy</a> Entry,
                  used for taxonomic relationships
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000455-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000455-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 115</span>&#x000A;115:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">entry</span>(<span class="ruby-identifier">hierarchy</span> = <span class="ruby-constant">Hierarchy</span>.<span class="ruby-identifier">default</span>)&#x000A;116:     <span class="ruby-identifier">hierarchy_id</span> = <span class="ruby-identifier">hierarchy</span>.<span class="ruby-identifier">id</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>&#x000A;117:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">hierarchy_entries</span>.<span class="ruby-identifier">detect</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">he</span><span class="ruby-operator">|</span> <span class="ruby-identifier">he</span>.<span class="ruby-identifier">hierarchy_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">hierarchy_id</span> } <span class="ruby-operator">||</span> <span class="ruby-identifier">hierarchy_entries</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Exception</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Taxon concept must have at least one hierarchy entry&quot;</span>))&#x000A;118:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000450'>
                <a name='M000450'>      </a>
                <div class='synopsis'>
                  <span class='name'>has_citation?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000450-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000450-source'>    <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 88</span>&#x000A;88:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_citation?</span>&#x000A;89:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>&#x000A;90:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000460'>
                <a name='M000460'>      </a>
                <div class='synopsis'>
                  <span class='name'>has_name?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  def <a href="TaxonConcept.html#M000459">available_media</a>
                  </p>
                  <pre>{:images =&gt; hierarchies_content.image != 0 || hierarchies_content.child_image  != 0,&#x000A; :video  =&gt; hierarchies_content.flash != 0 || hierarchies_content.youtube != 0,&#x000A; :map    =&gt; hierarchies_content.gbif_image != 0}&#x000A;&#x000A;#return entry.media</pre>
                  <p>
                  end
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000460-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000460-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 156</span>&#x000A;156:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_name?</span>&#x000A;157:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">content_level</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>&#x000A;158:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000449'>
                <a name='M000449'>      </a>
                <div class='synopsis'>
                  <span class='name'>hierarchy_entries_with_ancestors</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Alias for <a
                  href="TaxonConcept.html#M000448">hierarchy_entries_with_parents</a>
                  </p>
                </div>
              </div>
              <div class='public-instance method' id='method-M000448'>
                <a name='M000448'>      </a>
                <div class='synopsis'>
                  <span class='name'>hierarchy_entries_with_parents</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000448-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000448-source'>    <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 83</span>&#x000A;83:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hierarchy_entries_with_parents</span>&#x000A;84:     <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">with_parents</span> <span class="ruby-keyword kw">self</span>&#x000A;85:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000475'>
                <a name='M000475'>      </a>
                <div class='synopsis'>
                  <span class='name'>images</span>
                  <span class='arguments'>(options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  This used to be singleton, but now we&#8217;re changing the views (based on
                  permissions) a lot, so I removed it.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000475-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000475-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 347</span>&#x000A;347:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">images</span>(<span class="ruby-identifier">options</span> = {})&#x000A;348:     <span class="ruby-identifier">images</span> = <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">for_taxon</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">:image</span>, <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@current_user</span>, <span class="ruby-identifier">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@current_agent</span>)&#x000A;349:     <span class="ruby-ivar">@length_of_images</span> = <span class="ruby-identifier">images</span>.<span class="ruby-identifier">length</span> <span class="ruby-comment cmt"># Caching this because the call to #images is expensive and we don't want to do it twice.</span>&#x000A;350:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">images</span>&#x000A;351:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000444'>
                <a name='M000444'>      </a>
                <div class='synopsis'>
                  <span class='name'>in_hierarchy</span>
                  <span class='arguments'>(search_hierarchy_id = 0)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000444-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000444-source'>    <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 53</span>&#x000A;53:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">in_hierarchy</span>(<span class="ruby-identifier">search_hierarchy_id</span> = <span class="ruby-value">0</span>)&#x000A;54:     <span class="ruby-identifier">enries</span> = <span class="ruby-identifier">hierarchy_entries</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">he</span><span class="ruby-operator">|</span> <span class="ruby-identifier">he</span>.<span class="ruby-identifier">hierarchy_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">search_hierarchy_id</span> }&#x000A;55:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">enries</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">true</span>&#x000A;56:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000486'>
                <a name='M000486'>      </a>
                <div class='synopsis'>
                  <span class='name'>is_curatable_by?</span>
                  <span class='arguments'>(user)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000486-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000486-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 427</span>&#x000A;427:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_curatable_by?</span> <span class="ruby-identifier">user</span>&#x000A;428:     <span class="ruby-identifier">he_all</span> = <span class="ruby-constant">TaxonConcept</span>.<span class="ruby-identifier">direct_ancestors</span>(<span class="ruby-keyword kw">self</span>)&#x000A;429:     <span class="ruby-comment cmt"># hierarchy_entries_with_parents_above_clade = hierarchy_entries_with_parents</span>&#x000A;430:     <span class="ruby-comment cmt"># hierarchy_entries_with_parents_above_clade</span>&#x000A;431:     <span class="ruby-identifier">permitted</span> = <span class="ruby-identifier">he_all</span>.<span class="ruby-identifier">find</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">curator_hierarchy_entry_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">id</span> }&#x000A;432:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">permitted</span> <span class="ruby-keyword kw">then</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">else</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">end</span>&#x000A;433:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000478'>
                <a name='M000478'>      </a>
                <div class='synopsis'>
                  <span class='name'>iucn</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000478-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000478-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 368</span>&#x000A;368:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">iucn</span>&#x000A;369:     <span class="ruby-comment cmt"># Notice that we use find_by, not find_all_by.  We require that only one match (or no match) is found.</span>&#x000A;370:     <span class="ruby-identifier">my_iucn</span> = <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;\n    SELECT distinct do.*\n      FROM taxon_concept_names tcn\n        JOIN taxa t ON (tcn.name_id=t.name_id)\n        JOIN harvest_events_taxa het ON (t.id=het.taxon_id)\n        JOIN harvest_events he ON (het.harvest_event_id=he.id)\n        JOIN data_objects_taxa dot ON (t.id=dot.taxon_id)\n        JOIN data_objects do ON (dot.data_object_id=do.id)\n      WHERE tcn.taxon_concept_id = ?\n        AND he.resource_id = 3 \n      LIMIT 1 # TaxonConcept.iucn\n\n&quot;</span>, <span class="ruby-identifier">id</span>])[<span class="ruby-value">0</span>]&#x000A;371:     <span class="ruby-identifier">temp_iucn</span> = <span class="ruby-identifier">my_iucn</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:source_url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'http://www.iucnredlist.org/'</span>, <span class="ruby-identifier">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'NOT EVALUATED'</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">my_iucn</span>&#x000A;372:     <span class="ruby-identifier">temp_iucn</span>.<span class="ruby-identifier">instance_eval</span> { <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_url</span>; <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Agent</span>.<span class="ruby-identifier">iucn</span>.<span class="ruby-identifier">homepage</span>; <span class="ruby-keyword kw">end</span> }&#x000A;373:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">temp_iucn</span>&#x000A;374:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000468'>
                <a name='M000468'>      </a>
                <div class='synopsis'>
                  <span class='name'>iucn_conservation_status</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000468-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000468-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 312</span>&#x000A;312:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">iucn_conservation_status</span>&#x000A;313:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">iucn</span>.<span class="ruby-identifier">description</span>&#x000A;314:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000469'>
                <a name='M000469'>      </a>
                <div class='synopsis'>
                  <span class='name'>iucn_conservation_status_url</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000469-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000469-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 316</span>&#x000A;316:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">iucn_conservation_status_url</span>&#x000A;317:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">iucn</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:agent_url</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">iucn</span>.<span class="ruby-identifier">agent_url</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">iucn</span>.<span class="ruby-identifier">source_url</span>&#x000A;318:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000454'>
                <a name='M000454'>      </a>
                <div class='synopsis'>
                  <span class='name'>map</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000454-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000454-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 109</span>&#x000A;109:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">map</span>&#x000A;110:     <span class="ruby-comment cmt"># NOTE: there may be more than one map, but we only need one.</span>&#x000A;111:     <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">for_taxon</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">:map</span>, <span class="ruby-identifier">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@current_agent</span>, <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@current_user</span>)[<span class="ruby-value">0</span>]&#x000A;112:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000445'>
                <a name='M000445'>      </a>
                <div class='synopsis'>
                  <span class='name'>mappings</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Because nested has_many_through won&#8217;t work with CPKs: Also, so we can
                  include collection.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000445-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000445-source'>    <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 60</span>&#x000A;60:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mappings</span>&#x000A;61:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@mappings</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@mappings</span>.<span class="ruby-identifier">nil?</span>&#x000A;62:     <span class="ruby-ivar">@mappings</span> = <span class="ruby-constant">Mapping</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;SELECT DISTINCT m.id, m.collection_id, m.name_id, m.foreign_key FROM taxon_concept_names tcn JOIN mappings m ON (tcn.name_id=m.name_id) JOIN collections c ON (m.collection_id=c.id) JOIN agents a ON (c.agent_id=a.id) WHERE tcn.taxon_concept_id = #{id} GROUP BY c.id&quot;</span>)&#x000A;63:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@mappings</span> = <span class="ruby-ivar">@mappings</span>.<span class="ruby-identifier">sort_by</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">id</span> }.<span class="ruby-identifier">uniq</span>&#x000A;64:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000451'>
                <a name='M000451'>      </a>
                <div class='synopsis'>
                  <span class='name'>more_images</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  TODO = $MAX_IMAGES_PER_PAGE really should BE an int.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000451-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000451-source'>    <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 93</span>&#x000A;93:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">more_images</span>&#x000A;94:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@length_of_images</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$MAX_IMAGES_PER_PAGE</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@length_of_images</span>&#x000A;95:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$MAX_IMAGES_PER_PAGE</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># This is expensive.  I hope you called #images first!</span>&#x000A;96:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000452'>
                <a name='M000452'>      </a>
                <div class='synopsis'>
                  <span class='name'>more_videos</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000452-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000452-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 98</span>&#x000A; 98:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">more_videos</span> &#x000A; 99:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@length_of_videos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$MAX_IMAGES_PER_PAGE</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@length_of_videos</span>&#x000A;100:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">videos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">$MAX_IMAGES_PER_PAGE</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># This is expensive.  I hope you called #videos first!</span>&#x000A;101:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000442'>
                <a name='M000442'>      </a>
                <div class='synopsis'>
                  <span class='name'>name</span>
                  <span class='arguments'>(detail_level = :middle, language = Language.english, context = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000442-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000442-source'>    <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 42</span>&#x000A;42:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">name</span>(<span class="ruby-identifier">detail_level</span> = <span class="ruby-identifier">:middle</span>, <span class="ruby-identifier">language</span> = <span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span>, <span class="ruby-identifier">context</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;43:     <span class="ruby-identifier">default_hierarchy_id</span> = <span class="ruby-constant">Hierarchy</span>.<span class="ruby-identifier">default</span>.<span class="ruby-identifier">id</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>&#x000A;44:     <span class="ruby-identifier">col_he</span> = <span class="ruby-identifier">hierarchy_entries</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">he</span><span class="ruby-operator">|</span> <span class="ruby-identifier">he</span>.<span class="ruby-identifier">hierarchy_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">default_hierarchy_id</span> }&#x000A;45:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">col_he</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">alternate_classification_name</span>(<span class="ruby-identifier">detail_level</span>, <span class="ruby-identifier">language</span>, <span class="ruby-identifier">context</span>).<span class="ruby-identifier">firstcap</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">col_he</span>.<span class="ruby-identifier">name</span>(<span class="ruby-identifier">detail_level</span>, <span class="ruby-identifier">language</span>, <span class="ruby-identifier">context</span>).<span class="ruby-identifier">firstcap</span>&#x000A;46:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000446'>
                <a name='M000446'>      </a>
                <div class='synopsis'>
                  <span class='name'>ping_host_urls</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  I chose not to make this singleton since it should really only ever get
                  called once:
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000446-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000446-source'>    <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 67</span>&#x000A;67:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ping_host_urls</span>&#x000A;68:     <span class="ruby-identifier">host_urls</span> = []&#x000A;69:     <span class="ruby-identifier">mappings</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mapping</span><span class="ruby-operator">|</span>&#x000A;70:       <span class="ruby-identifier">host_urls</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">mapping</span>.<span class="ruby-identifier">ping_host_url</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">mapping</span>.<span class="ruby-identifier">collection</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">mapping</span>.<span class="ruby-identifier">ping_host?</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span> &#x000A;71:     <span class="ruby-keyword kw">end</span>&#x000A;72:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">host_urls</span>&#x000A;73:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000464'>
                <a name='M000464'>      </a>
                <div class='synopsis'>
                  <span class='name'>quick_common_name</span>
                  <span class='arguments'>(language = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000464-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000464-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 173</span>&#x000A;173:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quick_common_name</span>(<span class="ruby-identifier">language</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;174:     <span class="ruby-identifier">language</span> <span class="ruby-operator">||=</span> (<span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">language</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span>&#x000A;175:     <span class="ruby-identifier">common_name_results</span> = <span class="ruby-constant">SpeciesSchemaModel</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-node">&quot;SELECT n.string FROM taxon_concept_names tcn JOIN names n ON (tcn.name_id=n.id) WHERE tcn.taxon_concept_id=#{id} AND language_id=#{language.id} AND preferred=1 LIMIT 1&quot;</span>)&#x000A;176:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">common_name_results</span>.<span class="ruby-identifier">empty?</span>&#x000A;177:       <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;&quot;</span>&#x000A;178:     <span class="ruby-keyword kw">end</span>&#x000A;179:     &#x000A;180:     <span class="ruby-identifier">common_name_results</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">firstcap</span>&#x000A;181:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000465'>
                <a name='M000465'>      </a>
                <div class='synopsis'>
                  <span class='name'>quick_scientific_name</span>
                  <span class='arguments'>(type = :normal)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000465-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000465-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 183</span>&#x000A;183:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">quick_scientific_name</span>(<span class="ruby-identifier">type</span> = <span class="ruby-identifier">:normal</span>)&#x000A;184:     <span class="ruby-identifier">scientific_name_results</span> = []&#x000A;185:     <span class="ruby-comment cmt"># TODO - refactor this.  Duplication where italicized, but I think all four queries could be generalized.</span>&#x000A;186:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">type</span>&#x000A;187:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:normal</span>      <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">scientific_name_results</span> = <span class="ruby-constant">SpeciesSchemaModel</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;SELECT n.string name, he.hierarchy_id source_hierarchy_id FROM taxon_concept_names tcn JOIN names n ON (tcn.name_id=n.id) LEFT JOIN hierarchy_entries he ON (tcn.source_hierarchy_entry_id=he.id) WHERE tcn.taxon_concept_id=#{id} AND vern=0 AND preferred=1&quot;</span>).<span class="ruby-identifier">all_hashes</span>&#x000A;188:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:italicized</span>  <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">scientific_name_results</span> = <span class="ruby-constant">SpeciesSchemaModel</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;SELECT n.italicized name, he.hierarchy_id source_hierarchy_id FROM taxon_concept_names tcn JOIN names n ON (tcn.name_id=n.id) LEFT JOIN hierarchy_entries he ON (tcn.source_hierarchy_entry_id=he.id) WHERE tcn.taxon_concept_id=#{id} AND vern=0 AND preferred=1&quot;</span>).<span class="ruby-identifier">all_hashes</span>&#x000A;189:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:canonical</span>   <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">scientific_name_results</span> = <span class="ruby-constant">SpeciesSchemaModel</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;SELECT cf.string name, he.hierarchy_id source_hierarchy_id FROM taxon_concept_names tcn JOIN names n ON (tcn.name_id=n.id) JOIN canonical_forms cf ON (n.canonical_form_id=cf.id) LEFT JOIN hierarchy_entries he ON (tcn.source_hierarchy_entry_id=he.id) WHERE tcn.taxon_concept_id=#{id} AND vern=0 AND preferred=1&quot;</span>).<span class="ruby-identifier">all_hashes</span>&#x000A;190:     <span class="ruby-keyword kw">end</span>&#x000A;191:     &#x000A;192:     <span class="ruby-identifier">scientific_name</span> = <span class="ruby-value str">&quot;&quot;</span>&#x000A;193:     &#x000A;194:     <span class="ruby-comment cmt"># This loop is to check to make sure the default hierarchy's preferred name takes precedence over other hierarchy's preferred names </span>&#x000A;195:     <span class="ruby-identifier">scientific_name_results</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">result</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>&#x000A;196:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scientific_name</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">result</span>[<span class="ruby-value str">'source_hierarchy_id'</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Hierarchy</span>.<span class="ruby-identifier">default</span>.<span class="ruby-identifier">id</span>&#x000A;197:         <span class="ruby-identifier">scientific_name</span> = <span class="ruby-identifier">result</span>[<span class="ruby-value str">'name'</span>].<span class="ruby-identifier">firstcap</span>&#x000A;198:       <span class="ruby-keyword kw">end</span>&#x000A;199:     <span class="ruby-keyword kw">end</span>&#x000A;200:     &#x000A;201:     <span class="ruby-identifier">scientific_name</span>&#x000A;202:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000462'>
                <a name='M000462'>      </a>
                <div class='synopsis'>
                  <span class='name'>scientific_name</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000462-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000462-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 164</span>&#x000A;164:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scientific_name</span>&#x000A;165:     <span class="ruby-identifier">tcn</span> = <span class="ruby-identifier">taxon_concept_names</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">vern</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">preferred</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">n</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span> }.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">source_hierarchy_entry_id</span> = <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">id</span> }&#x000A;166:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;TCN name id: #{tcn.name_id}&quot;</span>&#x000A;167:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">tcn</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">name</span>(<span class="ruby-identifier">:expert</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">tcn</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">string</span>&#x000A;168:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000482'>
                <a name='M000482'>      </a>
                <div class='synopsis'>
                  <span class='name'>smart_image</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000482-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000482-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 398</span>&#x000A;398:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">smart_image</span>&#x000A;399:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">images</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">smart_image</span>&#x000A;400:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000481'>
                <a name='M000481'>      </a>
                <div class='synopsis'>
                  <span class='name'>smart_medium_thumb</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000481-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000481-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 394</span>&#x000A;394:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">smart_medium_thumb</span>&#x000A;395:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">images</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">smart_medium_thumb</span>&#x000A;396:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000480'>
                <a name='M000480'>      </a>
                <div class='synopsis'>
                  <span class='name'>smart_thumb</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000480-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000480-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 390</span>&#x000A;390:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">smart_thumb</span>&#x000A;391:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">images</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">smart_thumb</span>&#x000A;392:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000477'>
                <a name='M000477'>      </a>
                <div class='synopsis'>
                  <span class='name'>subtitle</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000477-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000477-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 360</span>&#x000A;360:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">subtitle</span>&#x000A;361:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@subtitle</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@subtitle</span>.<span class="ruby-identifier">nil?</span>&#x000A;362:     <span class="ruby-identifier">subtitle</span> = <span class="ruby-identifier">quick_common_name</span>()&#x000A;363:     <span class="ruby-identifier">subtitle</span> = <span class="ruby-identifier">quick_scientific_name</span>(<span class="ruby-identifier">:canonical</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subtitle</span>.<span class="ruby-identifier">empty?</span>&#x000A;364:     <span class="ruby-identifier">subtitle</span> = <span class="ruby-node">&quot;&lt;i&gt;#{subtitle}&lt;/i&gt;&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">subtitle</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">subtitle</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/&lt;i&gt;/</span>&#x000A;365:     <span class="ruby-ivar">@subtitle</span> = <span class="ruby-identifier">subtitle</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-identifier">name</span>() <span class="ruby-operator">:</span> <span class="ruby-identifier">subtitle</span>&#x000A;366:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000473'>
                <a name='M000473'>      </a>
                <div class='synopsis'>
                  <span class='name'>table_of_contents</span>
                  <span class='arguments'>(options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  pull list of categories for given taxa id
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000473-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000473-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 333</span>&#x000A;333:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">table_of_contents</span>(<span class="ruby-identifier">options</span> = {})&#x000A;334:     <span class="ruby-comment cmt">#options = options.merge(:agent_id =&gt; @current_agent.id) unless @current_agent.nil?</span>&#x000A;335:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@table_of_contents</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">TocItem</span>.<span class="ruby-identifier">toc_for</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@current_agent</span>, <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@current_user</span>)&#x000A;336:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000476'>
                <a name='M000476'>      </a>
                <div class='synopsis'>
                  <span class='name'>title</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  title and sub-title depend on expertise level of the user that is passed in
                  (default to novice if none specified)
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000476-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000476-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 354</span>&#x000A;354:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">title</span>&#x000A;355:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@title</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@title</span>.<span class="ruby-identifier">nil?</span>&#x000A;356:     <span class="ruby-identifier">title</span> = <span class="ruby-identifier">quick_scientific_name</span>(<span class="ruby-identifier">:italicized</span>)&#x000A;357:     <span class="ruby-ivar">@title</span> = <span class="ruby-identifier">title</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-identifier">name</span>(<span class="ruby-identifier">:scientific</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">title</span>&#x000A;358:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000453'>
                <a name='M000453'>      </a>
                <div class='synopsis'>
                  <span class='name'>videos</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000453-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000453-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 103</span>&#x000A;103:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">videos</span>&#x000A;104:     <span class="ruby-identifier">videos</span> = <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">for_taxon</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">:video</span>, <span class="ruby-identifier">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@current_agent</span>, <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@current_user</span>)&#x000A;105:     <span class="ruby-ivar">@length_of_videos</span> = <span class="ruby-identifier">videos</span>.<span class="ruby-identifier">length</span> <span class="ruby-comment cmt"># cached, so we don't have to query this again.</span>&#x000A;106:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">videos</span>&#x000A;107:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000490'>
                <a name='M000490'>      </a>
                <div class='synopsis'>
                  <span class='name'>visible_comments</span>
                  <span class='arguments'>(user = @current_user)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000490-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000490-source'>     <span class="ruby-comment cmt"># File app/models/taxon_concept.rb, line 512</span>&#x000A;512:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">visible_comments</span>(<span class="ruby-identifier">user</span> = <span class="ruby-ivar">@current_user</span>)&#x000A;513:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">comments</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">is_moderator?</span>&#x000A;514:     <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">find_all</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">comment</span><span class="ruby-operator">|</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">visible?</span> }&#x000A;515:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
