<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Class: HierarchyEntry [Rails Application Documentation]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='.././rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          HierarchyEntry
        </h1>
        <ol class='paths'>
          <li>
            <a href="../files/app/models/hierarchy_entry_rb.html">app/models/hierarchy_entry.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a href="SpeciesSchemaModel.html">SpeciesSchemaModel</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            Represents an entry in the Tree of Life (see <a
            href="Hierarchy.html">Hierarchy</a>)
            </p>
            <p>
            hierarchy is the &#8216;version&#8217; of the Tree of Life (every year a
            new list of all species comes out) rank is &#8230; ? <a
            href="HierarchyEntry.html#M000207">name</a> is &#8230; ?
            </p>
            <p>
            TODO - ADD COMMENTS
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000220">infraspecies_rank</a></li>
              <li><a href="#M000221">leaf_node_ranks</a></li>
              <li><a href="#M000235">node_xml</a></li>
              <li><a href="#M000219">species_rank</a></li>
              <li><a href="#M000218">with_parents</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000228">ancestors</a></li>
              <li><a href="#M000229">ancestors_hash</a></li>
              <li><a href="#M000214">approved_curators</a></li>
              <li><a href="#M000230">children_hash</a></li>
              <li><a href="#M000236">classification</a></li>
              <li><a href="#M000237">classification_attribution</a></li>
              <li><a href="#M000211">content_level</a></li>
              <li><a href="#M000227">enable</a></li>
              <li><a href="#M000216">hierarchy_entries_with_parents</a></li>
              <li><a href="#M000223">images</a></li>
              <li><a href="#M000217">is_curatable_by?</a></li>
              <li><a href="#M000222">is_leaf_node?</a></li>
              <li><a href="#M000213">iucn</a></li>
              <li><a href="#M000231">kingdom</a></li>
              <li><a href="#M000225">map</a></li>
              <li><a href="#M000210">media</a></li>
              <li><a href="#M000207">name</a></li>
              <li><a href="#M000212">rank_label</a></li>
              <li><a href="#M000208">raw_name</a></li>
              <li><a href="#M000234">smart_image</a></li>
              <li><a href="#M000233">smart_medium_thumb</a></li>
              <li><a href="#M000232">smart_thumb</a></li>
              <li><a href="#M000209">toc</a></li>
              <li><a href="#M000226">valid</a></li>
              <li><a href="#M000224">videos</a></li>
              <li><a href="#M000215">with_parents</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='public-class method' id='method-M000220'>
                <a name='M000220'>      </a>
                <div class='synopsis'>
                  <span class='name'>infraspecies_rank</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000220-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000220-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 153</span>&#x000A;153:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">infraspecies_rank</span>&#x000A;154:     <span class="ruby-value">175</span>&#x000A;155:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000221'>
                <a name='M000221'>      </a>
                <div class='synopsis'>
                  <span class='name'>leaf_node_ranks</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000221-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000221-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 157</span>&#x000A;157:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">leaf_node_ranks</span>&#x000A;158:     [<span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">species_rank</span>, <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">infraspecies_rank</span>]&#x000A;159:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000235'>
                <a name='M000235'>      </a>
                <div class='synopsis'>
                  <span class='name'>node_xml</span>
                  <span class='arguments'>(entry_node)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000235-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000235-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 245</span>&#x000A;245:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">node_xml</span>(<span class="ruby-identifier">entry_node</span>)&#x000A;246:     <span class="ruby-identifier">node</span>  = <span class="ruby-value str">&quot;\t\t&lt;node&gt;\n&quot;</span>;&#x000A;247:     <span class="ruby-identifier">node</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;\t\t\t&lt;taxonID&gt;#{entry_node[:hierarchy_entry_id]}&lt;/taxonID&gt;\n&quot;</span>;&#x000A;248:     <span class="ruby-identifier">node</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;\t\t\t&lt;nameString&gt;#{CGI::escapeHTML entry_node[:name]}&lt;/nameString&gt;\n&quot;</span>;&#x000A;249:     <span class="ruby-identifier">node</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;\t\t\t&lt;rankName&gt;#{CGI::escapeHTML entry_node[:rank_string]}&lt;/rankName&gt;\n&quot;</span>;&#x000A;250:     <span class="ruby-identifier">node</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;\t\t\t&lt;valid&gt;#{entry_node[:valid]}&lt;/valid&gt;\n&quot;</span>;&#x000A;251:     <span class="ruby-identifier">node</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;\t\t\t&lt;enable&gt;#{entry_node[:enable]}&lt;/enable&gt;\n&quot;</span>;&#x000A;252:     <span class="ruby-identifier">node</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\t\t&lt;/node&gt;\n&quot;</span>;&#x000A;253:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000219'>
                <a name='M000219'>      </a>
                <div class='synopsis'>
                  <span class='name'>species_rank</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000219-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000219-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 149</span>&#x000A;149:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">species_rank</span>&#x000A;150:     <span class="ruby-value">335</span>&#x000A;151:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000218'>
                <a name='M000218'>      </a>
                <div class='synopsis'>
                  <span class='name'>with_parents</span>
                  <span class='arguments'>(taxon_concept_or_hierarchy_entry = nil)</span>
                </div>
                <div class='description'>
                  <p>
                  this is meant to be filtered by a taxon concept so it will find all
                  hierarchy entries AND their ancestors/parents for a given <a
                  href="TaxonConcept.html">TaxonConcept</a>
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000218-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000218-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 135</span>&#x000A;135:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">with_parents</span> <span class="ruby-identifier">taxon_concept_or_hierarchy_entry</span> = <span class="ruby-keyword kw">nil</span>&#x000A;136:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">taxon_concept_or_hierarchy_entry</span>.<span class="ruby-identifier">is_a?</span><span class="ruby-constant">TaxonConcept</span>&#x000A;137:       <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">find_all_by_taxon_concept_id</span>(<span class="ruby-identifier">taxon_concept_or_hierarchy_entry</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">all</span>, <span class="ruby-identifier">he</span><span class="ruby-operator">|</span>&#x000A;138:         <span class="ruby-identifier">all</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">he</span>&#x000A;139:         <span class="ruby-identifier">all</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">he</span>.<span class="ruby-identifier">ancestors</span>&#x000A;140:         <span class="ruby-identifier">all</span>&#x000A;141:       <span class="ruby-keyword kw">end</span>&#x000A;142:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">taxon_concept_or_hierarchy_entry</span>.<span class="ruby-identifier">is_a?</span><span class="ruby-constant">HierarchyEntry</span>&#x000A;143:       [<span class="ruby-identifier">taxon_concept_or_hierarchy_entry</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">taxon_concept_or_hierarchy_entry</span>.<span class="ruby-identifier">ancestors</span>&#x000A;144:     <span class="ruby-keyword kw">else</span>&#x000A;145:       <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Don't know how to return with_parents for #{ taxon_concept_or_hierarchy_entry.inspect }&quot;</span>&#x000A;146:     <span class="ruby-keyword kw">end</span>&#x000A;147:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000228'>
                <a name='M000228'>      </a>
                <div class='synopsis'>
                  <span class='name'>ancestors</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000228-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000228-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 189</span>&#x000A;189:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ancestors</span>&#x000A;190:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@ancestors</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@ancestors</span>.<span class="ruby-identifier">nil?</span>&#x000A;191:     <span class="ruby-ivar">@ancestors</span> = [<span class="ruby-keyword kw">self</span>]&#x000A;192:     <span class="ruby-ivar">@ancestors</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">find_default_hierarchy_ancestor</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hierarchy_id</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Hierarchy</span>.<span class="ruby-identifier">default</span>.<span class="ruby-identifier">id</span>&#x000A;193:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ancestors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">nil?</span>&#x000A;194:       <span class="ruby-ivar">@ancestors</span> = [<span class="ruby-keyword kw">self</span>]&#x000A;195:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@ancestors</span>&#x000A;196:     <span class="ruby-keyword kw">end</span>&#x000A;197:     <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@ancestors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">do</span>&#x000A;198:       <span class="ruby-ivar">@ancestors</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-ivar">@ancestors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parent</span>) &#x000A;199:     <span class="ruby-keyword kw">end</span> &#x000A;200:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@ancestors</span>&#x000A;201:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000229'>
                <a name='M000229'>      </a>
                <div class='synopsis'>
                  <span class='name'>ancestors_hash</span>
                  <span class='arguments'>(detail_level = :middle, language = Language.english)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000229-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000229-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 203</span>&#x000A;203:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ancestors_hash</span>(<span class="ruby-identifier">detail_level</span> = <span class="ruby-identifier">:middle</span>, <span class="ruby-identifier">language</span> = <span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span>)&#x000A;204:     <span class="ruby-identifier">language</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span> <span class="ruby-comment cmt"># Not sure why; this didn't work as a default to the argument.</span>&#x000A;205:     &#x000A;206:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hierarchy_id</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Hierarchy</span>.<span class="ruby-identifier">default</span>.<span class="ruby-identifier">id</span>&#x000A;207:       <span class="ruby-identifier">entry_in_common</span> = <span class="ruby-identifier">find_default_hierarchy_ancestor</span>&#x000A;208:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">entry_in_common</span>.<span class="ruby-identifier">ancestors_hash</span>(<span class="ruby-identifier">detail_level</span>, <span class="ruby-identifier">language</span>)&#x000A;209:     <span class="ruby-keyword kw">end</span>&#x000A;210:     &#x000A;211:     <span class="ruby-identifier">ancestors_ids</span> = <span class="ruby-identifier">ancestors</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">id</span>}&#x000A;212:     <span class="ruby-identifier">nodes</span> = <span class="ruby-constant">SpeciesSchemaModel</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;SELECT n1.string scientific_name, n1.italicized scientific_name_italicized, n2.string common_name, n2.italicized common_name_italicized, he.taxon_concept_id id, he.id hierarchy_entry_id, he.lft lft, he.rgt rgt, he.rank_id, hc.content_level content_level, hc.image image, hc.text text, hc.child_image child_image, r.label rank_string FROM hierarchy_entries he JOIN names n1 ON (he.name_id=n1.id) JOIN hierarchies_content hc ON (he.id=hc.hierarchy_entry_id) LEFT JOIN (taxon_concept_names tcn JOIN names n2 ON (tcn.name_id=n2.id)) ON (he.taxon_concept_id=tcn.taxon_concept_id AND tcn.preferred=1 AND tcn.language_id=#{language.id}) LEFT JOIN ranks r ON (he.rank_id=r.id) WHERE he.id in (#{ancestors_ids.join(&quot;,&quot;)}) ORDER BY he.lft ASC&quot;</span>).<span class="ruby-identifier">all_hashes</span>&#x000A;213:     &#x000A;214:     <span class="ruby-identifier">nodes</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span> &#x000A;215:       <span class="ruby-identifier">node_to_hash</span>(<span class="ruby-identifier">node</span>, <span class="ruby-identifier">detail_level</span>)&#x000A;216:     <span class="ruby-keyword kw">end</span>&#x000A;217:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000214'>
                <a name='M000214'>      </a>
                <div class='synopsis'>
                  <span class='name'>approved_curators</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000214-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000214-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 116</span>&#x000A;116:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">approved_curators</span>&#x000A;117:     <span class="ruby-identifier">he_all</span> = <span class="ruby-constant">TaxonConcept</span>.<span class="ruby-identifier">direct_ancestors</span>(<span class="ruby-identifier">taxon_concept</span>)&#x000A;118:     <span class="ruby-identifier">ids</span> = <span class="ruby-identifier">he_all</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">he</span><span class="ruby-operator">|</span> <span class="ruby-identifier">he</span>.<span class="ruby-identifier">id</span> <span class="ruby-keyword kw">end</span>&#x000A;119:     <span class="ruby-identifier">all</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;curator_hierarchy_entry_id IN (#{ids.join(',')}) and curator_approved IS TRUE&quot;</span>])&#x000A;120:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">all</span>&#x000A;121:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000230'>
                <a name='M000230'>      </a>
                <div class='synopsis'>
                  <span class='name'>children_hash</span>
                  <span class='arguments'>(detail_level = :middle, language = Language.english)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000230-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000230-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 219</span>&#x000A;219:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children_hash</span>(<span class="ruby-identifier">detail_level</span> = <span class="ruby-identifier">:middle</span>, <span class="ruby-identifier">language</span> = <span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span>)&#x000A;220:     <span class="ruby-identifier">language</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span> <span class="ruby-comment cmt"># Not sure why; this didn't work as a default to the argument.</span>&#x000A;221:         &#x000A;222:     <span class="ruby-identifier">children</span> = <span class="ruby-constant">SpeciesSchemaModel</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;SELECT n1.string scientific_name, n1.italicized scientific_name_italicized, n2.string common_name, n2.italicized common_name_italicized, he.taxon_concept_id id, he.id hierarchy_entry_id, he.lft lft, he.rgt rgt, he.rank_id, hc.content_level content_level, hc.image image, hc.text text, hc.child_image child_image, r.label rank_string FROM hierarchy_entries he JOIN names n1 ON (he.name_id=n1.id) JOIN hierarchies_content hc ON (he.id=hc.hierarchy_entry_id) LEFT JOIN (taxon_concept_names tcn JOIN names n2 ON (tcn.name_id=n2.id)) ON (he.taxon_concept_id=tcn.taxon_concept_id AND tcn.preferred=1 AND tcn.language_id=#{language.id}) LEFT JOIN ranks r ON (he.rank_id=r.id) WHERE he.parent_id=#{id} GROUP BY he.taxon_concept_id&quot;</span>).<span class="ruby-identifier">all_hashes</span>&#x000A;223:     &#x000A;224:     <span class="ruby-identifier">children</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>&#x000A;225:       <span class="ruby-identifier">node_to_hash</span>(<span class="ruby-identifier">node</span>, <span class="ruby-identifier">detail_level</span>)&#x000A;226:     <span class="ruby-keyword kw">end</span>&#x000A;227:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000236'>
                <a name='M000236'>      </a>
                <div class='synopsis'>
                  <span class='name'>classification</span>
                  <span class='arguments'>(options = {})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000236-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000236-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 255</span>&#x000A;255:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">classification</span>(<span class="ruby-identifier">options</span> = {})&#x000A;256: &#x000A;257:     <span class="ruby-identifier">current_user</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:current_user</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">create_new</span>&#x000A;258:     &#x000A;259:     <span class="ruby-identifier">ancestor_hash</span> = <span class="ruby-identifier">ancestors_hash</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">expertise</span>, <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">language</span>)&#x000A;260:     <span class="ruby-identifier">child_hash</span> = <span class="ruby-identifier">children_hash</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">expertise</span>, <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">language</span>).<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span>&#x000A;261:                        <span class="ruby-identifier">a</span>[<span class="ruby-identifier">:name</span>] <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>[<span class="ruby-identifier">:name</span>] }&#x000A;262:     &#x000A;263:     <span class="ruby-identifier">xml</span>  = <span class="ruby-value str">&quot;&lt;results&gt;\n&quot;</span>&#x000A;264:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\t&lt;ancestry&gt;\n&quot;</span>&#x000A;265:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">ancestor_hash</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>].<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">node_xml</span>(<span class="ruby-identifier">a</span>)}.<span class="ruby-identifier">join</span>&#x000A;266:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\t&lt;/ancestry&gt;\n&quot;</span>&#x000A;267:     &#x000A;268:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\t&lt;current&gt;\n&quot;</span>;&#x000A;269:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">ancestor_hash</span>[<span class="ruby-value">-1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">node_xml</span>(<span class="ruby-identifier">a</span>)}.<span class="ruby-identifier">join</span>&#x000A;270:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\t&lt;/current&gt;\n&quot;</span>;&#x000A;271:     &#x000A;272:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\t&lt;children&gt;\n&quot;</span>&#x000A;273:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">child_hash</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">node_xml</span>(<span class="ruby-identifier">a</span>)}.<span class="ruby-identifier">join</span>&#x000A;274:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\t&lt;/children&gt;\n&quot;</span>&#x000A;275:     &#x000A;276:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\t&lt;kingdoms&gt;\n&quot;</span>&#x000A;277:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Hierarchy</span>.<span class="ruby-identifier">default</span>.<span class="ruby-identifier">kingdoms_hash</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">expertise</span>, <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">language</span>).<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">node_xml</span>(<span class="ruby-identifier">a</span>)}.<span class="ruby-identifier">join</span>&#x000A;278:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;\t&lt;/kingdoms&gt;\n&quot;</span>&#x000A;279:     &#x000A;280:     <span class="ruby-comment cmt"># siblings = HierarchyEntry.find_all_by_parent_id_and_hierarchy_id(self.parent_id, self.hierarchy_id, :include =&gt; :name)</span>&#x000A;281:     <span class="ruby-comment cmt"># siblings.delete_if {|sib| sib.id == self.id } # We don't want the current entry in this list!</span>&#x000A;282:     <span class="ruby-comment cmt"># siblings = siblings.sort_by {|entry| entry.name(current_user.expertise, current_user.language) }</span>&#x000A;283:     <span class="ruby-comment cmt"># xml += xml_for_group(siblings, 'siblings', current_user) unless siblings.empty?</span>&#x000A;284:     <span class="ruby-comment cmt"># </span>&#x000A;285:     <span class="ruby-comment cmt"># xml += &quot;\t&lt;attribution&gt;\n&quot;;</span>&#x000A;286:     <span class="ruby-comment cmt"># xml += classification_attribution.collect {|ca| ca.node_xml}.join</span>&#x000A;287:     <span class="ruby-comment cmt"># xml += &quot;\t&lt;/attribution&gt;\n&quot;;</span>&#x000A;288:     <span class="ruby-identifier">xml</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;&lt;/results&gt;\n&quot;</span>;&#x000A;289: &#x000A;290:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000237'>
                <a name='M000237'>      </a>
                <div class='synopsis'>
                  <span class='name'>classification_attribution</span>
                  <span class='arguments'>(params={})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000237-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000237-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 292</span>&#x000A;292:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">classification_attribution</span>(<span class="ruby-identifier">params</span>={})&#x000A;293:     <span class="ruby-identifier">attribution</span>=<span class="ruby-identifier">hierarchy</span>.<span class="ruby-identifier">label</span>&#x000A;294:     <span class="ruby-identifier">attribution</span> = [<span class="ruby-identifier">hierarchy</span>.<span class="ruby-identifier">agent</span>]&#x000A;295:     <span class="ruby-identifier">attribution</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">full_name</span> = <span class="ruby-identifier">attribution</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">display_name</span> = <span class="ruby-identifier">hierarchy</span>.<span class="ruby-identifier">label</span> <span class="ruby-comment cmt"># To change the name from just &quot;Catalogue of Life&quot;</span>&#x000A;296:     <span class="ruby-identifier">attribution</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">agents</span>&#x000A;297:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000211'>
                <a name='M000211'>      </a>
                <div class='synopsis'>
                  <span class='name'>content_level</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  This is a complete port of content_level_sub() from functions.php:
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000211-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000211-source'>    <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 76</span>&#x000A;76:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">content_level</span>&#x000A;77:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_leaf_node?</span>&#x000A;78:       <span class="ruby-keyword kw">return</span> <span class="ruby-value">4</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">content_level</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>&#x000A;79:       <span class="ruby-keyword kw">return</span> <span class="ruby-value">3</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">text</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>&#x000A;80:       <span class="ruby-keyword kw">return</span> <span class="ruby-value">1</span>&#x000A;81:     <span class="ruby-keyword kw">else</span>&#x000A;82:       <span class="ruby-keyword kw">return</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">nil?</span>&#x000A;83:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">content_level</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">content_level</span>&#x000A;84:     <span class="ruby-keyword kw">end</span>&#x000A;85:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000227'>
                <a name='M000227'>      </a>
                <div class='synopsis'>
                  <span class='name'>enable</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000227-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000227-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 184</span>&#x000A;184:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">enable</span>&#x000A;185:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">nil?</span>&#x000A;186:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">is_leaf_node?</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">text</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">image</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">valid</span>&#x000A;187:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000216'>
                <a name='M000216'>      </a>
                <div class='synopsis'>
                  <span class='name'>hierarchy_entries_with_parents</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Alias for <a href="HierarchyEntry.html#M000215">with_parents</a>
                  </p>
                </div>
              </div>
              <div class='public-instance method' id='method-M000223'>
                <a name='M000223'>      </a>
                <div class='synopsis'>
                  <span class='name'>images</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Singleton. top_images, from which this is based, rarely changes.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000223-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000223-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 166</span>&#x000A;166:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">images</span>()&#x000A;167:     <span class="ruby-ivar">@images</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">images_for_hierarchy_entry</span>(<span class="ruby-identifier">id</span>)&#x000A;168:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000217'>
                <a name='M000217'>      </a>
                <div class='synopsis'>
                  <span class='name'>is_curatable_by?</span>
                  <span class='arguments'>(user)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000217-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000217-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 128</span>&#x000A;128:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_curatable_by?</span> <span class="ruby-identifier">user</span>&#x000A;129:     <span class="ruby-identifier">hierarchy_entries_with_parents_above_clade</span> = <span class="ruby-constant">TaxonConcept</span>.<span class="ruby-identifier">direct_ancestors</span>(<span class="ruby-identifier">taxon_concept</span>)&#x000A;130:     <span class="ruby-identifier">permitted</span> = <span class="ruby-identifier">hierarchy_entries_with_parents_above_clade</span>.<span class="ruby-identifier">find</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">curator_hierarchy_entry_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">id</span> }&#x000A;131:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">permitted</span> <span class="ruby-keyword kw">then</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">else</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">end</span>&#x000A;132:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000222'>
                <a name='M000222'>      </a>
                <div class='synopsis'>
                  <span class='name'>is_leaf_node?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000222-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000222-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 161</span>&#x000A;161:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_leaf_node?</span>&#x000A;162:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">leaf_node_ranks</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">rank_id</span>)&#x000A;163:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000213'>
                <a name='M000213'>      </a>
                <div class='synopsis'>
                  <span class='name'>iucn</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000213-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000213-source'>    <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 93</span>&#x000A;93:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">iucn</span>&#x000A;94:     <span class="ruby-comment cmt"># So, this used to add &quot;dato.data_type_id = #{DaataType.find_by_label('Text')}&quot;.  But an intial version of the DB had IUCN types as</span>&#x000A;95:     <span class="ruby-comment cmt"># images. I removed it, thinking that it doesn't really matter in the case of IUCN stuff... it'll only ever be one object, so we</span>&#x000A;96:     <span class="ruby-comment cmt"># don't much care.</span>&#x000A;97:     <span class="ruby-identifier">my_iucn</span> = <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;\n    SELECT dato.*\n      FROM resources r, agents_resources ar, data_objects dato, concepts c, taxa t, data_objects_taxa dot\n      WHERE\n        dot.data_object_id = dato.id AND\n        dot.taxon_id = t.id AND\n        t.resource_id = r.id AND\n        c.name_id = t.name_id AND\n        c.hierarchy_entry_id = ? AND\n        ar.resource_id = r.id AND\n        ar.agent_id = ?\n      LIMIT 1 # iucn\n\n&quot;</span>, <span class="ruby-identifier">id</span>, <span class="ruby-constant">Agent</span>.<span class="ruby-identifier">iucn</span>.<span class="ruby-identifier">id</span>])&#x000A;98:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">my_iucn</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:source_url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'http://www.iucnredlist.org/'</span>, <span class="ruby-identifier">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'NOT EVALUATED'</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">my_iucn</span>&#x000A;99:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000231'>
                <a name='M000231'>      </a>
                <div class='synopsis'>
                  <span class='name'>kingdom</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000231-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000231-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 229</span>&#x000A;229:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">kingdom</span>&#x000A;230:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ancestors</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>&#x000A;231:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000225'>
                <a name='M000225'>      </a>
                <div class='synopsis'>
                  <span class='name'>map</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000225-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000225-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 175</span>&#x000A;175:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">map</span>&#x000A;176:     <span class="ruby-ivar">@map</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">map_for_hierarchy_entry</span>(<span class="ruby-identifier">id</span>)&#x000A;177:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000210'>
                <a name='M000210'>      </a>
                <div class='synopsis'>
                  <span class='name'>media</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000210-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000210-source'>    <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 69</span>&#x000A;69:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">media</span>&#x000A;70:     {<span class="ruby-identifier">:images</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">image</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">child_image</span>  <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>,&#x000A;71:      <span class="ruby-identifier">:video</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">flash</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">youtube</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>,&#x000A;72:      <span class="ruby-identifier">:map</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">gbif_image</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>}&#x000A;73:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000207'>
                <a name='M000207'>      </a>
                <div class='synopsis'>
                  <span class='name'>name</span>
                  <span class='arguments'>(detail_level = :middle, language = Language.english, context = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000207-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000207-source'>    <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 26</span>&#x000A;26:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">name</span>(<span class="ruby-identifier">detail_level</span> = <span class="ruby-identifier">:middle</span>, <span class="ruby-identifier">language</span> = <span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span>, <span class="ruby-identifier">context</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;27:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">raw_name</span>(<span class="ruby-identifier">detail_level</span>, <span class="ruby-identifier">language</span>, <span class="ruby-identifier">context</span>).<span class="ruby-identifier">firstcap</span>&#x000A;28:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000212'>
                <a name='M000212'>      </a>
                <div class='synopsis'>
                  <span class='name'>rank_label</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000212-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000212-source'>    <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 87</span>&#x000A;87:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rank_label</span>&#x000A;88:     &#x000A;89:     <span class="ruby-identifier">rank</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot;taxon&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">rank</span>.<span class="ruby-identifier">label</span>&#x000A;90:     &#x000A;91:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000208'>
                <a name='M000208'>      </a>
                <div class='synopsis'>
                  <span class='name'>raw_name</span>
                  <span class='arguments'>(detail_level = :middle, language = Language.english, context = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000208-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000208-source'>    <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 30</span>&#x000A;30:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">raw_name</span>(<span class="ruby-identifier">detail_level</span> = <span class="ruby-identifier">:middle</span>, <span class="ruby-identifier">language</span> = <span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span>, <span class="ruby-identifier">context</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;31:     <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'?'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:name_id</span>].<span class="ruby-identifier">nil?</span>&#x000A;32:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">detail_level</span>.<span class="ruby-identifier">to_sym</span>&#x000A;33:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:italicized_canonical</span>&#x000A;34:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name_object</span>.<span class="ruby-identifier">italicized_canonical</span>&#x000A;35:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:canonical</span>&#x000A;36:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name_object</span>.<span class="ruby-identifier">canonical</span>&#x000A;37:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:natural_form</span>&#x000A;38:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name_object</span>.<span class="ruby-identifier">string</span>&#x000A;39:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:expert</span>&#x000A;40:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">context</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:classification</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">leaf_node_ranks</span>.<span class="ruby-identifier">include?</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:rank_id</span>]&#x000A;41:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">name_object</span>.<span class="ruby-identifier">string</span>&#x000A;42:       <span class="ruby-keyword kw">else</span>&#x000A;43:         <span class="ruby-comment cmt"># TODO - there are cases here where we need to pay attention to language.</span>&#x000A;44:         <span class="ruby-identifier">italics</span> = <span class="ruby-identifier">name_object</span>.<span class="ruby-identifier">italicized</span>&#x000A;45:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">italics</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">?&#x000A;46: </span>            <span class="ruby-node">&quot;&lt;i&gt;#{name_object.string.firstcap}&lt;/i&gt;&quot;</span> <span class="ruby-operator">:</span>&#x000A;47:             <span class="ruby-identifier">italics</span>&#x000A;48:       <span class="ruby-keyword kw">end</span>&#x000A;49:     <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># :middle  (though we don't want to rely on that)</span>&#x000A;50:       <span class="ruby-identifier">language</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Language</span>.<span class="ruby-identifier">english</span> <span class="ruby-comment cmt"># Not sure why; this didn't work as a default to the argument.</span>&#x000A;51:       <span class="ruby-identifier">common_name</span> = <span class="ruby-constant">TaxonConceptName</span>.<span class="ruby-identifier">find_by_taxon_concept_id_and_language_id_and_vern_and_preferred</span>(<span class="ruby-identifier">taxon_concept_id</span>, <span class="ruby-identifier">language</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span>)&#x000A;52:       <span class="ruby-identifier">common_name</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">TaxonConceptName</span>.<span class="ruby-identifier">find_by_taxon_concept_id_and_language_id_and_vern</span>(<span class="ruby-identifier">taxon_concept_id</span>, <span class="ruby-identifier">language</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">1</span>)&#x000A;53:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">common_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">context</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:object</span> <span class="ruby-comment cmt"># This allows people to get the name and its language.</span>&#x000A;54:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">common_name</span>.<span class="ruby-identifier">nil?</span>&#x000A;55:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">context</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:classification</span>&#x000A;56:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">raw_name</span>(<span class="ruby-identifier">:expert</span>, <span class="ruby-identifier">language</span>, <span class="ruby-identifier">:classification</span>)&#x000A;57:         <span class="ruby-keyword kw">else</span>&#x000A;58:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">raw_name</span>(<span class="ruby-identifier">:italicized_canonical</span>)&#x000A;59:         <span class="ruby-keyword kw">end</span>&#x000A;60:       <span class="ruby-keyword kw">end</span>&#x000A;61:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">common_name</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">string</span>&#x000A;62:     <span class="ruby-keyword kw">end</span>&#x000A;63:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000234'>
                <a name='M000234'>      </a>
                <div class='synopsis'>
                  <span class='name'>smart_image</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000234-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000234-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 241</span>&#x000A;241:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">smart_image</span>&#x000A;242:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">smart_image</span>&#x000A;243:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000233'>
                <a name='M000233'>      </a>
                <div class='synopsis'>
                  <span class='name'>smart_medium_thumb</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000233-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000233-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 237</span>&#x000A;237:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">smart_medium_thumb</span>&#x000A;238:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">smart_medium_thumb</span>&#x000A;239:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000232'>
                <a name='M000232'>      </a>
                <div class='synopsis'>
                  <span class='name'>smart_thumb</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000232-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000232-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 233</span>&#x000A;233:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">smart_thumb</span>&#x000A;234:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">smart_thumb</span>&#x000A;235:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000209'>
                <a name='M000209'>      </a>
                <div class='synopsis'>
                  <span class='name'>toc</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000209-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000209-source'>    <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 65</span>&#x000A;65:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">toc</span>&#x000A;66:     <span class="ruby-constant">TocItem</span>.<span class="ruby-identifier">toc_for</span>(<span class="ruby-identifier">id</span>)&#x000A;67:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000226'>
                <a name='M000226'>      </a>
                <div class='synopsis'>
                  <span class='name'>valid</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000226-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000226-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 179</span>&#x000A;179:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">valid</span>&#x000A;180:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-comment cmt"># This really only happens in test environ, but...</span>&#x000A;181:     <span class="ruby-identifier">hierarchies_content</span>.<span class="ruby-identifier">content_level</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">$VALID_CONTENT_LEVEL</span>&#x000A;182:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000224'>
                <a name='M000224'>      </a>
                <div class='synopsis'>
                  <span class='name'>videos</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Singleton. Videos also rarely change.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000224-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000224-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 171</span>&#x000A;171:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">videos</span>&#x000A;172:     <span class="ruby-ivar">@videos</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">videos_for_hierarchy_entry</span>(<span class="ruby-identifier">id</span>)&#x000A;173:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000215'>
                <a name='M000215'>      </a>
                <div class='synopsis'>
                  <span class='name'>with_parents</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000215-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000215-source'>     <span class="ruby-comment cmt"># File app/models/hierarchy_entry.rb, line 123</span>&#x000A;123:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_parents</span>&#x000A;124:     <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">with_parents</span> <span class="ruby-keyword kw">self</span>&#x000A;125:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
