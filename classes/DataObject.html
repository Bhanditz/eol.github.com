<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Class: DataObject [Rails Application Documentation]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='.././rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          DataObject
        </h1>
        <ol class='paths'>
          <li>
            <a href="../files/app/models/data_object_rb.html">app/models/data_object.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a href="SpeciesSchemaModel.html">SpeciesSchemaModel</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000391">build_query</a></li>
              <li><a href="#M000350">cache_path</a></li>
              <li><a href="#M000389">cached_images_for_taxon</a></li>
              <li><a href="#M000390">for_taxon</a></li>
              <li><a href="#M000351">image_cache_path</a></li>
              <li><a href="#M000339">images_for_hierarchy_entry</a></li>
              <li><a href="#M000386">search_by_tag</a></li>
              <li><a href="#M000387">search_by_tags</a></li>
              <li><a href="#M000388">search_tags_group</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000341">attributions</a></li>
              <li><a href="#M000342">authors</a></li>
              <li><a href="#M000337">comment</a></li>
              <li><a href="#M000370">curate!</a></li>
              <li><a href="#M000371">curated?</a></li>
              <li><a href="#M000340">data_supplier_agent</a></li>
              <li><a href="#M000344">fake_author</a></li>
              <li><a href="#M000353">has_object_cache_url?</a></li>
              <li><a href="#M000352">has_thumbnail_cache?</a></li>
              <li><a href="#M000381">hide!</a></li>
              <li><a href="#M000369">hierarchy_entries</a></li>
              <li><a href="#M000347">image?</a></li>
              <li><a href="#M000384">inappropriate!</a></li>
              <li><a href="#M000374">inappropriate?</a></li>
              <li><a href="#M000373">invisible?</a></li>
              <li><a href="#M000338">is_curatable_by?</a></li>
              <li><a href="#M000378">is_vetted?</a></li>
              <li><a href="#M000348">map?</a></li>
              <li><a href="#M000359">map_image</a></li>
              <li><a href="#M000343">photographers</a></li>
              <li><a href="#M000362">private_tags</a></li>
              <li><a href="#M000361">public_tags</a></li>
              <li><a href="#M000380">show!</a></li>
              <li><a href="#M000357">smart_image</a></li>
              <li><a href="#M000356">smart_medium_thumb</a></li>
              <li><a href="#M000355">smart_thumb</a></li>
              <li><a href="#M000345">sources</a></li>
              <li><a href="#M000360">tag</a></li>
              <li><a href="#M000367">tag_keys</a></li>
              <li><a href="#M000366">tags_hash</a></li>
              <li><a href="#M000365">taxa_names_taxon_concept_ids</a></li>
              <li><a href="#M000368">taxon_concepts</a></li>
              <li><a href="#M000349">text?</a></li>
              <li><a href="#M000354">thumb_or_object</a></li>
              <li><a href="#M000385">to_s</a></li>
              <li><a href="#M000379">trusted?</a></li>
              <li><a href="#M000376">unknown?</a></li>
              <li><a href="#M000375">untrusted?</a></li>
              <li><a href="#M000383">unvet!</a></li>
              <li><a href="#M000363">user_tags</a></li>
              <li><a href="#M000364">users_tags</a></li>
              <li><a href="#M000382">vet!</a></li>
              <li><a href="#M000377">vetted?</a></li>
              <li><a href="#M000358">video_url</a></li>
              <li><a href="#M000372">visible?</a></li>
              <li><a href="#M000346">visible_comments</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>vetted_by</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='public-class method' id='method-M000391'>
                <a name='M000391'>      </a>
                <div class='synopsis'>
                  <span class='name'>build_query</span>
                  <span class='arguments'>(taxon, type, options)</span>
                </div>
                <div class='description'>
                  <p>
                  TODO - MED PRIORITY - I&#8217;m assuming there&#8217;s one taxa for this
                  data object, and there could be several. TODO = licenses should simply be
                  included, and referenced directly where needed.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000391-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000391-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 500</span>&#x000A;500:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build_query</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">options</span>)&#x000A;501:     <span class="ruby-identifier">add_toc</span>      = (<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:text</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:toc_id</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">', toc.*'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>&#x000A;502:     <span class="ruby-identifier">join_agents</span>  = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:agent</span>].<span class="ruby-identifier">nil?</span>  <span class="ruby-value">? </span><span class="ruby-value str">''</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">join_agents_clause</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:agent</span>])&#x000A;503:     <span class="ruby-identifier">join_toc</span>     = <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:text</span>         <span class="ruby-operator">?</span> <span class="ruby-value str">'JOIN data_objects_table_of_contents dotoc ON dotoc.data_object_id = dato.id '</span> <span class="ruby-operator">+</span>&#x000A;504:                                                  <span class="ruby-value str">'JOIN table_of_contents toc ON toc.id = dotoc.toc_id'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>&#x000A;505:     <span class="ruby-identifier">where_toc</span>    = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:toc_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-value str">''</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">sanitize_sql</span>([<span class="ruby-value str">'AND toc.id = ?'</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:toc_id</span>]])&#x000A;506:     <span class="ruby-identifier">sort</span>         = <span class="ruby-value str">'dato.published, dato.vetted_id DESC, dato.data_rating'</span> <span class="ruby-comment cmt"># unpublished first, then by data_rating.</span>&#x000A;507: &#x000A;508:     <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">sanitize_sql</span>([<span class="ruby-value str">&quot;\nSELECT DISTINCT dt.label media_type, dato.*, t.scientific_name, tcn.taxon_concept_id taxon_id,\n       l.description license_text, l.logo_url license_logo, l.source_url license_url \#{add_toc}\n  FROM taxon_concept_names tcn\n    STRAIGHT_JOIN taxa t                ON (tcn.name_id = t.name_id)\n    STRAIGHT_JOIN data_objects_taxa dot ON (t.id = dot.taxon_id)\n    STRAIGHT_JOIN data_objects dato     ON (dot.data_object_id = dato.id)\n    STRAIGHT_JOIN data_types dt         ON (dato.data_type_id = dt.id)\n    \#{join_agents} \#{join_toc}\n    LEFT OUTER JOIN licenses l       ON (dato.license_id = l.id)\n  WHERE tcn.taxon_concept_id = ?\n    AND data_type_id IN (?)\n    \#{DataObject.visibility_clause(options.merge(:taxon =&gt; taxon))}\n    \#{where_toc}\n  ORDER BY \#{sort} # DataObject.for_taxon\n\n&quot;</span>, <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">id</span>, <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">get_type_ids</span>(<span class="ruby-identifier">type</span>)])&#x000A;509: &#x000A;510:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000350'>
                <a name='M000350'>      </a>
                <div class='synopsis'>
                  <span class='name'>cache_path</span>
                  <span class='arguments'>(cache_url, subdir = $CONTENT_SERVER_CONTENT_PATH)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000350-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000350-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 189</span>&#x000A;189:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cache_path</span>(<span class="ruby-identifier">cache_url</span>, <span class="ruby-identifier">subdir</span> = <span class="ruby-identifier">$CONTENT_SERVER_CONTENT_PATH</span>)&#x000A;190:     (<span class="ruby-constant">ContentServer</span>.<span class="ruby-identifier">next</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">subdir</span> <span class="ruby-operator">+</span>&#x000A;191:       <span class="ruby-identifier">cache_url</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/(\d{4})(\d{2})(\d{2})(\d{2})(\d+)/</span>, <span class="ruby-value str">&quot;/\\1/\\2/\\3/\\4/\\5&quot;</span>))&#x000A;192:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000389'>
                <a name='M000389'>      </a>
                <div class='synopsis'>
                  <span class='name'>cached_images_for_taxon</span>
                  <span class='arguments'>(taxon, options = {})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000389-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000389-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 447</span>&#x000A;447:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cached_images_for_taxon</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">options</span> = {})&#x000A;448:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>] = <span class="ruby-constant">User</span>.<span class="ruby-identifier">create_new</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">nil?</span>&#x000A;449:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:from</span>].<span class="ruby-identifier">nil?</span>&#x000A;450:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:from</span>] <span class="ruby-operator">||=</span> <span class="ruby-value str">'top_images'</span>&#x000A;451:     <span class="ruby-keyword kw">else</span>&#x000A;452:       <span class="ruby-identifier">nested</span> = <span class="ruby-keyword kw">true</span>&#x000A;453:     <span class="ruby-keyword kw">end</span>&#x000A;454:     <span class="ruby-identifier">join_agents</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:agent</span>].<span class="ruby-identifier">nil?</span>  <span class="ruby-value">? </span><span class="ruby-value str">''</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">join_agents_clause</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:agent</span>]) <span class="ruby-keyword kw">if</span>&#x000A;455:         <span class="ruby-identifier">nested</span>&#x000A;456:     <span class="ruby-comment cmt"># NOTE - left join on the licenses, so they could be NULL.</span>&#x000A;457:     <span class="ruby-comment cmt"># (But we don't want to miss images with no license!)</span>&#x000A;458:     &#x000A;459:     <span class="ruby-comment cmt">#pp options</span>&#x000A;460:     &#x000A;461:     <span class="ruby-identifier">result</span>=<span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-node">%Q{SELECT dato.*, l.description license_text, l.logo_url license_logo, l.source_url license_url,&#x000A;462:                                       (?) taxon_id, t.scientific_name&#x000A;463:                                 FROM #{options[:from]} ti&#x000A;464:                                   STRAIGHT_JOIN data_objects dato      ON ti.data_object_id = dato.id&#x000A;465:                                   STRAIGHT_JOIN data_objects_taxa dot  ON dato.id = dot.data_object_id&#x000A;466:                                   STRAIGHT_JOIN taxa t                 ON dot.taxon_id = t.id&#x000A;467:                                   #{join_agents}&#x000A;468:                                   LEFT JOIN licenses l        ON dato.license_id = l.id &#x000A;469:                                 WHERE ti.hierarchy_entry_id IN (?)&#x000A;470:                                   AND data_type_id IN (?)&#x000A;471:                                   #{DataObject.visibility_clause(options.merge(:taxon =&gt; taxon))}&#x000A;472:                                   GROUP BY dato.id&#x000A;473:                                 ORDER BY dato.vetted_id DESC,dato.data_rating                          # DataObject.cached_images_for_taxon }</span>,&#x000A;474:                             <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">hierarchy_entries</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">he</span><span class="ruby-operator">|</span> <span class="ruby-identifier">he</span>.<span class="ruby-identifier">id</span> }, <span class="ruby-constant">DataType</span>.<span class="ruby-identifier">image_type_ids</span>])                            &#x000A;475:     <span class="ruby-comment cmt"># Run a second query if we need unpublished or invisible images (but not if we're already doing it!!!):</span>&#x000A;476:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">nested</span> <span class="ruby-keyword kw">and</span> ((<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:agent</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">is_curator?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">is_admin?</span>)&#x000A;477:       <span class="ruby-identifier">result</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">cached_images_for_taxon</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'top_unpublished_images'</span>))&#x000A;478:     <span class="ruby-keyword kw">end</span>&#x000A;479:     <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">includes_unvetted</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">vetted_id</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Vetted</span>.<span class="ruby-identifier">trusted</span>.<span class="ruby-identifier">id</span> }&#x000A;480:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>                            &#x000A;481:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000390'>
                <a name='M000390'>      </a>
                <div class='synopsis'>
                  <span class='name'>for_taxon</span>
                  <span class='arguments'>(taxon, type, options = {})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000390-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000390-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 483</span>&#x000A;483:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">for_taxon</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">options</span> = {})&#x000A;484:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>] = <span class="ruby-constant">User</span>.<span class="ruby-identifier">create_new</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>].<span class="ruby-identifier">nil?</span>&#x000A;485:     &#x000A;486:     <span class="ruby-comment cmt"># Just return the (much faster) cached images if there is no need to deal with permissions:</span>&#x000A;487:     <span class="ruby-comment cmt"># TODO - does this next line need to move to the bottom, to ADD these images?  I think not, but we should check.</span>&#x000A;488:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">cached_images_for_taxon</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">options</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:image</span>&#x000A;489:     <span class="ruby-identifier">klass</span> = (<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:text</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:toc_id</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">TocItem</span> <span class="ruby-operator">:</span> <span class="ruby-constant">DataObject</span>&#x000A;490:     <span class="ruby-comment cmt"># puts &quot;---- BIG QUERY &quot; + '-' * 40</span>&#x000A;491:     <span class="ruby-comment cmt"># puts DataObject.build_query(taxon, type, options)</span>&#x000A;492:     <span class="ruby-comment cmt"># puts '-' * 60</span>&#x000A;493:     <span class="ruby-identifier">results</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">build_query</span>(<span class="ruby-identifier">taxon</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">options</span>))&#x000A;494:     <span class="ruby-identifier">taxon</span>.<span class="ruby-identifier">includes_unvetted</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">vetted_id</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Vetted</span>.<span class="ruby-identifier">trusted</span>.<span class="ruby-identifier">id</span> }&#x000A;495:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">results</span>&#x000A;496:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000351'>
                <a name='M000351'>      </a>
                <div class='synopsis'>
                  <span class='name'>image_cache_path</span>
                  <span class='arguments'>(cache_url, size = :large, subdir = $CONTENT_SERVER_CONTENT_PATH)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000351-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000351-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 194</span>&#x000A;194:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">image_cache_path</span>(<span class="ruby-identifier">cache_url</span>, <span class="ruby-identifier">size</span> = <span class="ruby-identifier">:large</span>, <span class="ruby-identifier">subdir</span> = <span class="ruby-identifier">$CONTENT_SERVER_CONTENT_PATH</span>)&#x000A;195:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cache_path</span>(<span class="ruby-identifier">cache_url</span>, <span class="ruby-identifier">subdir</span>) <span class="ruby-operator">+</span> <span class="ruby-node">&quot;_#{size}.#{$SPECIES_IMAGE_FORMAT}&quot;</span>&#x000A;196:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000339'>
                <a name='M000339'>      </a>
                <div class='synopsis'>
                  <span class='name'>images_for_hierarchy_entry</span>
                  <span class='arguments'>(he_id)</span>
                </div>
                <div class='description'>
                  <p>
                  TODO - this is broken, but unused. When we start using it again, it must be
                  fixed.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000339-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000339-source'>    <span class="ruby-comment cmt"># File app/models/data_object.rb, line 50</span>&#x000A;50:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">images_for_hierarchy_entry</span>(<span class="ruby-identifier">he_id</span>)&#x000A;51:     <span class="ruby-comment cmt"># NOTE - left join on the licenses, so they could be NULL.</span>&#x000A;52:     <span class="ruby-comment cmt"># (But we don't want to miss images with no license!)</span>&#x000A;53:     <span class="ruby-comment cmt"># TODO - MED PRIORITY - I'm assuming there's one HE for this data object, and there could be several.</span>&#x000A;54:     <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">%q{SELECT DISTINCT do.*, l.description license_text, l.logo_url license_logo, l.source_url license_url,&#x000A;55:                                       hierarchy_entry_id taxon_id, t.scientific_name&#x000A;56:                                 FROM top_images ti JOIN hierarchy_entry_names hen USING (hierarchy_entry_id)&#x000A;57:                                   JOIN data_objects do        ON ti.data_object_id = do.id&#x000A;58:                                   JOIN data_objects_taxa dot  ON do.id = dot.data_object_id&#x000A;59:                                   JOIN taxa t                 ON dot.taxon_id = t.id&#x000A;60:                                   LEFT OUTER JOIN licenses l  ON do.license_id = l.id &#x000A;61:                                 WHERE hierarchy_entry_id = ? AND data_type_id IN (?) AND visibility_id = 1&#x000A;62:                                 ORDER BY ti.view_order     # images_for_hierarchy_entry }</span>,&#x000A;63:                             <span class="ruby-identifier">he_id</span>, <span class="ruby-constant">DataType</span>.<span class="ruby-identifier">image_type_ids</span>])&#x000A;64:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000386'>
                <a name='M000386'>      </a>
                <div class='synopsis'>
                  <span class='name'>search_by_tag</span>
                  <span class='arguments'>(key_or_tag, value_or_nil = nil, options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Find data objects tagged with a particular tag
                  </p>
                  <p>
                  If no &#8216;value&#8217; is provided for the tag, it will find all data
                  objects tagged with <b>any</b> value of the given key (category)
                  </p>
                  <p>
                  Usage:
                  </p>
                  <pre>DataObject.search_by_tag :color, 'blue'&#x000A;DataObject.search_by_tag :color, :blue&#x000A;DataObject.search_by_tag &lt;DataObjecTag&gt;</pre>
                  <p>
                  TODO this is starting to get really messy &#8230; extract some of this
                  outta here into objects &#8230;
                  </p>
                  <pre>try a named_scope on TopImage and things like that ... move to other models or to other&#x000A;DataObject methods</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000386-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000386-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 374</span>&#x000A;374:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search_by_tag</span> <span class="ruby-identifier">key_or_tag</span>, <span class="ruby-identifier">value_or_nil</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">options</span> = {}&#x000A;375:     <span class="ruby-identifier">tag</span> = (<span class="ruby-identifier">key_or_tag</span>.<span class="ruby-identifier">is_a?</span><span class="ruby-constant">DataObjectTag</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">key_or_tag</span> <span class="ruby-operator">:</span> <span class="ruby-constant">DataObjectTag</span>[<span class="ruby-identifier">key_or_tag</span>, <span class="ruby-identifier">value_or_nil</span>]&#x000A;376:     <span class="ruby-identifier">data_object_tags</span> = (<span class="ruby-identifier">tag</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">DataObjectTags</span>.<span class="ruby-identifier">search_by_tag</span>( <span class="ruby-identifier">tag</span> ) <span class="ruby-operator">:</span> []&#x000A;377:     <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">data_object_tags</span>.<span class="ruby-identifier">empty?</span>&#x000A;378:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:clade</span>]&#x000A;379:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:clade</span>] = [ <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:clade</span>] ] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:clade</span>].<span class="ruby-identifier">is_a?</span><span class="ruby-constant">Array</span>&#x000A;380:       <span class="ruby-identifier">data_object_ids</span> = <span class="ruby-identifier">data_object_tags</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:data_object_id</span>).<span class="ruby-identifier">uniq</span>&#x000A;381:       <span class="ruby-identifier">clades</span> = <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:clade</span>].<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;id = #{id}&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' OR '</span>)&#x000A;382:       <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">clades</span>.<span class="ruby-identifier">empty?</span>&#x000A;383:       <span class="ruby-identifier">sql</span> = <span class="ruby-value str">%[&#x000A;384:         SELECT DISTINCT top_images.data_object_id&#x000A;385:         FROM top_images &#x000A;386:         JOIN hierarchy_entries ON top_images.hierarchy_entry_id = hierarchy_entries.id&#x000A;387:         WHERE ]</span>&#x000A;388:       <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">clades</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">clade</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;(hierarchy_entries.lft &gt;= #{clade.lft} AND hierarchy_entries.lft &lt;= #{clade.rgt})&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' OR '</span>)&#x000A;389:       <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-node">%[ AND data_object_id IN (#{data_object_ids.join(',')})]</span>&#x000A;390:       <span class="ruby-identifier">tagged_images_in_clade</span> = <span class="ruby-constant">TopImage</span>.<span class="ruby-identifier">find_by_sql</span> <span class="ruby-identifier">sql</span>&#x000A;391:       <span class="ruby-identifier">tagged_images_in_clade</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">img</span><span class="ruby-operator">|</span> <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">img</span>.<span class="ruby-identifier">data_object_id</span>) }.<span class="ruby-identifier">uniq</span>&#x000A;392:     <span class="ruby-keyword kw">else</span>&#x000A;393:       <span class="ruby-identifier">data_object_tags</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:object</span>).<span class="ruby-identifier">uniq</span>&#x000A;394:     <span class="ruby-keyword kw">end</span>&#x000A;395:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000387'>
                <a name='M000387'>      </a>
                <div class='synopsis'>
                  <span class='name'>search_by_tags</span>
                  <span class='arguments'>(tags, options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Find data objects tagged with certain tags
                  </p>
                  <p>
                  Usage:
                  </p>
                  <pre>DataObject.search_by_tags [ [&lt;DataObjecTag&gt;], [&lt;DataObjectTag&gt;, &lt;DataObjectTag] ]&#x000A;DataObject.search_by_tags [ [[:key1,'value1']], [[:key2,:value2],['key3',:value3]] ]</pre>
                  <p>
                  TODO: Optimization is necessary, the way it is now is quite resource hungry
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000387-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000387-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 404</span>&#x000A;404:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search_by_tags</span> <span class="ruby-identifier">tags</span>, <span class="ruby-identifier">options</span> = {}&#x000A;405:     <span class="ruby-identifier">t</span> = <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">res</span>,<span class="ruby-identifier">tags_group</span><span class="ruby-operator">|</span>&#x000A;406:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tags_group</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">DataObjectTag</span>)&#x000A;407:         <span class="ruby-identifier">res</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tags_group</span>&#x000A;408:       <span class="ruby-keyword kw">else</span>&#x000A;409:         <span class="ruby-identifier">res</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tags_group</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-constant">DataObjectTag</span>[<span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span>]}&#x000A;410:       <span class="ruby-keyword kw">end</span>&#x000A;411:     <span class="ruby-keyword kw">end</span>&#x000A;412:     <span class="ruby-identifier">result</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">res</span>, <span class="ruby-identifier">tags_group</span><span class="ruby-operator">|</span>&#x000A;413:       <span class="ruby-identifier">search</span> = (<span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">search_tags_group</span>(<span class="ruby-identifier">tags_group</span>, <span class="ruby-identifier">options</span>).<span class="ruby-identifier">to_set</span>)&#x000A;414:       <span class="ruby-identifier">res</span> = <span class="ruby-identifier">res</span> <span class="ruby-value">? </span><span class="ruby-identifier">search</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">intersection</span>(<span class="ruby-identifier">search</span>)&#x000A;415:     <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">to_a</span>&#x000A;416:     <span class="ruby-identifier">result</span>&#x000A;417:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000388'>
                <a name='M000388'>      </a>
                <div class='synopsis'>
                  <span class='name'>search_tags_group</span>
                  <span class='arguments'>(tags, options)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000388-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000388-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 419</span>&#x000A;419:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search_tags_group</span> <span class="ruby-identifier">tags</span>, <span class="ruby-identifier">options</span>&#x000A;420:     <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">compact!</span>&#x000A;421:     <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">empty?</span>&#x000A;422:     <span class="ruby-identifier">data_object_tags</span> = <span class="ruby-constant">DataObjectTags</span>.<span class="ruby-identifier">search_by_tags_or</span> <span class="ruby-identifier">tags</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user_id</span>]&#x000A;423:     <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">data_object_tags</span>.<span class="ruby-identifier">empty?</span>&#x000A;424: &#x000A;425:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:clade</span>]&#x000A;426: &#x000A;427:       <span class="ruby-comment cmt"># TODO - THIS HAS BEEN COPY/PASTED - ***JUST*** FOR TESTING - NEEDS REFACTORING &amp; TO BE DRY'd UP</span>&#x000A;428:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:clade</span>] = [ <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:clade</span>] ] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:clade</span>].<span class="ruby-identifier">is_a?</span><span class="ruby-constant">Array</span>&#x000A;429:       <span class="ruby-identifier">data_object_ids</span> = <span class="ruby-identifier">data_object_tags</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:data_object_id</span>).<span class="ruby-identifier">uniq</span>&#x000A;430:       <span class="ruby-identifier">clades</span> = <span class="ruby-constant">HierarchyEntry</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:clade</span>].<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">id</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;id = #{self.id}&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' OR '</span>)&#x000A;431:       <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">clades</span>.<span class="ruby-identifier">empty?</span>&#x000A;432:       <span class="ruby-identifier">sql</span> = <span class="ruby-value str">%[&#x000A;433:         SELECT DISTINCT top_images.data_object_id&#x000A;434:         FROM top_images &#x000A;435:         JOIN hierarchy_entries ON top_images.hierarchy_entry_id = hierarchy_entries.id&#x000A;436:         WHERE ]</span>&#x000A;437:       <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">clades</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">clade</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;(hierarchy_entries.lft &gt;= #{clade.lft} AND hierarchy_entries.lft &lt;= #{clade.rgt})&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' OR '</span>)&#x000A;438:       <span class="ruby-identifier">sql</span> <span class="ruby-operator">+=</span> <span class="ruby-node">%[ AND data_object_id IN (#{data_object_ids.join(',')})]</span>&#x000A;439:       <span class="ruby-identifier">tagged_images_in_clade</span> = <span class="ruby-constant">TopImage</span>.<span class="ruby-identifier">find_by_sql</span> <span class="ruby-identifier">sql</span>&#x000A;440:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">tagged_images_in_clade</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">img</span><span class="ruby-operator">|</span> <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">img</span>.<span class="ruby-identifier">data_object_id</span>) }.<span class="ruby-identifier">uniq</span>&#x000A;441: &#x000A;442:     <span class="ruby-keyword kw">else</span>&#x000A;443:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">data_object_tags</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:object</span>).<span class="ruby-identifier">uniq</span>&#x000A;444:     <span class="ruby-keyword kw">end</span>&#x000A;445:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000341'>
                <a name='M000341'>      </a>
                <div class='synopsis'>
                  <span class='name'>attributions</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  gets agents_data_objects, sorted by <a href="AgentRole.html">AgentRole</a>,
                  based on this objects&#8217; DataTypes&#8217; <a
                  href="AgentRole.html">AgentRole</a> attribution priorities
                  </p>
                  <p>
                  we also fetch agents_data_objects, including (eager loading) Agents by
                  default, assuming we will be using them
                  </p>
                  <p>
                  TODO clean this up. needs to be broken down into different methods. this
                  was clean until we added abunchof denormalizations
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000341-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000341-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 75</span>&#x000A; 75:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">attributions</span>&#x000A; 76:     <span class="ruby-comment cmt"># for each of the agent roles in the attribution order, go thru agents_data_objects and </span>&#x000A; 77:     <span class="ruby-comment cmt"># get all of the agents in that role =&gt; [ [role1, role1], nil, [role3], [role4], nil ]</span>&#x000A; 78:     <span class="ruby-identifier">grouped_by_agent_role</span> = <span class="ruby-identifier">data_type</span>.<span class="ruby-identifier">full_attribution_order</span>.<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">all</span>, <span class="ruby-identifier">agent_role</span><span class="ruby-operator">|</span>&#x000A; 79:       <span class="ruby-identifier">all</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">agents_data_objects</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">ado</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ado</span>.<span class="ruby-identifier">agent_role</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">agent_role</span> }&#x000A; 80:       <span class="ruby-identifier">all</span>&#x000A; 81:     <span class="ruby-keyword kw">end</span>&#x000A; 82:     &#x000A; 83:     <span class="ruby-comment cmt"># get rid of nils and sort the groups by view_order</span>&#x000A; 84:     <span class="ruby-identifier">grouped_by_agent_role</span>.<span class="ruby-identifier">compact!</span>&#x000A; 85:     <span class="ruby-identifier">grouped_by_agent_role</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>&#x000A; 86:       <span class="ruby-identifier">grouped_by_agent_role</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">group</span>.<span class="ruby-identifier">sort_by</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">view_order</span> }&#x000A; 87:     <span class="ruby-keyword kw">end</span>&#x000A; 88: &#x000A; 89:     <span class="ruby-comment cmt"># now, go through and put everything into 1 ordered list, no longer grouped</span>&#x000A; 90:     <span class="ruby-identifier">grouped_by_agent_role</span> = <span class="ruby-identifier">grouped_by_agent_role</span>.<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">all</span>, <span class="ruby-identifier">sorted_group</span><span class="ruby-operator">|</span>&#x000A; 91:       <span class="ruby-identifier">all</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">sorted_group</span>&#x000A; 92:       <span class="ruby-identifier">all</span>&#x000A; 93:     <span class="ruby-keyword kw">end</span>&#x000A; 94: &#x000A; 95:     <span class="ruby-comment cmt"># we need to manually add the Data Supplier too ... TODO extract these custom things into the full_attribution_order method (or something?)</span>&#x000A; 96:     <span class="ruby-identifier">supplier</span> = <span class="ruby-identifier">data_supplier_agent</span>&#x000A; 97:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">supplier</span>&#x000A; 98:       <span class="ruby-identifier">index_to_insert_data_supplier</span> = <span class="ruby-value">0</span>&#x000A; 99:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">grouped_by_agent_role</span>[<span class="ruby-identifier">index_to_insert_data_supplier</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">grouped_by_agent_role</span>[<span class="ruby-identifier">index_to_insert_data_supplier</span>].<span class="ruby-identifier">agent_role</span> <span class="ruby-operator">==</span> <span class="ruby-constant">AgentRole</span>[<span class="ruby-identifier">:Author</span>]&#x000A;100:         <span class="ruby-identifier">index_to_insert_data_supplier</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;101:       <span class="ruby-keyword kw">end</span>&#x000A;102:       <span class="ruby-identifier">grouped_by_agent_role</span>.<span class="ruby-identifier">insert</span> <span class="ruby-identifier">index_to_insert_data_supplier</span>, <span class="ruby-constant">AgentsDataObject</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">supplier</span>, &#x000A;103:                                                               <span class="ruby-identifier">:agent_role</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">AgentRole</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Supplier'</span>), <span class="ruby-identifier">:view_order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )&#x000A;104:     <span class="ruby-keyword kw">end</span>&#x000A;105: &#x000A;106:     <span class="ruby-comment cmt"># now, we need to go in and put the rights statement ... this is very hacky but the </span>&#x000A;107:     <span class="ruby-comment cmt"># rights statement is supposed to show up after the Source, but it's not actually an attribution</span>&#x000A;108:     <span class="ruby-comment cmt"># so ... we have to stick it into the list somehow for it to show up  :/</span>&#x000A;109:     <span class="ruby-comment cmt"># </span>&#x000A;110:     <span class="ruby-comment cmt"># it should show up *after* Source, if it exists, else Author, else it should show up first</span>&#x000A;111:     <span class="ruby-comment cmt">#</span>&#x000A;112:     <span class="ruby-comment cmt">#</span>&#x000A;113:     <span class="ruby-comment cmt"># TODO this needs some serious cleanup</span>&#x000A;114:     <span class="ruby-comment cmt">#</span>&#x000A;115:     <span class="ruby-identifier">a_license</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">license</span>&#x000A;116:     <span class="ruby-identifier">a_license</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">License</span>.<span class="ruby-identifier">find_by_title</span>(<span class="ruby-value str">'public domain'</span>) <span class="ruby-comment cmt"># if there's no license, we wanna display the 'No right reserved' license (aka public domain)</span>&#x000A;117:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">rights_statement</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">a_license</span>.<span class="ruby-identifier">nil?</span>&#x000A;118:       <span class="ruby-identifier">roles_to_insert_after</span> = <span class="ruby-constant">AgentRole</span>[ <span class="ruby-identifier">:Author</span>, <span class="ruby-identifier">:Source</span> ]&#x000A;119:       <span class="ruby-identifier">index_to_insert_rights</span> = <span class="ruby-value">0</span>&#x000A;120:       <span class="ruby-comment cmt"># logo_cache_url isn't working, nor is logo_url  :(</span>&#x000A;121:       <span class="ruby-identifier">rights_agent</span>  = <span class="ruby-constant">Agent</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">:project_name</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">rights_statement</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-value">? </span><span class="ruby-identifier">a_license</span>.<span class="ruby-identifier">description</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{rights_statement} #{a_license.description}&quot;</span>), &#x000A;122:                                 <span class="ruby-identifier">:homepage</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">a_license</span>.<span class="ruby-identifier">source_url</span>, <span class="ruby-identifier">:logo_url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">a_license</span>.<span class="ruby-identifier">logo_url</span>, <span class="ruby-identifier">:logo_cache_url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, &#x000A;123:                                 <span class="ruby-identifier">:logo_file_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">a_license</span>.<span class="ruby-identifier">logo_url</span> <span class="ruby-comment cmt"># &lt;-- check for the presence of logo_file name</span>&#x000A;124:       <span class="ruby-identifier">rights_object</span> = <span class="ruby-constant">AgentsDataObject</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rights_agent</span>, <span class="ruby-identifier">:agent_role</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">AgentRole</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Copyright'</span>), <span class="ruby-identifier">:view_order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;125:       <span class="ruby-identifier">grouped_by_agent_role</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>&#x000A;126:         <span class="ruby-identifier">index_to_insert_rights</span> = <span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">roles_to_insert_after</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">agent_role</span>&#x000A;127:       <span class="ruby-keyword kw">end</span>&#x000A;128:       <span class="ruby-identifier">grouped_by_agent_role</span>.<span class="ruby-identifier">insert</span> <span class="ruby-identifier">index_to_insert_rights</span>, <span class="ruby-identifier">rights_object</span>&#x000A;129:     <span class="ruby-keyword kw">end</span>&#x000A;130: &#x000A;131:     <span class="ruby-comment cmt"># we ALSO need Location</span>&#x000A;132:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">empty?</span>&#x000A;133:       <span class="ruby-identifier">grouped_by_agent_role</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">AgentsDataObject</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Agent</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:project_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">location</span>), <span class="ruby-identifier">:agent_role</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">AgentRole</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Location'</span>), <span class="ruby-identifier">:view_order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )&#x000A;134:     <span class="ruby-keyword kw">end</span>&#x000A;135:     &#x000A;136:     <span class="ruby-comment cmt"># we ALSO need the source_url</span>&#x000A;137:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">source_url</span>.<span class="ruby-identifier">empty?</span>&#x000A;138:       <span class="ruby-identifier">grouped_by_agent_role</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">AgentsDataObject</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Agent</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:project_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'View original data object'</span>, <span class="ruby-identifier">:homepage</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">source_url</span>), &#x000A;139:                                                     <span class="ruby-identifier">:agent_role</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">AgentRole</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Source URL'</span>), <span class="ruby-identifier">:view_order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )&#x000A;140:     <span class="ruby-keyword kw">end</span>&#x000A;141: &#x000A;142:     <span class="ruby-comment cmt"># ... bibliographic_citation ...</span>&#x000A;143:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bibliographic_citation</span>.<span class="ruby-identifier">empty?</span>&#x000A;144:       <span class="ruby-identifier">grouped_by_agent_role</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">AgentsDataObject</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Agent</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:project_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bibliographic_citation</span>), <span class="ruby-identifier">:agent_role</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">AgentRole</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Citation'</span>), <span class="ruby-identifier">:view_order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )&#x000A;145:     <span class="ruby-keyword kw">end</span>&#x000A;146: &#x000A;147:     <span class="ruby-identifier">grouped_by_agent_role</span>&#x000A;148:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000342'>
                <a name='M000342'>      </a>
                <div class='synopsis'>
                  <span class='name'>authors</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000342-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000342-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 150</span>&#x000A;150:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">authors</span>&#x000A;151:     <span class="ruby-identifier">default_authors</span> = <span class="ruby-identifier">agents_data_objects</span>.<span class="ruby-identifier">find_all_by_agent_role_id</span>(<span class="ruby-constant">AgentRole</span>.<span class="ruby-identifier">author_id</span>).<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">ado</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ado</span>.<span class="ruby-identifier">agent</span> }.<span class="ruby-identifier">compact</span>&#x000A;152:     <span class="ruby-ivar">@fake_authors</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">default_authors</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">default_authors</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@fake_authors</span>&#x000A;153:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000337'>
                <a name='M000337'>      </a>
                <div class='synopsis'>
                  <span class='name'>comment</span>
                  <span class='arguments'>(user, body)</span>
                </div>
                <div class='description'>
                  <p>
                  comment on this
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000337-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000337-source'>    <span class="ruby-comment cmt"># File app/models/data_object.rb, line 39</span>&#x000A;39:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">comment</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">body</span>)&#x000A;40:     <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">body</span>&#x000A;41:     <span class="ruby-identifier">user</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">reload</span> <span class="ruby-comment cmt"># be friendly - update the user's comments automatically</span>&#x000A;42:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">comment</span>&#x000A;43:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000370'>
                <a name='M000370'>      </a>
                <div class='synopsis'>
                  <span class='name'>curate!</span>
                  <span class='arguments'>(action)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000370-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000370-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 289</span>&#x000A;289:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">curate!</span>(<span class="ruby-identifier">action</span>)&#x000A;290:     <span class="ruby-identifier">activity</span> = <span class="ruby-constant">CuratorActivity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">action</span>)&#x000A;291: &#x000A;292:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">code</span>[<span class="ruby-regexp re">/^approve$/i</span>]&#x000A;293:       <span class="ruby-identifier">vet!</span>&#x000A;294:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">code</span>[<span class="ruby-regexp re">/^disapprove$/i</span>]&#x000A;295:       <span class="ruby-identifier">unvet!</span>&#x000A;296:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">code</span>[<span class="ruby-regexp re">/^show$/i</span>]&#x000A;297:       <span class="ruby-identifier">show!</span>&#x000A;298:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">code</span>[<span class="ruby-regexp re">/^hide$/i</span>]&#x000A;299:       <span class="ruby-identifier">hide!</span>&#x000A;300:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">code</span>[<span class="ruby-regexp re">/^inappropriate$/i</span>]&#x000A;301:       <span class="ruby-identifier">inappropriate!</span>&#x000A;302:     <span class="ruby-keyword kw">else</span>&#x000A;303:       <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Not sure how to #{activity.code} a DataObject&quot;</span>&#x000A;304:     <span class="ruby-keyword kw">end</span>&#x000A;305:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000371'>
                <a name='M000371'>      </a>
                <div class='synopsis'>
                  <span class='name'>curated?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000371-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000371-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 307</span>&#x000A;307:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">curated?</span>&#x000A;308:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">curated</span>&#x000A;309:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000340'>
                <a name='M000340'>      </a>
                <div class='synopsis'>
                  <span class='name'>data_supplier_agent</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000340-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000340-source'>    <span class="ruby-comment cmt"># File app/models/data_object.rb, line 66</span>&#x000A;66:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">data_supplier_agent</span>&#x000A;67:     <span class="ruby-constant">Agent</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;select a.* from data_objects_harvest_events dohe join harvest_events he on (dohe.harvest_event_id=he.id) join agents_resources ar on (he.resource_id=ar.resource_id) join agents a on (ar.agent_id=a.id) where dohe.data_object_id=? and ar.resource_agent_role_id=3&quot;</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>]).<span class="ruby-identifier">first</span>&#x000A;68:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000344'>
                <a name='M000344'>      </a>
                <div class='synopsis'>
                  <span class='name'>fake_author</span>
                  <span class='arguments'>(author_options)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000344-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000344-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 160</span>&#x000A;160:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fake_author</span>(<span class="ruby-identifier">author_options</span>)&#x000A;161:     <span class="ruby-ivar">@fake_authors</span> <span class="ruby-operator">||=</span> []&#x000A;162:     <span class="ruby-ivar">@fake_authors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Agent</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">author_options</span>)&#x000A;163:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000353'>
                <a name='M000353'>      </a>
                <div class='synopsis'>
                  <span class='name'>has_object_cache_url?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000353-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000353-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 203</span>&#x000A;203:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_object_cache_url?</span>&#x000A;204:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object_cache_url</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">object_cache_url</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>&#x000A;205:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>&#x000A;206:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000352'>
                <a name='M000352'>      </a>
                <div class='synopsis'>
                  <span class='name'>has_thumbnail_cache?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000352-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000352-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 198</span>&#x000A;198:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_thumbnail_cache?</span>&#x000A;199:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">thumbnail_cache_url</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">thumbnail_cache_url</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>&#x000A;200:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>&#x000A;201:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000381'>
                <a name='M000381'>      </a>
                <div class='synopsis'>
                  <span class='name'>hide!</span>
                  <span class='arguments'>(user = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000381-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000381-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 339</span>&#x000A;339:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hide!</span> <span class="ruby-identifier">user</span> = <span class="ruby-keyword kw">nil</span>&#x000A;340:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">vetted_by</span> = <span class="ruby-identifier">user</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>&#x000A;341:     <span class="ruby-identifier">update_attributes</span>({<span class="ruby-identifier">:visibility_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Visibility</span>.<span class="ruby-identifier">invisible</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:curated</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>})&#x000A;342:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000369'>
                <a name='M000369'>      </a>
                <div class='synopsis'>
                  <span class='name'>hierarchy_entries</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  this is even less efficient than <a
                  href="DataObject.html#M000368">taxon_concepts</a> - OPTIMIZE!
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000369-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000369-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 285</span>&#x000A;285:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hierarchy_entries</span>&#x000A;286:     <span class="ruby-ivar">@hierarchy_entries</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">taxon_concepts</span>.<span class="ruby-identifier">inject</span>([]){<span class="ruby-operator">|</span><span class="ruby-identifier">all</span>,<span class="ruby-identifier">concept</span><span class="ruby-operator">|</span> <span class="ruby-identifier">all</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">concept</span>.<span class="ruby-identifier">hierarchy_entries</span>  }.<span class="ruby-identifier">uniq</span>&#x000A;287:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000347'>
                <a name='M000347'>      </a>
                <div class='synopsis'>
                  <span class='name'>image?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000347-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000347-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 177</span>&#x000A;177:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">image?</span>&#x000A;178:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">DataType</span>.<span class="ruby-identifier">image_type_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">data_type_id</span>)&#x000A;179:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000384'>
                <a name='M000384'>      </a>
                <div class='synopsis'>
                  <span class='name'>inappropriate!</span>
                  <span class='arguments'>(user = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000384-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000384-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 351</span>&#x000A;351:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inappropriate!</span> <span class="ruby-identifier">user</span> = <span class="ruby-keyword kw">nil</span>&#x000A;352:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">vetted_by</span> = <span class="ruby-identifier">user</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>&#x000A;353:     <span class="ruby-identifier">update_attributes</span>({<span class="ruby-identifier">:visibility_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Visibility</span>.<span class="ruby-identifier">inappropriate</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:curated</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>})&#x000A;354:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000374'>
                <a name='M000374'>      </a>
                <div class='synopsis'>
                  <span class='name'>inappropriate?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000374-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000374-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 317</span>&#x000A;317:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inappropriate?</span>&#x000A;318:     <span class="ruby-identifier">visibility_id</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Visibility</span>.<span class="ruby-identifier">inappropriate</span>.<span class="ruby-identifier">id</span>&#x000A;319:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000373'>
                <a name='M000373'>      </a>
                <div class='synopsis'>
                  <span class='name'>invisible?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000373-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000373-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 314</span>&#x000A;314:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">invisible?</span>&#x000A;315:     <span class="ruby-identifier">visibility_id</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Visibility</span>.<span class="ruby-identifier">invisible</span>.<span class="ruby-identifier">id</span>&#x000A;316:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000338'>
                <a name='M000338'>      </a>
                <div class='synopsis'>
                  <span class='name'>is_curatable_by?</span>
                  <span class='arguments'>(user)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000338-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000338-source'>    <span class="ruby-comment cmt"># File app/models/data_object.rb, line 45</span>&#x000A;45:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_curatable_by?</span> <span class="ruby-identifier">user</span>&#x000A;46:     ( <span class="ruby-identifier">hierarchy_entries</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">can_curate?</span> <span class="ruby-identifier">entry</span> } ).<span class="ruby-identifier">include?</span> <span class="ruby-keyword kw">true</span>&#x000A;47:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000378'>
                <a name='M000378'>      </a>
                <div class='synopsis'>
                  <span class='name'>is_vetted?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Alias for <a href="DataObject.html#M000377">vetted?</a>
                  </p>
                </div>
              </div>
              <div class='public-instance method' id='method-M000348'>
                <a name='M000348'>      </a>
                <div class='synopsis'>
                  <span class='name'>map?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000348-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000348-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 181</span>&#x000A;181:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">map?</span>&#x000A;182:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">DataType</span>.<span class="ruby-identifier">map_type_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">data_type_id</span>)&#x000A;183:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000359'>
                <a name='M000359'>      </a>
                <div class='synopsis'>
                  <span class='name'>map_image</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000359-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000359-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 232</span>&#x000A;232:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">map_image</span>&#x000A;233:     <span class="ruby-comment cmt"># Sometimes, we want to serve map images right from the source:</span>&#x000A;234:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">$PREFER_REMOTE_IMAGES</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">object_url</span>.<span class="ruby-identifier">blank?</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-identifier">object_cache_url</span>.<span class="ruby-identifier">blank?</span>)&#x000A;235:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">object_url</span>&#x000A;236:     <span class="ruby-keyword kw">else</span>&#x000A;237:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">cache_path</span>(<span class="ruby-identifier">object_cache_url</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_orig.jpg&quot;</span>&#x000A;238:     <span class="ruby-keyword kw">end</span>&#x000A;239:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000343'>
                <a name='M000343'>      </a>
                <div class='synopsis'>
                  <span class='name'>photographers</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000343-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000343-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 155</span>&#x000A;155:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">photographers</span>&#x000A;156:     <span class="ruby-identifier">default_photographers</span> = <span class="ruby-identifier">agents_data_objects</span>.<span class="ruby-identifier">find_all_by_agent_role_id</span>(<span class="ruby-constant">AgentRole</span>.<span class="ruby-identifier">photographer_id</span>).<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">ado</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ado</span>.<span class="ruby-identifier">agent</span> }.<span class="ruby-identifier">compact</span>&#x000A;157:     <span class="ruby-ivar">@fake_photographers</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">default_photographers</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">default_photographers</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@fake_photographers</span>&#x000A;158:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000362'>
                <a name='M000362'>      </a>
                <div class='synopsis'>
                  <span class='name'>private_tags</span>
                  <span class='arguments'>(user)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000362-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000362-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 250</span>&#x000A;250:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">private_tags</span> <span class="ruby-identifier">user</span>&#x000A;251:     <span class="ruby-constant">DataObjectTags</span>.<span class="ruby-identifier">private_tags</span>.<span class="ruby-identifier">find_all_by_data_object_id_and_user_id</span> <span class="ruby-identifier">id</span>, <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>&#x000A;252:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000361'>
                <a name='M000361'>      </a>
                <div class='synopsis'>
                  <span class='name'>public_tags</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000361-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000361-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 246</span>&#x000A;246:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">public_tags</span>&#x000A;247:     <span class="ruby-constant">DataObjectTags</span>.<span class="ruby-identifier">public_tags_for_data_object</span> <span class="ruby-keyword kw">self</span>&#x000A;248:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000380'>
                <a name='M000380'>      </a>
                <div class='synopsis'>
                  <span class='name'>show!</span>
                  <span class='arguments'>(user = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000380-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000380-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 335</span>&#x000A;335:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">show!</span> <span class="ruby-identifier">user</span> = <span class="ruby-keyword kw">nil</span>&#x000A;336:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">vetted_by</span> = <span class="ruby-identifier">user</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>&#x000A;337:     <span class="ruby-identifier">update_attributes</span>({<span class="ruby-identifier">:visibility_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Visibility</span>.<span class="ruby-identifier">visible</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:curated</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>})&#x000A;338:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000357'>
                <a name='M000357'>      </a>
                <div class='synopsis'>
                  <span class='name'>smart_image</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000357-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000357-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 220</span>&#x000A;220:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">smart_image</span>&#x000A;221:     <span class="ruby-identifier">thumb_or_object</span>&#x000A;222:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000356'>
                <a name='M000356'>      </a>
                <div class='synopsis'>
                  <span class='name'>smart_medium_thumb</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000356-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000356-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 216</span>&#x000A;216:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">smart_medium_thumb</span>&#x000A;217:     <span class="ruby-identifier">thumb_or_object</span>(<span class="ruby-identifier">:medium</span>)&#x000A;218:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000355'>
                <a name='M000355'>      </a>
                <div class='synopsis'>
                  <span class='name'>smart_thumb</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000355-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000355-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 212</span>&#x000A;212:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">smart_thumb</span>&#x000A;213:     <span class="ruby-identifier">thumb_or_object</span>(<span class="ruby-identifier">:small</span>)&#x000A;214:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000345'>
                <a name='M000345'>      </a>
                <div class='synopsis'>
                  <span class='name'>sources</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000345-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000345-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 165</span>&#x000A;165:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sources</span>&#x000A;166:     <span class="ruby-identifier">list</span> = <span class="ruby-identifier">agents_data_objects</span>.<span class="ruby-identifier">find_all_by_agent_role_id</span>(<span class="ruby-constant">AgentRole</span>.<span class="ruby-identifier">source_id</span>).<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">ado</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ado</span>.<span class="ruby-identifier">agent</span> }.<span class="ruby-identifier">compact</span>&#x000A;167:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">list</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">blank?</span>&#x000A;168:     <span class="ruby-comment cmt"># I ended up with empty lists in cases where I thought I shouldn't, so tried to defer to authors for those:</span>&#x000A;169:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">authors</span>&#x000A;170:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000360'>
                <a name='M000360'>      </a>
                <div class='synopsis'>
                  <span class='name'>tag</span>
                  <span class='arguments'>(key, values, user = nil)</span>
                </div>
                <div class='description'>
                  <p>
                  tag with a <a href="DataObjectTag.html">DataObjectTag</a>
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000360-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000360-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 242</span>&#x000A;242:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tag</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">values</span>, <span class="ruby-identifier">user</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;243:     <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">tag</span> <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">values</span>, <span class="ruby-identifier">user</span>&#x000A;244:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000367'>
                <a name='M000367'>      </a>
                <div class='synopsis'>
                  <span class='name'>tag_keys</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  returns an array of all of the keys an object is tagged with
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000367-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000367-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 274</span>&#x000A;274:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tag_keys</span>&#x000A;275:     <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">key</span> }.<span class="ruby-identifier">uniq</span>&#x000A;276:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000366'>
                <a name='M000366'>      </a>
                <div class='synopsis'>
                  <span class='name'>tags_hash</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  returns a hash in the format { &#8216;tag_key&#8217; =>
                  [&#8216;value1&#8217;,&#8217;value2&#8217;] }
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000366-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000366-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 266</span>&#x000A;266:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tags_hash</span>&#x000A;267:     <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">inject</span>({}) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">all</span>,<span class="ruby-identifier">this</span><span class="ruby-operator">|</span>&#x000A;268:       <span class="ruby-identifier">all</span>[<span class="ruby-identifier">this</span>.<span class="ruby-identifier">key</span>] = (<span class="ruby-identifier">all</span>[<span class="ruby-identifier">this</span>.<span class="ruby-identifier">key</span>] <span class="ruby-operator">||</span> []) <span class="ruby-operator">+</span> [<span class="ruby-identifier">this</span>.<span class="ruby-identifier">value</span>]&#x000A;269:       <span class="ruby-identifier">all</span>&#x000A;270:     <span class="ruby-keyword kw">end</span>&#x000A;271:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000365'>
                <a name='M000365'>      </a>
                <div class='synopsis'>
                  <span class='name'>taxa_names_taxon_concept_ids</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Names of taxa associated with this image
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000365-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000365-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 259</span>&#x000A;259:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">taxa_names_taxon_concept_ids</span>&#x000A;260:     <span class="ruby-identifier">taxa</span>=<span class="ruby-constant">Taxon</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select t.scientific_name as taxon_name, tcn.taxon_concept_id as taxon_concept_id from data_objects_taxa dot join taxa t on (dot.taxon_id=t.id) join taxon_concept_names tcn on (t.name_id=tcn.name_id) where data_object_id=#{self.id} group by t.id&quot;</span>)&#x000A;261:     <span class="ruby-identifier">taxa</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> {<span class="ruby-identifier">:taxon_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">taxon_name</span>, <span class="ruby-identifier">:taxon_concept_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">taxon_concept_id</span>}}&#x000A;262:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000368'>
                <a name='M000368'>      </a>
                <div class='synopsis'>
                  <span class='name'>taxon_concepts</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  return all of the taxon concepts associated with this <a
                  href="DataObject.html">DataObject</a>
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000368-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000368-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 279</span>&#x000A;279:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">taxon_concepts</span>&#x000A;280:     <span class="ruby-comment cmt"># need to optimize with eager loading</span>&#x000A;281:     <span class="ruby-ivar">@taxon_concepts</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">DataObjectsTaxon</span>.<span class="ruby-identifier">find_all_by_data_object_id</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:taxon</span>).<span class="ruby-identifier">inject</span>([]){<span class="ruby-operator">|</span><span class="ruby-identifier">all</span>,<span class="ruby-identifier">this_taxon</span><span class="ruby-operator">|</span> ( <span class="ruby-identifier">all</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">this_taxon</span>.<span class="ruby-identifier">taxon_concepts</span> ) }.<span class="ruby-identifier">uniq</span>&#x000A;282:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000349'>
                <a name='M000349'>      </a>
                <div class='synopsis'>
                  <span class='name'>text?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000349-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000349-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 185</span>&#x000A;185:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">text?</span>&#x000A;186:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">DataType</span>.<span class="ruby-identifier">text_type_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">data_type_id</span>)&#x000A;187:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000354'>
                <a name='M000354'>      </a>
                <div class='synopsis'>
                  <span class='name'>thumb_or_object</span>
                  <span class='arguments'>(size = :large)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000354-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000354-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 208</span>&#x000A;208:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">thumb_or_object</span>(<span class="ruby-identifier">size</span> = <span class="ruby-identifier">:large</span>)&#x000A;209:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">image_cache_path</span>(<span class="ruby-identifier">object_cache_url</span>, <span class="ruby-identifier">size</span>) &#x000A;210:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000385'>
                <a name='M000385'>      </a>
                <div class='synopsis'>
                  <span class='name'>to_s</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000385-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000385-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 356</span>&#x000A;356:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>&#x000A;357:     <span class="ruby-node">&quot;[DataObject id:#{id}]&quot;</span>&#x000A;358:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000379'>
                <a name='M000379'>      </a>
                <div class='synopsis'>
                  <span class='name'>trusted?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Alias for <a href="DataObject.html#M000377">vetted?</a>
                  </p>
                </div>
              </div>
              <div class='public-instance method' id='method-M000376'>
                <a name='M000376'>      </a>
                <div class='synopsis'>
                  <span class='name'>unknown?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000376-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000376-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 325</span>&#x000A;325:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unknown?</span>&#x000A;326:     <span class="ruby-identifier">vetted_id</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Vetted</span>.<span class="ruby-identifier">unknown</span>.<span class="ruby-identifier">id</span>&#x000A;327:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000375'>
                <a name='M000375'>      </a>
                <div class='synopsis'>
                  <span class='name'>untrusted?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000375-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000375-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 321</span>&#x000A;321:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">untrusted?</span>&#x000A;322:     <span class="ruby-identifier">vetted_id</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Vetted</span>.<span class="ruby-identifier">untrusted</span>.<span class="ruby-identifier">id</span>&#x000A;323:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000383'>
                <a name='M000383'>      </a>
                <div class='synopsis'>
                  <span class='name'>unvet!</span>
                  <span class='arguments'>(user = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000383-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000383-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 347</span>&#x000A;347:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unvet!</span> <span class="ruby-identifier">user</span> = <span class="ruby-keyword kw">nil</span>&#x000A;348:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">vetted_by</span> = <span class="ruby-identifier">user</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>&#x000A;349:     <span class="ruby-identifier">update_attributes</span>({<span class="ruby-identifier">:vetted_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Vetted</span>.<span class="ruby-identifier">untrusted</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:curated</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>})&#x000A;350:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000363'>
                <a name='M000363'>      </a>
                <div class='synopsis'>
                  <span class='name'>user_tags</span>
                  <span class='arguments'>(user)</span>
                </div>
                <div class='description'>
                  <p>
                  Alias for <a href="DataObject.html#M000362">private_tags</a>
                  </p>
                </div>
              </div>
              <div class='public-instance method' id='method-M000364'>
                <a name='M000364'>      </a>
                <div class='synopsis'>
                  <span class='name'>users_tags</span>
                  <span class='arguments'>(user)</span>
                </div>
                <div class='description'>
                  <p>
                  Alias for <a href="DataObject.html#M000362">private_tags</a>
                  </p>
                </div>
              </div>
              <div class='public-instance method' id='method-M000382'>
                <a name='M000382'>      </a>
                <div class='synopsis'>
                  <span class='name'>vet!</span>
                  <span class='arguments'>(user = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000382-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000382-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 343</span>&#x000A;343:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">vet!</span> <span class="ruby-identifier">user</span> = <span class="ruby-keyword kw">nil</span>&#x000A;344:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">vetted_by</span> = <span class="ruby-identifier">user</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>&#x000A;345:     <span class="ruby-identifier">update_attributes</span>({<span class="ruby-identifier">:vetted_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Vetted</span>.<span class="ruby-identifier">trusted</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:curated</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>})&#x000A;346:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000377'>
                <a name='M000377'>      </a>
                <div class='synopsis'>
                  <span class='name'>vetted?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000377-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000377-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 329</span>&#x000A;329:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">vetted?</span>&#x000A;330:     <span class="ruby-identifier">vetted_id</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Vetted</span>.<span class="ruby-identifier">trusted</span>.<span class="ruby-identifier">id</span>&#x000A;331:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000358'>
                <a name='M000358'>      </a>
                <div class='synopsis'>
                  <span class='name'>video_url</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000358-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000358-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 224</span>&#x000A;224:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">video_url</span>&#x000A;225:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">data_type</span>.<span class="ruby-identifier">label</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Flash'</span>&#x000A;226:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">has_object_cache_url?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">DataObject</span>.<span class="ruby-identifier">cache_path</span>(<span class="ruby-identifier">object_cache_url</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">'.flv'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">''</span>&#x000A;227:     <span class="ruby-keyword kw">else</span>&#x000A;228:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">object_url</span>&#x000A;229:     <span class="ruby-keyword kw">end</span>&#x000A;230:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000372'>
                <a name='M000372'>      </a>
                <div class='synopsis'>
                  <span class='name'>visible?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000372-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000372-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 311</span>&#x000A;311:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">visible?</span>&#x000A;312:     <span class="ruby-identifier">visibility_id</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Visibility</span>.<span class="ruby-identifier">visible</span>.<span class="ruby-identifier">id</span>&#x000A;313:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000346'>
                <a name='M000346'>      </a>
                <div class='synopsis'>
                  <span class='name'>visible_comments</span>
                  <span class='arguments'>(user = nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000346-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000346-source'>     <span class="ruby-comment cmt"># File app/models/data_object.rb, line 172</span>&#x000A;172:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">visible_comments</span>(<span class="ruby-identifier">user</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;173:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">comments</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">is_moderator?</span>&#x000A;174:     <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">find_all</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">comment</span><span class="ruby-operator">|</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">visible?</span> }&#x000A;175:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
